"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.KnowledgeBase = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const cdk = require("aws-cdk-lib");
const iam = require("aws-cdk-lib/aws-iam");
const cdk_nag_1 = require("cdk-nag");
const constructs_1 = require("constructs");
const custom_resource_provider_1 = require("./custom-resource-provider");
const utils_1 = require("../../common/helpers/utils");
const amazonaurora_1 = require("../amazonaurora");
const opensearch_vectorindex_1 = require("../opensearch-vectorindex");
const opensearchserverless_1 = require("../opensearchserverless");
const pinecone_1 = require("../pinecone");
const redisenterprisecloud_1 = require("../redisenterprisecloud");
/**
 * Knowledge base can be backed by different vector databases.
 * This enum represents the different vector databases that can be used.
 *
 * `OPENSEARCH_SERVERLESS` is the default vector database.
 * `REDIS_ENTERPRISE_CLOUD` is the vector database for Redis Enterprise Cloud.
 * `PINECONE` is the vector database for Pinecone.
 * `AMAZON_AURORA` is the vector database for Amazon Aurora PostgreSQL.
 */
var VectorStoreType;
(function (VectorStoreType) {
    /**
     * `OPENSEARCH_SERVERLESS` is the vector store for OpenSearch Serverless.
     */
    VectorStoreType["OPENSEARCH_SERVERLESS"] = "OPENSEARCH_SERVERLESS";
    /**
     * `REDIS_ENTERPRISE_CLOUD` is the vector store for Redis Enterprise Cloud.
     */
    VectorStoreType["REDIS_ENTERPRISE_CLOUD"] = "REDIS_ENTERPRISE_CLOUD";
    /**
     * `PINECONE` is the vector store for Pinecone.
     */
    VectorStoreType["PINECONE"] = "PINECONE";
    /**
     * `RDS` is the vector store for Amazon Aurora.
     */
    VectorStoreType["AMAZON_AURORA"] = "RDS";
})(VectorStoreType || (VectorStoreType = {}));
/**
 * Deploys a Bedrock Knowledge Base and configures a backend by OpenSearch Serverless,
 * Pinecone, Redis Enterprise Cloud or Amazon Aurora PostgreSQL.
 *
 */
class KnowledgeBase extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        /**
         * TagManager facilitates a common implementation of tagging for Constructs
         */
        this.cdkTagManager = new cdk.TagManager(cdk.TagType.MAP, 'Custom::Bedrock-KnowledgeBase');
        this.instruction = props.instruction;
        const embeddingsModel = props.embeddingsModel;
        const indexName = props.indexName ?? 'bedrock-knowledge-base-default-index';
        const vectorField = props.vectorField ?? 'bedrock-knowledge-base-default-vector';
        const textField = 'AMAZON_BEDROCK_TEXT_CHUNK';
        const metadataField = 'AMAZON_BEDROCK_METADATA';
        validateModel(embeddingsModel);
        validateVectorIndex(props.vectorStore, props.vectorIndex, props.vectorField, props.indexName);
        if (props.vectorIndex) {
            validateIndexParameters(props.vectorIndex, indexName, vectorField);
        }
        this.name = (0, utils_1.generatePhysicalNameV2)(this, 'KB', { maxLength: 32 });
        const roleName = (0, utils_1.generatePhysicalNameV2)(this, 'AmazonBedrockExecutionRoleForKnowledgeBase', { maxLength: 64 });
        this.role = new iam.Role(this, 'Role', {
            roleName: roleName,
            assumedBy: new iam.ServicePrincipal('bedrock.amazonaws.com'),
        });
        this.role.assumeRolePolicy.addStatements(new iam.PolicyStatement({
            actions: ['sts:AssumeRole'],
            principals: [new iam.ServicePrincipal('bedrock.amazonaws.com')],
            conditions: {
                StringEquals: {
                    'aws:SourceAccount': cdk.Stack.of(this).account,
                },
                ArnLike: {
                    'aws:SourceArn': cdk.Stack.of(this).formatArn({
                        service: 'bedrock',
                        resource: 'knowledge-base',
                        resourceName: '*',
                        arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                    }),
                },
            },
        }));
        this.role.addToPolicy(new iam.PolicyStatement({
            actions: ['bedrock:InvokeModel'],
            resources: [embeddingsModel.asArn(this)],
        }));
        /**
         * Create the vector store if the vector store was provided by the user.
         * Otherwise check againts all possible vector datastores.
         * If none was provided create default OpenSearch Serverless Collection.
         */
        if (props.vectorStore instanceof opensearchserverless_1.VectorCollection) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchCollection(props));
        }
        else if (props.vectorStore instanceof redisenterprisecloud_1.RedisEnterpriseVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleRedisEnterpriseVectorStore(props));
        }
        else if (props.vectorStore instanceof pinecone_1.PineconeVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handlePineconeVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraVectorStore(props));
        }
        else if (props.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleAmazonAuroraDefaultVectorStore(props));
        }
        else {
            ({
                vectorStore: this.vectorStore,
                vectorStoreType: this.vectorStoreType,
            } = this.handleOpenSearchDefaultVectorCollection());
        }
        /**
         * We need to add `secretsmanager:GetSecretValue` to the role
         * of the knowledge base if we use data sources
         * other than OpenSearch Serverless.
         */
        if (!(this.vectorStore instanceof opensearchserverless_1.VectorCollection)) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: ['secretsmanager:GetSecretValue'],
                resources: [
                    this.vectorStore.credentialsSecretArn,
                ],
            }));
        }
        /**
         * We need to add `rds-data:ExecuteStatement`,
         * `rds-data:BatchExecuteStatement` and
         * `rds:DescribeDBClusters` to the role
         * of the knowledge base if we use Amazon Aurora as
         * a data source.
         */
        if (this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore ||
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) {
            this.role.addToPolicy(new iam.PolicyStatement({
                actions: [
                    'rds-data:ExecuteStatement',
                    'rds-data:BatchExecuteStatement',
                    'rds:DescribeDBClusters',
                ],
                resources: [
                    this.vectorStore.resourceArn,
                ],
            }));
        }
        /**
         * Create the vector index if the vector store is OpenSearch Serverless
         * and it was not provided. Otherwise use the provided vector index.
         */
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS) {
            if (!props.vectorIndex) {
                this.vectorIndex = new opensearch_vectorindex_1.VectorIndex(this, 'KBIndex', {
                    collection: this.vectorStore,
                    indexName,
                    vectorField,
                    vectorDimensions: embeddingsModel.vectorDimensions,
                    mappings: [
                        {
                            mappingField: 'AMAZON_BEDROCK_TEXT_CHUNK',
                            dataType: 'text',
                            filterable: true,
                        },
                        {
                            mappingField: 'AMAZON_BEDROCK_METADATA',
                            dataType: 'text',
                            filterable: false,
                        },
                    ],
                });
                this.vectorIndex.node.addDependency(this.vectorStore);
            }
            else {
                this.vectorIndex = props.vectorIndex;
            }
        }
        /**
         * Create storage configuraion. If it is of type of
         * `AmazonAuroraVectorStore` get textField, metadataField,
         * vectorField from the arguments. Otherwise use default values.
         */
        const storageConfiguration = {
            indexName: indexName,
            vectorStore: this.vectorStore,
            vectorStoreType: this.vectorStoreType,
            vectorField: (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) ?
                this.vectorStore.vectorField : vectorField,
            textField: (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) ?
                this.vectorStore.textField : textField,
            metadataField: (this.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore) ?
                this.vectorStore.metadataField : metadataField,
        };
        const crProvider = custom_resource_provider_1.BedrockCRProvider.getProvider(this);
        const knowledgeBase = new cdk.CustomResource(this, 'KB', {
            serviceToken: crProvider.serviceToken,
            resourceType: 'Custom::Bedrock-KnowledgeBase',
            properties: {
                knowledgeBaseConfiguration: {
                    type: 'VECTOR',
                    vectorKnowledgeBaseConfiguration: {
                        embeddingModelArn: embeddingsModel.asArn(this),
                    },
                },
                roleArn: this.role.roleArn,
                name: this.name,
                description: props.description,
                storageConfiguration: getStorageConfiguration(storageConfiguration),
                tags: this.cdkTagManager.renderedTags,
            },
        });
        const kbCRPolicy = new iam.Policy(this, 'KBCRPolicy', {
            roles: [crProvider.role],
            statements: [
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:CreateKnowledgeBase',
                        /**
                         * We need to add `bedrock:AssociateThirdPartyKnowledgeBase` if
                         * we are deploying Redis or Pinecone data sources
                         */
                        ...(this.vectorStoreType === VectorStoreType.REDIS_ENTERPRISE_CLOUD ||
                            this.vectorStoreType === VectorStoreType.PINECONE ?
                            ['bedrock:AssociateThirdPartyKnowledgeBase'] : []),
                    ],
                    resources: ['*'],
                }),
                new iam.PolicyStatement({
                    actions: [
                        'bedrock:UpdateKnowledgeBase',
                        'bedrock:DeleteKnowledgeBase',
                        'bedrock:TagResource',
                    ],
                    resources: [
                        cdk.Stack.of(this).formatArn({
                            service: 'bedrock',
                            resource: 'knowledge-base',
                            resourceName: '*',
                            arnFormat: cdk.ArnFormat.SLASH_RESOURCE_NAME,
                        }),
                    ],
                }),
                new iam.PolicyStatement({
                    actions: ['iam:PassRole'],
                    resources: [this.role.roleArn],
                }),
            ],
        });
        knowledgeBase.node.addDependency(this.role);
        knowledgeBase.node.addDependency(kbCRPolicy);
        if (this.vectorStoreType === VectorStoreType.OPENSEARCH_SERVERLESS &&
            this.vectorIndex) {
            knowledgeBase.node.addDependency(this.vectorIndex);
        }
        if (this.vectorStoreType === VectorStoreType.AMAZON_AURORA &&
            this.vectorStore instanceof amazonaurora_1.AmazonAuroraDefaultVectorStore) {
            knowledgeBase.node.addDependency(this.vectorStore);
        }
        cdk_nag_1.NagSuppressions.addResourceSuppressions(kbCRPolicy, [
            {
                id: 'AwsSolutions-IAM5',
                reason: "Bedrock CreateKnowledgeBase can't be restricted by resource.",
            },
        ], true);
        this.knowledgeBaseArn = knowledgeBase.getAttString('knowledgeBaseArn');
        this.knowledgeBaseId = knowledgeBase.getAttString('knowledgeBaseId');
    }
    /**
     * Handle VectorCollection type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchCollection(props) {
        const vectorStore = props.vectorStore;
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
    /**
     * Handle RedisEnterpriseVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of RedisEnterpriseVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleRedisEnterpriseVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.REDIS_ENTERPRISE_CLOUD,
        };
    }
    /**
   * Handle PineconeVectorStore type of VectorStore.
   *
   * @param props - The properties of the KnowledgeBase.
   * @returns The instance of PineconeVectorStore, VectorStoreType.
   * @internal This is an internal core function and should not be called directly.
   */
    handlePineconeVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.PINECONE,
        };
    }
    /**
     * Handle AmazonAuroraVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle AmazonAuroraDefaultVectorStore type of VectorStore.
     *
     * @param props - The properties of the KnowledgeBase.
     * @returns The instance of AmazonAuroraDefaultVectorStore, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleAmazonAuroraDefaultVectorStore(props) {
        const vectorStore = props.vectorStore;
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.AMAZON_AURORA,
        };
    }
    /**
     * Handle the default VectorStore type.
     *
     * @returns The instance of VectorCollection, VectorStoreType.
     * @internal This is an internal core function and should not be called directly.
     */
    handleOpenSearchDefaultVectorCollection() {
        const vectorStore = new opensearchserverless_1.VectorCollection(this, 'KBVectors');
        vectorStore.grantDataAccess(this.role);
        return {
            vectorStore: vectorStore,
            vectorStoreType: VectorStoreType.OPENSEARCH_SERVERLESS,
        };
    }
}
exports.KnowledgeBase = KnowledgeBase;
_a = JSII_RTTI_SYMBOL_1;
KnowledgeBase[_a] = { fqn: "@cdklabs/generative-ai-cdk-constructs.bedrock.KnowledgeBase", version: "0.1.122" };
/**
 * Validate that Bedrock Knowledge Base can use the selected model.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateModel(foundationModel) {
    if (!foundationModel.supportsKnowledgeBase) {
        throw new Error(`The model ${foundationModel} is not supported by Bedrock Knowledge Base.`);
    }
}
/**
 * Validate if VectorIndex was provided for a VectorStore of type
 * other than `VectorCollection`.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateVectorIndex(vectorStore, vectorIndex, vectorField, indexName) {
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorIndex) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorIndex should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && indexName) {
        throw new Error('If vectorStore is not of type VectorCollection, indexName should not be provided ' +
            'in KnowledgeBase construct.');
    }
    if (!(vectorStore instanceof opensearchserverless_1.VectorCollection) && vectorField) {
        throw new Error('If vectorStore is not of type VectorCollection, vectorField should not be provided ' +
            'in KnowledgeBase construct.');
    }
}
/**
 * Validate that indexName and vectorField parameters are identical
 * in KnowledgeBase construct if VectorIndex was created manually.
 *
 * By default we assign `vectorIndex` to `bedrock-knowledge-base-default-index`
 * value and if user provides `vectorIndex` manually, we need to make sure
 * they also provide it in KnowledgeBase construct if the value is not
 * `bedrock-knowledge-base-default-index`. Same for vectorField.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function validateIndexParameters(vectorIndex, indexName, vectorField) {
    if (vectorIndex.indexName !== 'bedrock-knowledge-base-default-index') {
        if (vectorIndex.indexName !== indexName) {
            throw new Error('Default value of indexName is `bedrock-knowledge-base-default-index`.' +
                ' If you create VectorIndex manually and assign vectorIndex to value other than' +
                ' `bedrock-knowledge-base-default-index` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-index`' +
                ' then do not assign indexName in KnowledgeBase construct.');
        }
    }
    if (vectorIndex.vectorField !== 'bedrock-knowledge-base-default-vector') {
        if (vectorIndex.vectorField !== vectorField) {
            throw new Error('Default value of vectorField is `bedrock-knowledge-base-default-vector`.' +
                ' If you create VectorIndex manually and assign vectorField to value other than' +
                ' `bedrock-knowledge-base-default-field` then you must provide the same value in KnowledgeBase construct.' +
                ' If you created VectorIndex manually and set it to `bedrock-knowledge-base-default-vector`' +
                ' then do not assign vectorField in KnowledgeBase construct.');
        }
    }
}
/**
 * Determine storage configuration based on vector store type.
 *
 * @internal This is an internal core function and should not be called directly.
 */
function getStorageConfiguration(params) {
    switch (params.vectorStoreType) {
        case VectorStoreType.OPENSEARCH_SERVERLESS:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.OPENSEARCH_SERVERLESS,
                opensearchServerlessConfiguration: {
                    collectionArn: params.vectorStore.collectionArn,
                    vectorIndexName: params.indexName,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.REDIS_ENTERPRISE_CLOUD:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.REDIS_ENTERPRISE_CLOUD,
                redisEnterpriseCloudConfiguration: {
                    endpoint: params.vectorStore.endpoint,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    vectorIndexName: params.indexName,
                    fieldMapping: {
                        vectorField: params.vectorField,
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.PINECONE:
            params.vectorStore = params.vectorStore;
            return {
                type: VectorStoreType.PINECONE,
                pineconeConfiguration: {
                    namespace: params.vectorStore.namespace || undefined,
                    connectionString: params.vectorStore.connectionString,
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    fieldMapping: {
                        textField: params.textField,
                        metadataField: params.metadataField,
                    },
                },
            };
        case VectorStoreType.AMAZON_AURORA:
            params.vectorStore = params.vectorStore instanceof amazonaurora_1.AmazonAuroraVectorStore ?
                params.vectorStore :
                params.vectorStore;
            return {
                type: VectorStoreType.AMAZON_AURORA,
                rdsConfiguration: {
                    credentialsSecretArn: params.vectorStore.credentialsSecretArn,
                    databaseName: params.vectorStore.databaseName,
                    resourceArn: params.vectorStore.resourceArn,
                    tableName: params.vectorStore.tableName,
                    fieldMapping: {
                        vectorField: params.vectorField.replace(/-/g, '_'),
                        primaryKeyField: params.vectorStore.primaryKeyField,
                        textField: params.textField.toLowerCase(),
                        metadataField: params.metadataField.toLowerCase(),
                    },
                },
            };
        default:
            throw new Error(`Unsupported vector store type: ${params.vectorStoreType}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia25vd2xlZGdlLWJhc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY2RrLWxpYi9iZWRyb2NrL2tub3dsZWRnZS1iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUE7Ozs7Ozs7Ozs7O0dBV0c7QUFFSCxtQ0FBbUM7QUFDbkMsMkNBQTJDO0FBQzNDLHFDQUEwQztBQUMxQywyQ0FBdUM7QUFDdkMseUVBQStEO0FBRS9ELHNEQUFvRTtBQUNwRSxrREFHeUI7QUFDekIsc0VBQXdEO0FBQ3hELGtFQUEyRDtBQUMzRCwwQ0FBa0Q7QUFDbEQsa0VBQXFFO0FBRXJFOzs7Ozs7OztHQVFHO0FBQ0gsSUFBSyxlQWlCSjtBQWpCRCxXQUFLLGVBQWU7SUFDbEI7O09BRUc7SUFDSCxrRUFBK0MsQ0FBQTtJQUMvQzs7T0FFRztJQUNILG9FQUFpRCxDQUFBO0lBQ2pEOztPQUVHO0lBQ0gsd0NBQXFCLENBQUE7SUFDckI7O09BRUc7SUFDSCx3Q0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBakJJLGVBQWUsS0FBZixlQUFlLFFBaUJuQjtBQTJHRDs7OztHQUlHO0FBQ0gsTUFBYSxhQUFjLFNBQVEsc0JBQVM7SUFrRDFDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBeUI7UUFDakUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQW5CbkI7O1dBRUc7UUFDYSxrQkFBYSxHQUMzQixJQUFJLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsK0JBQStCLENBQUMsQ0FBQztRQWdCckUsSUFBSSxDQUFDLFdBQVcsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFDO1FBQ3JDLE1BQU0sZUFBZSxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUM7UUFDOUMsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFNBQVMsSUFBSSxzQ0FBc0MsQ0FBQztRQUM1RSxNQUFNLFdBQVcsR0FBRyxLQUFL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QzdELFlBQVksRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLFlBQVk7b0JBQzdDLFdBQVcsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLFdBQVc7b0JBQzNDLFNBQVMsRUFBRSxNQUFNLENBQUMsV0FBVyxDQUFDLFNBQVM7b0JBQ3ZDLFlBQVksRUFBRTt3QkFDWixXQUFXLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQzt3QkFDbEQsZUFBZSxFQUFFLE1BQU0sQ0FBQyxXQUFXLENBQUMsZUFBZTt3QkFDbkQsU0FBUyxFQUFFLE1BQU0sQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFO3dCQUN6QyxhQUFhLEVBQUUsTUFBTSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUU7cUJBQ2xEO2lCQUNGO2FBQ0YsQ0FBQztRQUNKO1lBQ0UsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsTUFBTSxDQUFDLGVBQWUsRUFBRSxDQUFDLENBQUM7SUFDaEYsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqICBDb3B5cmlnaHQgQW1hem9uLmNvbSwgSW5jLiBvciBpdHMgYWZmaWxpYXRlcy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiAgTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKS4gWW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogIHdpdGggdGhlIExpY2Vuc2UuIEEgY29weSBvZiB0aGUgTGljZW5zZSBpcyBsb2NhdGVkIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiAgb3IgaW4gdGhlICdsaWNlbnNlJyBmaWxlIGFjY29tcGFueWluZyB0aGlzIGZpbGUuIFRoaXMgZmlsZSBpcyBkaXN0cmlidXRlZCBvbiBhbiAnQVMgSVMnIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVNcbiAqICBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xuICogIGFuZCBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0ICogYXMgaWFtIGZyb20gJ2F3cy1jZGstbGliL2F3cy1pYW0nO1xuaW1wb3J0IHsgTmFnU3VwcHJlc3Npb25zIH0gZnJvbSAnY2RrLW5hZyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEJlZHJvY2tDUlByb3ZpZGVyIH0gZnJvbSAnLi9jdXN0b20tcmVzb3VyY2UtcHJvdmlkZXInO1xuaW1wb3J0IHsgQmVkcm9ja0ZvdW5kYXRpb25Nb2RlbCB9IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIgfSBmcm9tICcuLi8uLi9jb21tb24vaGVscGVycy91dGlscyc7XG5pbXBvcnQge1xuICBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUsXG4gIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlLFxufSBmcm9tICcuLi9hbWF6b25hdXJvcmEnO1xuaW1wb3J0IHsgVmVjdG9ySW5kZXggfSBmcm9tICcuLi9vcGVuc2VhcmNoLXZlY3RvcmluZGV4JztcbmltcG9ydCB7IFZlY3RvckNvbGxlY3Rpb24gfSBmcm9tICcuLi9vcGVuc2VhcmNoc2VydmVybGVzcyc7XG5pbXBvcnQgeyBQaW5lY29uZVZlY3RvclN0b3JlIH0gZnJvbSAnLi4vcGluZWNvbmUnO1xuaW1wb3J0IHsgUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmUgfSBmcm9tICcuLi9yZWRpc2VudGVycHJpc2VjbG91ZCc7XG5cbi8qKlxuICogS25vd2xlZGdlIGJhc2UgY2FuIGJlIGJhY2tlZCBieSBkaWZmZXJlbnQgdmVjdG9yIGRhdGFiYXNlcy5cbiAqIFRoaXMgZW51bSByZXByZXNlbnRzIHRoZSBkaWZmZXJlbnQgdmVjdG9yIGRhdGFiYXNlcyB0aGF0IGNhbiBiZSB1c2VkLlxuICpcbiAqIGBPUEVOU0VBUkNIX1NFUlZFUkxFU1NgIGlzIHRoZSBkZWZhdWx0IHZlY3RvciBkYXRhYmFzZS5cbiAqIGBSRURJU19FTlRFUlBSSVNFX0NMT1VEYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBSZWRpcyBFbnRlcnByaXNlIENsb3VkLlxuICogYFBJTkVDT05FYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBQaW5lY29uZS5cbiAqIGBBTUFaT05fQVVST1JBYCBpcyB0aGUgdmVjdG9yIGRhdGFiYXNlIGZvciBBbWF6b24gQXVyb3JhIFBvc3RncmVTUUwuXG4gKi9cbmVudW0gVmVjdG9yU3RvcmVUeXBlIHtcbiAgLyoqXG4gICAqIGBPUEVOU0VBUkNIX1NFUlZFUkxFU1NgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIE9wZW5TZWFyY2ggU2VydmVybGVzcy5cbiAgICovXG4gIE9QRU5TRUFSQ0hfU0VSVkVSTEVTUyA9ICdPUEVOU0VBUkNIX1NFUlZFUkxFU1MnLFxuICAvKipcbiAgICogYFJFRElTX0VOVEVSUFJJU0VfQ0xPVURgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIFJlZGlzIEVudGVycHJpc2UgQ2xvdWQuXG4gICAqL1xuICBSRURJU19FTlRFUlBSSVNFX0NMT1VEID0gJ1JFRElTX0VOVEVSUFJJU0VfQ0xPVUQnLFxuICAvKipcbiAgICogYFBJTkVDT05FYCBpcyB0aGUgdmVjdG9yIHN0b3JlIGZvciBQaW5lY29uZS5cbiAgICovXG4gIFBJTkVDT05FID0gJ1BJTkVDT05FJyxcbiAgLyoqXG4gICAqIGBSRFNgIGlzIHRoZSB2ZWN0b3Igc3RvcmUgZm9yIEFtYXpvbiBBdXJvcmEuXG4gICAqL1xuICBBTUFaT05fQVVST1JBID0gJ1JEUycsXG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgc3RvcmFnZSBmb3Iga25vd2xlZGdlIGJhc2UuXG4gKi9cbmludGVyZmFjZSBTdG9yYWdlQ29uZmlndXJhdGlvbiB7XG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlLCB3aGljaCBjYW4gYmUgb2YgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBgUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmVgLCBgUGluZWNvbmVWZWN0b3JTdG9yZWAsXG4gICAqIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAgb3IgYEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZWBcbiAgICogdHlwZXMuXG4gICAqL1xuICB2ZWN0b3JTdG9yZTogVmVjdG9yQ29sbGVjdGlvbiB8IFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlIHxcbiAgUGluZWNvbmVWZWN0b3JTdG9yZSB8IEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZSB8IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlO1xuXG4gIC8qKlxuICAgKiBUaGUgdHlwZSBvZiB0aGUgdmVjdG9yIHN0b3JlLlxuICAgKi9cbiAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBpbmRleC5cbiAgICovXG4gIGluZGV4TmFtZTogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIHZlY3RvciBmaWVsZCBmb3IgdmVjdG9yIG1hcHBpbmcuXG4gICAqL1xuICB2ZWN0b3JGaWVsZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgZmllbGQgb2YgdGhlIHRleHQgZmllbGQgZm9yIHZlY3RvciBtYXBwaW5nLlxuICAgKi9cbiAgdGV4dEZpZWxkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBmaWVsZCBvZiB0aGUgbWV0YWRhdGEuXG4gICAqL1xuICBtZXRhZGF0YUZpZWxkOiBzdHJpbmc7XG59XG5cbi8qKlxuICogUHJvcGVydGllcyBmb3IgYSBrbm93bGVkZ2UgYmFzZVxuICovXG5leHBvcnQgaW50ZXJmYWNlIEtub3dsZWRnZUJhc2VQcm9wcyB7XG4gIC8qKlxuICAgKiBUaGUgZW1iZWRkaW5ncyBtb2RlbCBmb3IgdGhlIGtub3dsZWRnZSBiYXNlXG4gICAqL1xuICByZWFkb25seSBlbWJlZGRpbmdzTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWw7XG5cbiAgLyoqXG4gICAqIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gTm8gZGVzY3JpcHRpb24gcHJvdmlkZWQuXG4gICAqL1xuICByZWFkb25seSBkZXNjcmlwdGlvbj86IHN0cmluZztcblxuICAvKipcbiAgICogQSBuYXJyYXRpdmUgZGVzY3JpcHRpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKlxuICAgKiBBIEJlZHJvY2sgQWdlbnQgY2FuIHVzZSB0aGlzIGluc3RydWN0aW9uIHRvIGRldGVybWluZSBpZiBpdCBzaG91bGRcbiAgICogcXVlcnkgdGhpcyBLbm93bGVkZ2UgQmFzZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBObyBkZXNjcmlwdGlvbiBwcm92aWRlZC5cbiAgICovXG4gIHJlYWRvbmx5IGluc3RydWN0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgdmVjdG9yIGluZGV4LlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsXG4gICAqIGRvIG5vdCBpbmNsdWRlIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4J1xuICAgKi9cbiAgcmVhZG9ubHkgaW5kZXhOYW1lPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgbmFtZSBvZiB0aGUgZmllbGQgaW4gdGhlIHZlY3RvciBpbmRleC5cbiAgICogSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgYFZlY3RvckNvbGxlY3Rpb25gLFxuICAgKiBkbyBub3QgaW5jbHVkZSB0aGlzIHByb3BlcnR5IGFzIGl0IHdpbGwgdGhyb3cgZXJyb3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gJ2JlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3InXG4gICAqL1xuICByZWFkb25seSB2ZWN0b3JGaWVsZD86IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHZlY3RvciBzdG9yZSBmb3IgdGhlIGtub3dsZWRnZSBiYXNlLiBNdXN0IGJlIGVpdGhlciBvZlxuICAgKiB0eXBlIGBWZWN0b3JDb2xsZWN0aW9uYCwgYFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlYCxcbiAgICogYFBpbmVjb25lVmVjdG9yU3RvcmVgLCBgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmVgIG9yXG4gICAqIGBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmVgLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIEEgbmV3IE9wZW5TZWFyY2ggU2VydmVybGVzcyB2ZWN0b3IgY29sbGVjdGlvbiBpcyBjcmVhdGVkLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9yU3RvcmU/OiBWZWN0b3JDb2xsZWN0aW9uIHwgUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmUgfFxuICBQaW5lY29uZVZlY3RvclN0b3JlIHwgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgfCBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG5cbiAgLyoqXG4gICAqIFRoZSB2ZWN0b3IgaW5kZXggZm9yIHRoZSBPcGVuU2VhcmNoIFNlcnZlcmxlc3MgYmFja2VkIGtub3dsZWRnZSBiYXNlLlxuICAgKiBJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBgVmVjdG9yQ29sbGVjdGlvbmAsIGRvIG5vdCBpbmNsdWRlXG4gICAqIHRoaXMgcHJvcGVydHkgYXMgaXQgd2lsbCB0aHJvdyBlcnJvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBBIG5ldyB2ZWN0b3IgaW5kZXggaXMgY3JlYXRlZCBvbiB0aGUgVmVjdG9yIENvbGxlY3Rpb25cbiAgICogaWYgdmVjdG9yIHN0b3JlIGlzIG9mIGBWZWN0b3JDb2xsZWN0aW9uYCB0eXBlLlxuICAgKi9cbiAgcmVhZG9ubHkgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcbn1cblxuLyoqXG4gKiBEZXBsb3lzIGEgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBhbmQgY29uZmlndXJlcyBhIGJhY2tlbmQgYnkgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzLFxuICogUGluZWNvbmUsIFJlZGlzIEVudGVycHJpc2UgQ2xvdWQgb3IgQW1hem9uIEF1cm9yYSBQb3N0Z3JlU1FMLlxuICpcbiAqL1xuZXhwb3J0IGNsYXNzIEtub3dsZWRnZUJhc2UgZXh0ZW5kcyBDb25zdHJ1Y3QgaW1wbGVtZW50cyBjZGsuSVRhZ2dhYmxlVjIge1xuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogVGhlIHJvbGUgdGhlIEtub3dsZWRnZSBCYXNlIHVzZXMgdG8gYWNjZXNzIHRoZSB2ZWN0b3Igc3RvcmUgYW5kIGRhdGEgc291cmNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHJvbGU6IGlhbS5Sb2xlO1xuXG4gIC8qKlxuICAgKiBUaGUgdmVjdG9yIHN0b3JlIGZvciB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkgdmVjdG9yU3RvcmU6IFZlY3RvckNvbGxlY3Rpb24gfCBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZSB8XG4gIFBpbmVjb25lVmVjdG9yU3RvcmUgfCBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSB8IEFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZTtcblxuICAvKipcbiAgICogQSBuYXJyYXRpdmUgaW5zdHJ1Y3Rpb24gb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGluc3RydWN0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBUaGUgQVJOIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBrbm93bGVkZ2VCYXNlQXJuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRoZSBJRCBvZiB0aGUga25vd2xlZGdlIGJhc2UuXG4gICAqL1xuICBwdWJsaWMgcmVhZG9ubHkga25vd2xlZGdlQmFzZUlkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFRhZ01hbmFnZXIgZmFjaWxpdGF0ZXMgYSBjb21tb24gaW1wbGVtZW50YXRpb24gb2YgdGFnZ2luZyBmb3IgQ29uc3RydWN0c1xuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGNka1RhZ01hbmFnZXIgPVxuICAgIG5ldyBjZGsuVGFnTWFuYWdlcihjZGsuVGFnVHlwZS5NQVAsICdDdXN0b206OkJlZHJvY2stS25vd2xlZGdlQmFzZScpO1xuXG4gIC8qKlxuICAgKiBUaGUgT3BlblNlYXJjaCB2ZWN0b3IgaW5kZXggZm9yIHRoZSBrbm93bGVkZ2UgYmFzZS5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgdmVjdG9ySW5kZXg/OiBWZWN0b3JJbmRleDtcblxuICAvKipcbiAgICogVGhlIHR5cGUgb2YgdGhlIGtub3dsZWRnZSBiYXNlLlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgcHJpdmF0ZSB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZTtcblxuICBjb25zdHJ1Y3RvcihzY29wZTogQ29uc3RydWN0LCBpZDogc3RyaW5nLCBwcm9wczogS25vd2xlZGdlQmFzZVByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcbiAgICB0aGlzLmluc3RydWN0aW9uID0gcHJvcHMuaW5zdHJ1Y3Rpb247XG4gICAgY29uc3QgZW1iZWRkaW5nc01vZGVsID0gcHJvcHMuZW1iZWRkaW5nc01vZGVsO1xuICAgIGNvbnN0IGluZGV4TmFtZSA9IHByb3BzLmluZGV4TmFtZSA/PyAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4JztcbiAgICBjb25zdCB2ZWN0b3JGaWVsZCA9IHByb3BzLnZlY3RvckZpZWxkID8/ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtdmVjdG9yJztcbiAgICBjb25zdCB0ZXh0RmllbGQgPSAnQU1BWk9OX0JFRFJPQ0tfVEVYVF9DSFVOSyc7XG4gICAgY29uc3QgbWV0YWRhdGFGaWVsZCA9ICdBTUFaT05fQkVEUk9DS19NRVRBREFUQSc7XG5cbiAgICB2YWxpZGF0ZU1vZGVsKGVtYmVkZGluZ3NNb2RlbCk7XG4gICAgdmFsaWRhdGVWZWN0b3JJbmRleChwcm9wcy52ZWN0b3JTdG9yZSwgcHJvcHMudmVjdG9ySW5kZXgsIHByb3BzLnZlY3RvckZpZWxkLCBwcm9wcy5pbmRleE5hbWUpO1xuICAgIGlmIChwcm9wcy52ZWN0b3JJbmRleCkge1xuICAgICAgdmFsaWRhdGVJbmRleFBhcmFtZXRlcnMocHJvcHMudmVjdG9ySW5kZXgsIGluZGV4TmFtZSwgdmVjdG9yRmllbGQpO1xuICAgIH1cblxuICAgIHRoaXMubmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ0tCJyxcbiAgICAgIHsgbWF4TGVuZ3RoOiAzMiB9KTtcbiAgICBjb25zdCByb2xlTmFtZSA9IGdlbmVyYXRlUGh5c2ljYWxOYW1lVjIoXG4gICAgICB0aGlzLFxuICAgICAgJ0FtYXpvbkJlZHJvY2tFeGVjdXRpb25Sb2xlRm9yS25vd2xlZGdlQmFzZScsXG4gICAgICB7IG1heExlbmd0aDogNjQgfSk7XG4gICAgdGhpcy5yb2xlID0gbmV3IGlhbS5Sb2xlKHRoaXMsICdSb2xlJywge1xuICAgICAgcm9sZU5hbWU6IHJvbGVOYW1lLFxuICAgICAgYXNzdW1lZEJ5OiBuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpLFxuICAgIH0pO1xuICAgIHRoaXMucm9sZS5hc3N1bWVSb2xlUG9saWN5IS5hZGRTdGF0ZW1lbnRzKFxuICAgICAgbmV3IGlhbS5Qb2xpY3lTdGF0ZW1lbnQoe1xuICAgICAgICBhY3Rpb25zOiBbJ3N0czpBc3N1bWVSb2xlJ10sXG4gICAgICAgIHByaW5jaXBhbHM6IFtuZXcgaWFtLlNlcnZpY2VQcmluY2lwYWwoJ2JlZHJvY2suYW1hem9uYXdzLmNvbScpXSxcbiAgICAgICAgY29uZGl0aW9uczoge1xuICAgICAgICAgIFN0cmluZ0VxdWFsczoge1xuICAgICAgICAgICAgJ2F3czpTb3VyY2VBY2NvdW50JzogY2RrLlN0YWNrLm9mKHRoaXMpLmFjY291bnQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBBcm5MaWtlOiB7XG4gICAgICAgICAgICAnYXdzOlNvdXJjZUFybic6IGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICBzZXJ2aWNlOiAnYmVkcm9jaycsXG4gICAgICAgICAgICAgIHJlc291cmNlOiAna25vd2xlZGdlLWJhc2UnLFxuICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgYXJuRm9ybWF0OiBjZGsuQXJuRm9ybWF0LlNMQVNIX1JFU09VUkNFX05BTUUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgKTtcblxuICAgIHRoaXMucm9sZS5hZGRUb1BvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICBhY3Rpb25zOiBbJ2JlZHJvY2s6SW52b2tlTW9kZWwnXSxcbiAgICAgIHJlc291cmNlczogW2VtYmVkZGluZ3NNb2RlbC5hc0Fybih0aGlzKV0sXG4gICAgfSkpO1xuXG4gICAgLyoqXG4gICAgICogQ3JlYXRlIHRoZSB2ZWN0b3Igc3RvcmUgaWYgdGhlIHZlY3RvciBzdG9yZSB3YXMgcHJvdmlkZWQgYnkgdGhlIHVzZXIuXG4gICAgICogT3RoZXJ3aXNlIGNoZWNrIGFnYWludHMgYWxsIHBvc3NpYmxlIHZlY3RvciBkYXRhc3RvcmVzLlxuICAgICAqIElmIG5vbmUgd2FzIHByb3ZpZGVkIGNyZWF0ZSBkZWZhdWx0IE9wZW5TZWFyY2ggU2VydmVybGVzcyBDb2xsZWN0aW9uLlxuICAgICAqL1xuICAgIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlT3BlblNlYXJjaENvbGxlY3Rpb24ocHJvcHMpKTtcblxuICAgIH0gZWxzZSBpZiAocHJvcHMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZSkge1xuICAgICAgKHtcbiAgICAgICAgdmVjdG9yU3RvcmU6IHRoaXMudmVjdG9yU3RvcmUsXG4gICAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB9ID0gdGhpcy5oYW5kbGVSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZShwcm9wcykpO1xuXG4gICAgfSBlbHNlIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFBpbmVjb25lVmVjdG9yU3RvcmUpIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlUGluZWNvbmVWZWN0b3JTdG9yZShwcm9wcykpO1xuXG4gICAgfSBlbHNlIGlmIChwcm9wcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZUFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKHByb3BzKSk7XG5cbiAgICB9IGVsc2UgaWYgKHByb3BzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlKSB7XG4gICAgICAoe1xuICAgICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgICAgdmVjdG9yU3RvcmVUeXBlOiB0aGlzLnZlY3RvclN0b3JlVHlwZSxcbiAgICAgIH0gPSB0aGlzLmhhbmRsZUFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZShwcm9wcykpO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgICh7XG4gICAgICAgIHZlY3RvclN0b3JlOiB0aGlzLnZlY3RvclN0b3JlLFxuICAgICAgICB2ZWN0b3JTdG9yZVR5cGU6IHRoaXMudmVjdG9yU3RvcmVUeXBlLFxuICAgICAgfSA9IHRoaXMuaGFuZGxlT3BlblNlYXJjaERlZmF1bHRWZWN0b3JDb2xsZWN0aW9uKCkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgdG8gYWRkIGBzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZWAgdG8gdGhlIHJvbGVcbiAgICAgKiBvZiB0aGUga25vd2xlZGdlIGJhc2UgaWYgd2UgdXNlIGRhdGEgc291cmNlc1xuICAgICAqIG90aGVyIHRoYW4gT3BlblNlYXJjaCBTZXJ2ZXJsZXNzLlxuICAgICAqL1xuICAgIGlmICghKHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSkge1xuICAgICAgdGhpcy5yb2xlLmFkZFRvUG9saWN5KG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgYWN0aW9uczogWydzZWNyZXRzbWFuYWdlcjpHZXRTZWNyZXRWYWx1ZSddLFxuICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICB0aGlzLnZlY3RvclN0b3JlLmNyZWRlbnRpYWxzU2VjcmV0QXJuLFxuICAgICAgICBdLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFdlIG5lZWQgdG8gYWRkIGByZHMtZGF0YTpFeGVjdXRlU3RhdGVtZW50YCxcbiAgICAgKiBgcmRzLWRhdGE6QmF0Y2hFeGVjdXRlU3RhdGVtZW50YCBhbmRcbiAgICAgKiBgcmRzOkRlc2NyaWJlREJDbHVzdGVyc2AgdG8gdGhlIHJvbGVcbiAgICAgKiBvZiB0aGUga25vd2xlZGdlIGJhc2UgaWYgd2UgdXNlIEFtYXpvbiBBdXJvcmEgYXNcbiAgICAgKiBhIGRhdGEgc291cmNlLlxuICAgICAqL1xuICAgIGlmICh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlIHx8XG4gICAgICB0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpIHtcbiAgICAgIHRoaXMucm9sZS5hZGRUb1BvbGljeShuZXcgaWFtLlBvbGljeVN0YXRlbWVudCh7XG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAncmRzLWRhdGE6RXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgJ3Jkcy1kYXRhOkJhdGNoRXhlY3V0ZVN0YXRlbWVudCcsXG4gICAgICAgICAgJ3JkczpEZXNjcmliZURCQ2x1c3RlcnMnLFxuICAgICAgICBdLFxuICAgICAgICByZXNvdXJjZXM6IFtcbiAgICAgICAgICB0aGlzLnZlY3RvclN0b3JlLnJlc291cmNlQXJuLFxuICAgICAgICBdLFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSB0aGUgdmVjdG9yIGluZGV4IGlmIHRoZSB2ZWN0b3Igc3RvcmUgaXMgT3BlblNlYXJjaCBTZXJ2ZXJsZXNzXG4gICAgICogYW5kIGl0IHdhcyBub3QgcHJvdmlkZWQuIE90aGVyd2lzZSB1c2UgdGhlIHByb3ZpZGVkIHZlY3RvciBpbmRleC5cbiAgICAgKi9cbiAgICBpZiAodGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MpIHtcbiAgICAgIGlmICghcHJvcHMudmVjdG9ySW5kZXgpIHtcbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleCA9IG5ldyBWZWN0b3JJbmRleCh0aGlzLCAnS0JJbmRleCcsIHtcbiAgICAgICAgICBjb2xsZWN0aW9uOiB0aGlzLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb24sXG4gICAgICAgICAgaW5kZXhOYW1lLFxuICAgICAgICAgIHZlY3RvckZpZWxkLFxuICAgICAgICAgIHZlY3RvckRpbWVuc2lvbnM6IGVtYmVkZGluZ3NNb2RlbC52ZWN0b3JEaW1lbnNpb25zISxcbiAgICAgICAgICBtYXBwaW5nczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBtYXBwaW5nRmllbGQ6ICdBTUFaT05fQkVEUk9DS19URVhUX0NIVU5LJyxcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgZmlsdGVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIG1hcHBpbmdGaWVsZDogJ0FNQVpPTl9CRURST0NLX01FVEFEQVRBJyxcbiAgICAgICAgICAgICAgZGF0YVR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgZmlsdGVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMudmVjdG9ySW5kZXgubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMudmVjdG9yU3RvcmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy52ZWN0b3JJbmRleCA9IHByb3BzLnZlY3RvckluZGV4O1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBzdG9yYWdlIGNvbmZpZ3VyYWlvbi4gSWYgaXQgaXMgb2YgdHlwZSBvZlxuICAgICAqIGBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZWAgZ2V0IHRleHRGaWVsZCwgbWV0YWRhdGFGaWVsZCxcbiAgICAgKiB2ZWN0b3JGaWVsZCBmcm9tIHRoZSBhcmd1bWVudHMuIE90aGVyd2lzZSB1c2UgZGVmYXVsdCB2YWx1ZXMuXG4gICAgICovXG4gICAgY29uc3Qgc3RvcmFnZUNvbmZpZ3VyYXRpb246IFN0b3JhZ2VDb25maWd1cmF0aW9uID0ge1xuICAgICAgaW5kZXhOYW1lOiBpbmRleE5hbWUsXG4gICAgICB2ZWN0b3JTdG9yZTogdGhpcy52ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogdGhpcy52ZWN0b3JTdG9yZVR5cGUsXG4gICAgICB2ZWN0b3JGaWVsZDogKHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSkgP1xuICAgICAgICB0aGlzLnZlY3RvclN0b3JlLnZlY3RvckZpZWxkIDogdmVjdG9yRmllbGQsXG4gICAgICB0ZXh0RmllbGQ6ICh0aGlzLnZlY3RvclN0b3JlIGluc3RhbmNlb2YgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUpID9cbiAgICAgICAgdGhpcy52ZWN0b3JTdG9yZS50ZXh0RmllbGQgOiB0ZXh0RmllbGQsXG4gICAgICBtZXRhZGF0YUZpZWxkOiAodGhpcy52ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlKSA/XG4gICAgICAgIHRoaXMudmVjdG9yU3RvcmUubWV0YWRhdGFGaWVsZCA6IG1ldGFkYXRhRmllbGQsXG4gICAgfTtcblxuICAgIGNvbnN0IGNyUHJvdmlkZXIgPSBCZWRyb2NrQ1JQcm92aWRlci5nZXRQcm92aWRlcih0aGlzKTtcbiAgICBjb25zdCBrbm93bGVkZ2VCYXNlID0gbmV3IGNkay5DdXN0b21SZXNvdXJjZSh0aGlzLCAnS0InLCB7XG4gICAgICBzZXJ2aWNlVG9rZW46IGNyUHJvdmlkZXIuc2VydmljZVRva2VuLFxuICAgICAgcmVzb3VyY2VUeXBlOiAnQ3VzdG9tOjpCZWRyb2NrLUtub3dsZWRnZUJhc2UnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICBrbm93bGVkZ2VCYXNlQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIHR5cGU6ICdWRUNUT1InLFxuICAgICAgICAgIHZlY3Rvcktub3dsZWRnZUJhc2VDb25maWd1cmF0aW9uOiB7XG4gICAgICAgICAgICBlbWJlZGRpbmdNb2RlbEFybjogZW1iZWRkaW5nc01vZGVsLmFzQXJuKHRoaXMpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHJvbGVBcm46IHRoaXMucm9sZS5yb2xlQXJuLFxuICAgICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBwcm9wcy5kZXNjcmlwdGlvbixcbiAgICAgICAgc3RvcmFnZUNvbmZpZ3VyYXRpb246IGdldFN0b3JhZ2VDb25maWd1cmF0aW9uKHN0b3JhZ2VDb25maWd1cmF0aW9uKSxcbiAgICAgICAgdGFnczogdGhpcy5jZGtUYWdNYW5hZ2VyLnJlbmRlcmVkVGFncyxcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICBjb25zdCBrYkNSUG9saWN5ID0gbmV3IGlhbS5Qb2xpY3kodGhpcywgJ0tCQ1JQb2xpY3knLCB7XG4gICAgICByb2xlczogW2NyUHJvdmlkZXIucm9sZV0sXG4gICAgICBzdGF0ZW1lbnRzOiBbXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbXG4gICAgICAgICAgICAnYmVkcm9jazpDcmVhdGVLbm93bGVkZ2VCYXNlJyxcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgbmVlZCB0byBhZGQgYGJlZHJvY2s6QXNzb2NpYXRlVGhpcmRQYXJ0eUtub3dsZWRnZUJhc2VgIGlmXG4gICAgICAgICAgICAgKiB3ZSBhcmUgZGVwbG95aW5nIFJlZGlzIG9yIFBpbmVjb25lIGRhdGEgc291cmNlc1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAuLi4odGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5SRURJU19FTlRFUlBSSVNFX0NMT1VEIHx8XG4gICAgICAgICAgICAgICAgdGhpcy52ZWN0b3JTdG9yZVR5cGUgPT09IFZlY3RvclN0b3JlVHlwZS5QSU5FQ09ORSA/XG4gICAgICAgICAgICAgIFsnYmVkcm9jazpBc3NvY2lhdGVUaGlyZFBhcnR5S25vd2xlZGdlQmFzZSddIDogW10pLFxuICAgICAgICAgIF0sXG4gICAgICAgICAgcmVzb3VyY2VzOiBbJyonXSxcbiAgICAgICAgfSksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICAgICAgJ2JlZHJvY2s6VXBkYXRlS25vd2xlZGdlQmFzZScsXG4gICAgICAgICAgICAgICdiZWRyb2NrOkRlbGV0ZUtub3dsZWRnZUJhc2UnLFxuICAgICAgICAgICAgICAnYmVkcm9jazpUYWdSZXNvdXJjZScsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgcmVzb3VyY2VzOiBbXG4gICAgICAgICAgICAgIGNkay5TdGFjay5vZih0aGlzKS5mb3JtYXRBcm4oe1xuICAgICAgICAgICAgICAgIHNlcnZpY2U6ICdiZWRyb2NrJyxcbiAgICAgICAgICAgICAgICByZXNvdXJjZTogJ2tub3dsZWRnZS1iYXNlJyxcbiAgICAgICAgICAgICAgICByZXNvdXJjZU5hbWU6ICcqJyxcbiAgICAgICAgICAgICAgICBhcm5Gb3JtYXQ6IGNkay5Bcm5Gb3JtYXQuU0xBU0hfUkVTT1VSQ0VfTkFNRSxcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICBdLFxuICAgICAgICAgIH0sXG4gICAgICAgICksXG4gICAgICAgIG5ldyBpYW0uUG9saWN5U3RhdGVtZW50KFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGFjdGlvbnM6IFsnaWFtOlBhc3NSb2xlJ10sXG4gICAgICAgICAgICByZXNvdXJjZXM6IFt0aGlzLnJvbGUucm9sZUFybl0sXG4gICAgICAgICAgfSxcbiAgICAgICAgKSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICBrbm93bGVkZ2VCYXNlLm5vZGUuYWRkRGVwZW5kZW5jeSh0aGlzLnJvbGUpO1xuICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KGtiQ1JQb2xpY3kpO1xuICAgIGlmICh0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLk9QRU5TRUFSQ0hfU0VSVkVSTEVTUyAmJlxuICAgICAgdGhpcy52ZWN0b3JJbmRleCkge1xuICAgICAga25vd2xlZGdlQmFzZS5ub2RlLmFkZERlcGVuZGVuY3kodGhpcy52ZWN0b3JJbmRleCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnZlY3RvclN0b3JlVHlwZSA9PT0gVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkEgJiZcbiAgICAgIHRoaXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUpIHtcbiAgICAgIGtub3dsZWRnZUJhc2Uubm9kZS5hZGREZXBlbmRlbmN5KHRoaXMudmVjdG9yU3RvcmUpO1xuICAgIH1cblxuICAgIE5hZ1N1cHByZXNzaW9ucy5hZGRSZXNvdXJjZVN1cHByZXNzaW9ucyhcbiAgICAgIGtiQ1JQb2xpY3ksXG4gICAgICBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogJ0F3c1NvbHV0aW9ucy1JQU01JyxcbiAgICAgICAgICByZWFzb246IFwiQmVkcm9jayBDcmVhdGVLbm93bGVkZ2VCYXNlIGNhbid0IGJlIHJlc3RyaWN0ZWQgYnkgcmVzb3VyY2UuXCIsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdHJ1ZSxcbiAgICApO1xuXG4gICAgdGhpcy5rbm93bGVkZ2VCYXNlQXJuID0ga25vd2xlZGdlQmFzZS5nZXRBdHRTdHJpbmcoJ2tub3dsZWRnZUJhc2VBcm4nKTtcbiAgICB0aGlzLmtub3dsZWRnZUJhc2VJZCA9IGtub3dsZWRnZUJhc2UuZ2V0QXR0U3RyaW5nKCdrbm93bGVkZ2VCYXNlSWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgVmVjdG9yQ29sbGVjdGlvbiB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICAgKlxuICAgKiBAcGFyYW0gcHJvcHMgLSBUaGUgcHJvcGVydGllcyBvZiB0aGUgS25vd2xlZGdlQmFzZS5cbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFZlY3RvckNvbGxlY3Rpb24sIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hDb2xsZWN0aW9uKFxuICAgIHByb3BzOiBLbm93bGVkZ2VCYXNlUHJvcHMsXG4gICk6IHtcbiAgICAgIHZlY3RvclN0b3JlOiBWZWN0b3JDb2xsZWN0aW9uO1xuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gICAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBWZWN0b3JDb2xsZWN0aW9uO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmUgdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZSwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlUmVkaXNFbnRlcnByaXNlVmVjdG9yU3RvcmUoXG4gICAgcHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyxcbiAgKToge1xuICAgICAgdmVjdG9yU3RvcmU6IFJlZGlzRW50ZXJwcmlzZVZlY3RvclN0b3JlO1xuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gICAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuUkVESVNfRU5URVJQUklTRV9DTE9VRCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gKiBIYW5kbGUgUGluZWNvbmVWZWN0b3JTdG9yZSB0eXBlIG9mIFZlY3RvclN0b3JlLlxuICpcbiAqIEBwYXJhbSBwcm9wcyAtIFRoZSBwcm9wZXJ0aWVzIG9mIHRoZSBLbm93bGVkZ2VCYXNlLlxuICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFBpbmVjb25lVmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG4gIHByaXZhdGUgaGFuZGxlUGluZWNvbmVWZWN0b3JTdG9yZShcbiAgICBwcm9wczogS25vd2xlZGdlQmFzZVByb3BzLFxuICApOiB7XG4gICAgICB2ZWN0b3JTdG9yZTogUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlO1xuICAgIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gcHJvcHMudmVjdG9yU3RvcmUgYXMgUGluZWNvbmVWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkUsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUgdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSwgVmVjdG9yU3RvcmVUeXBlLlxuICAgKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAgICovXG4gIHByaXZhdGUgaGFuZGxlQW1hem9uQXVyb3JhVmVjdG9yU3RvcmUoXG4gICAgcHJvcHM6IEtub3dsZWRnZUJhc2VQcm9wcyxcbiAgKToge1xuICAgICAgdmVjdG9yU3RvcmU6IEFtYXpvbkF1cm9yYVZlY3RvclN0b3JlO1xuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gICAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZTtcbiAgICByZXR1cm4ge1xuICAgICAgdmVjdG9yU3RvcmU6IHZlY3RvclN0b3JlLFxuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZSBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUgdHlwZSBvZiBWZWN0b3JTdG9yZS5cbiAgICpcbiAgICogQHBhcmFtIHByb3BzIC0gVGhlIHByb3BlcnRpZXMgb2YgdGhlIEtub3dsZWRnZUJhc2UuXG4gICAqIEByZXR1cm5zIFRoZSBpbnN0YW5jZSBvZiBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmUsIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZUFtYXpvbkF1cm9yYURlZmF1bHRWZWN0b3JTdG9yZShcbiAgICBwcm9wczogS25vd2xlZGdlQmFzZVByb3BzLFxuICApOiB7XG4gICAgICB2ZWN0b3JTdG9yZTogQW1hem9uQXVyb3JhRGVmYXVsdFZlY3RvclN0b3JlO1xuICAgICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gICAgfSB7XG4gICAgY29uc3QgdmVjdG9yU3RvcmUgPSBwcm9wcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlY3RvclN0b3JlOiB2ZWN0b3JTdG9yZSxcbiAgICAgIHZlY3RvclN0b3JlVHlwZTogVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkEsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdGhlIGRlZmF1bHQgVmVjdG9yU3RvcmUgdHlwZS5cbiAgICpcbiAgICogQHJldHVybnMgVGhlIGluc3RhbmNlIG9mIFZlY3RvckNvbGxlY3Rpb24sIFZlY3RvclN0b3JlVHlwZS5cbiAgICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gICAqL1xuICBwcml2YXRlIGhhbmRsZU9wZW5TZWFyY2hEZWZhdWx0VmVjdG9yQ29sbGVjdGlvbigpOlxuICB7XG4gICAgdmVjdG9yU3RvcmU6IFZlY3RvckNvbGxlY3Rpb247XG4gICAgdmVjdG9yU3RvcmVUeXBlOiBWZWN0b3JTdG9yZVR5cGU7XG4gIH0ge1xuICAgIGNvbnN0IHZlY3RvclN0b3JlID0gbmV3IFZlY3RvckNvbGxlY3Rpb24odGhpcywgJ0tCVmVjdG9ycycpO1xuICAgIHZlY3RvclN0b3JlLmdyYW50RGF0YUFjY2Vzcyh0aGlzLnJvbGUpO1xuICAgIHJldHVybiB7XG4gICAgICB2ZWN0b3JTdG9yZTogdmVjdG9yU3RvcmUsXG4gICAgICB2ZWN0b3JTdG9yZVR5cGU6IFZlY3RvclN0b3JlVHlwZS5PUEVOU0VBUkNIX1NFUlZFUkxFU1MsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgQmVkcm9jayBLbm93bGVkZ2UgQmFzZSBjYW4gdXNlIHRoZSBzZWxlY3RlZCBtb2RlbC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVNb2RlbChmb3VuZGF0aW9uTW9kZWw6IEJlZHJvY2tGb3VuZGF0aW9uTW9kZWwpIHtcbiAgaWYgKCFmb3VuZGF0aW9uTW9kZWwuc3VwcG9ydHNLbm93bGVkZ2VCYXNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgbW9kZWwgJHtmb3VuZGF0aW9uTW9kZWx9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgQmVkcm9jayBLbm93bGVkZ2UgQmFzZS5gKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIGlmIFZlY3RvckluZGV4IHdhcyBwcm92aWRlZCBmb3IgYSBWZWN0b3JTdG9yZSBvZiB0eXBlXG4gKiBvdGhlciB0aGFuIGBWZWN0b3JDb2xsZWN0aW9uYC5cbiAqXG4gKiBAaW50ZXJuYWwgVGhpcyBpcyBhbiBpbnRlcm5hbCBjb3JlIGZ1bmN0aW9uIGFuZCBzaG91bGQgbm90IGJlIGNhbGxlZCBkaXJlY3RseS5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVWZWN0b3JJbmRleChcbiAgdmVjdG9yU3RvcmU6IGFueSxcbiAgdmVjdG9ySW5kZXg6IGFueSxcbiAgdmVjdG9yRmllbGQ6IGFueSxcbiAgaW5kZXhOYW1lOiBhbnksXG4pIHtcbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiB2ZWN0b3JJbmRleCkge1xuICAgIHRocm93IG5ldyBFcnJvcignSWYgdmVjdG9yU3RvcmUgaXMgbm90IG9mIHR5cGUgVmVjdG9yQ29sbGVjdGlvbiwgdmVjdG9ySW5kZXggc2hvdWxkIG5vdCBiZSBwcm92aWRlZCAnICtcbiAgICAnaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyk7XG4gIH1cbiAgaWYgKCEodmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBWZWN0b3JDb2xsZWN0aW9uKSAmJiBpbmRleE5hbWUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0lmIHZlY3RvclN0b3JlIGlzIG5vdCBvZiB0eXBlIFZlY3RvckNvbGxlY3Rpb24sIGluZGV4TmFtZSBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nKTtcbiAgfVxuICBpZiAoISh2ZWN0b3JTdG9yZSBpbnN0YW5jZW9mIFZlY3RvckNvbGxlY3Rpb24pICYmIHZlY3RvckZpZWxkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdJZiB2ZWN0b3JTdG9yZSBpcyBub3Qgb2YgdHlwZSBWZWN0b3JDb2xsZWN0aW9uLCB2ZWN0b3JGaWVsZCBzaG91bGQgbm90IGJlIHByb3ZpZGVkICcgK1xuICAgICdpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nKTtcbiAgfVxufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgaW5kZXhOYW1lIGFuZCB2ZWN0b3JGaWVsZCBwYXJhbWV0ZXJzIGFyZSBpZGVudGljYWxcbiAqIGluIEtub3dsZWRnZUJhc2UgY29uc3RydWN0IGlmIFZlY3RvckluZGV4IHdhcyBjcmVhdGVkIG1hbnVhbGx5LlxuICpcbiAqIEJ5IGRlZmF1bHQgd2UgYXNzaWduIGB2ZWN0b3JJbmRleGAgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGBcbiAqIHZhbHVlIGFuZCBpZiB1c2VyIHByb3ZpZGVzIGB2ZWN0b3JJbmRleGAgbWFudWFsbHksIHdlIG5lZWQgdG8gbWFrZSBzdXJlXG4gKiB0aGV5IGFsc28gcHJvdmlkZSBpdCBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdCBpZiB0aGUgdmFsdWUgaXMgbm90XG4gKiBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YC4gU2FtZSBmb3IgdmVjdG9yRmllbGQuXG4gKlxuICogQGludGVybmFsIFRoaXMgaXMgYW4gaW50ZXJuYWwgY29yZSBmdW5jdGlvbiBhbmQgc2hvdWxkIG5vdCBiZSBjYWxsZWQgZGlyZWN0bHkuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlSW5kZXhQYXJhbWV0ZXJzKFxuICB2ZWN0b3JJbmRleDogVmVjdG9ySW5kZXgsXG4gIGluZGV4TmFtZTogc3RyaW5nLFxuICB2ZWN0b3JGaWVsZDogc3RyaW5nLFxuKSB7XG4gIGlmICh2ZWN0b3JJbmRleC5pbmRleE5hbWUgIT09ICdiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXgnKSB7XG4gICAgaWYgKHZlY3RvckluZGV4LmluZGV4TmFtZSAhPT0gaW5kZXhOYW1lKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RlZmF1bHQgdmFsdWUgb2YgaW5kZXhOYW1lIGlzIGBiZWRyb2NrLWtub3dsZWRnZS1iYXNlLWRlZmF1bHQtaW5kZXhgLicgK1xuICAgICAgJyBJZiB5b3UgY3JlYXRlIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBhc3NpZ24gdmVjdG9ySW5kZXggdG8gdmFsdWUgb3RoZXIgdGhhbicgK1xuICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWluZGV4YCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC1pbmRleGAnICtcbiAgICAgICcgdGhlbiBkbyBub3QgYXNzaWduIGluZGV4TmFtZSBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nKTtcbiAgICB9XG4gIH1cbiAgaWYgKHZlY3RvckluZGV4LnZlY3RvckZpZWxkICE9PSAnYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LXZlY3RvcicpIHtcbiAgICBpZiAodmVjdG9ySW5kZXgudmVjdG9yRmllbGQgIT09IHZlY3RvckZpZWxkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0RlZmF1bHQgdmFsdWUgb2YgdmVjdG9yRmllbGQgaXMgYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgLicgK1xuICAgICAgJyBJZiB5b3UgY3JlYXRlIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBhc3NpZ24gdmVjdG9yRmllbGQgdG8gdmFsdWUgb3RoZXIgdGhhbicgK1xuICAgICAgJyBgYmVkcm9jay1rbm93bGVkZ2UtYmFzZS1kZWZhdWx0LWZpZWxkYCB0aGVuIHlvdSBtdXN0IHByb3ZpZGUgdGhlIHNhbWUgdmFsdWUgaW4gS25vd2xlZGdlQmFzZSBjb25zdHJ1Y3QuJyArXG4gICAgICAnIElmIHlvdSBjcmVhdGVkIFZlY3RvckluZGV4IG1hbnVhbGx5IGFuZCBzZXQgaXQgdG8gYGJlZHJvY2sta25vd2xlZGdlLWJhc2UtZGVmYXVsdC12ZWN0b3JgJyArXG4gICAgICAnIHRoZW4gZG8gbm90IGFzc2lnbiB2ZWN0b3JGaWVsZCBpbiBLbm93bGVkZ2VCYXNlIGNvbnN0cnVjdC4nKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBEZXRlcm1pbmUgc3RvcmFnZSBjb25maWd1cmF0aW9uIGJhc2VkIG9uIHZlY3RvciBzdG9yZSB0eXBlLlxuICpcbiAqIEBpbnRlcm5hbCBUaGlzIGlzIGFuIGludGVybmFsIGNvcmUgZnVuY3Rpb24gYW5kIHNob3VsZCBub3QgYmUgY2FsbGVkIGRpcmVjdGx5LlxuICovXG5mdW5jdGlvbiBnZXRTdG9yYWdlQ29uZmlndXJhdGlvbihwYXJhbXM6IFN0b3JhZ2VDb25maWd1cmF0aW9uKTogYW55IHtcbiAgc3dpdGNoIChwYXJhbXMudmVjdG9yU3RvcmVUeXBlKSB7XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIFZlY3RvckNvbGxlY3Rpb247XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuT1BFTlNFQVJDSF9TRVJWRVJMRVNTLFxuICAgICAgICBvcGVuc2VhcmNoU2VydmVybGVzc0NvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBjb2xsZWN0aW9uQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY29sbGVjdGlvbkFybixcbiAgICAgICAgICB2ZWN0b3JJbmRleE5hbWU6IHBhcmFtcy5pbmRleE5hbWUsXG4gICAgICAgICAgZmllbGRNYXBwaW5nOiB7XG4gICAgICAgICAgICB2ZWN0b3JGaWVsZDogcGFyYW1zLnZlY3RvckZpZWxkLFxuICAgICAgICAgICAgdGV4dEZpZWxkOiBwYXJhbXMudGV4dEZpZWxkLFxuICAgICAgICAgICAgbWV0YWRhdGFGaWVsZDogcGFyYW1zLm1ldGFkYXRhRmllbGQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgY2FzZSBWZWN0b3JTdG9yZVR5cGUuUkVESVNfRU5URVJQUklTRV9DTE9VRDpcbiAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSA9IHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBSZWRpc0VudGVycHJpc2VWZWN0b3JTdG9yZTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFZlY3RvclN0b3JlVHlwZS5SRURJU19FTlRFUlBSSVNFX0NMT1VELFxuICAgICAgICByZWRpc0VudGVycHJpc2VDbG91ZENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgICBlbmRwb2ludDogcGFyYW1zLnZlY3RvclN0b3JlLmVuZHBvaW50LFxuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgdmVjdG9ySW5kZXhOYW1lOiBwYXJhbXMuaW5kZXhOYW1lLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZCxcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLlBJTkVDT05FOlxuICAgICAgcGFyYW1zLnZlY3RvclN0b3JlID0gcGFyYW1zLnZlY3RvclN0b3JlIGFzIFBpbmVjb25lVmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuUElORUNPTkUsXG4gICAgICAgIHBpbmVjb25lQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIG5hbWVzcGFjZTogcGFyYW1zLnZlY3RvclN0b3JlLm5hbWVzcGFjZSB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgY29ubmVjdGlvblN0cmluZzogcGFyYW1zLnZlY3RvclN0b3JlLmNvbm5lY3Rpb25TdHJpbmcsXG4gICAgICAgICAgY3JlZGVudGlhbHNTZWNyZXRBcm46IHBhcmFtcy52ZWN0b3JTdG9yZS5jcmVkZW50aWFsc1NlY3JldEFybixcbiAgICAgICAgICBmaWVsZE1hcHBpbmc6IHtcbiAgICAgICAgICAgIHRleHRGaWVsZDogcGFyYW1zLnRleHRGaWVsZCxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIGNhc2UgVmVjdG9yU3RvcmVUeXBlLkFNQVpPTl9BVVJPUkE6XG4gICAgICBwYXJhbXMudmVjdG9yU3RvcmUgPSBwYXJhbXMudmVjdG9yU3RvcmUgaW5zdGFuY2VvZiBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSA/XG4gICAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFWZWN0b3JTdG9yZSA6XG4gICAgICAgIHBhcmFtcy52ZWN0b3JTdG9yZSBhcyBBbWF6b25BdXJvcmFEZWZhdWx0VmVjdG9yU3RvcmU7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBWZWN0b3JTdG9yZVR5cGUuQU1BWk9OX0FVUk9SQSxcbiAgICAgICAgcmRzQ29uZmlndXJhdGlvbjoge1xuICAgICAgICAgIGNyZWRlbnRpYWxzU2VjcmV0QXJuOiBwYXJhbXMudmVjdG9yU3RvcmUuY3JlZGVudGlhbHNTZWNyZXRBcm4sXG4gICAgICAgICAgZGF0YWJhc2VOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUuZGF0YWJhc2VOYW1lLFxuICAgICAgICAgIHJlc291cmNlQXJuOiBwYXJhbXMudmVjdG9yU3RvcmUucmVzb3VyY2VBcm4sXG4gICAgICAgICAgdGFibGVOYW1lOiBwYXJhbXMudmVjdG9yU3RvcmUudGFibGVOYW1lLFxuICAgICAgICAgIGZpZWxkTWFwcGluZzoge1xuICAgICAgICAgICAgdmVjdG9yRmllbGQ6IHBhcmFtcy52ZWN0b3JGaWVsZC5yZXBsYWNlKC8tL2csICdfJyksXG4gICAgICAgICAgICBwcmltYXJ5S2V5RmllbGQ6IHBhcmFtcy52ZWN0b3JTdG9yZS5wcmltYXJ5S2V5RmllbGQsXG4gICAgICAgICAgICB0ZXh0RmllbGQ6IHBhcmFtcy50ZXh0RmllbGQudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIG1ldGFkYXRhRmllbGQ6IHBhcmFtcy5tZXRhZGF0YUZpZWxkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgZGVmYXVsdDpcbiAgICAgIHRocm93IG5ldyBFcnJvcihgVW5zdXBwb3J0ZWQgdmVjdG9yIHN0b3JlIHR5cGU6ICR7cGFyYW1zLnZlY3RvclN0b3JlVHlwZX1gKTtcbiAgfVxufSJdfQ==