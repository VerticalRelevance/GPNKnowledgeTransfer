"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RagAppsyncStepfnKendra = void 0;
/**
 *  Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License"). You may not use this file except in compliance
 *  with the License. A copy of the License is located at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  or in the 'license' file accompanying this file. This file is distributed on an 'AS IS' BASIS, WITHOUT WARRANTIES
 *  OR CONDITIONS OF ANY KIND, express or implied. See the License for the specific language governing permissions
 *  and limitations under the License.
 */
const path = require("path");
const cdk = require("aws-cdk-lib");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const appsync = require("aws-cdk-lib/aws-appsync");
const ec2 = require("aws-cdk-lib/aws-ec2");
const aws_iam_1 = require("aws-cdk-lib/aws-iam");
const lambda = require("aws-cdk-lib/aws-lambda");
const logs = require("aws-cdk-lib/aws-logs");
const aws_s3_1 = require("aws-cdk-lib/aws-s3");
const custom_resources_1 = require("aws-cdk-lib/custom-resources");
const base_class_1 = require("../../../common/base-class");
const dynamodb_helper_1 = require("../../../common/helpers/dynamodb-helper");
const kendra_construct_1 = require("../../../common/helpers/kendra-construct");
const kendra_helper_1 = require("../../../common/helpers/kendra-helper");
const lambda_builder_helper_1 = require("../../../common/helpers/lambda-builder-helper");
const utils_1 = require("../../../common/helpers/utils");
const vpc_helper_1 = require("../../../common/helpers/vpc-helper");
var ServiceEndpointTypeEnum;
(function (ServiceEndpointTypeEnum) {
    ServiceEndpointTypeEnum["DYNAMODB"] = "DDB";
    ServiceEndpointTypeEnum["ECR_API"] = "ECR_API";
    ServiceEndpointTypeEnum["ECR_DKR"] = "ECR_DKR";
    ServiceEndpointTypeEnum["EVENTS"] = "CLOUDWATCH_EVENTS";
    ServiceEndpointTypeEnum["KENDRA"] = "KENDRA";
    ServiceEndpointTypeEnum["KINESIS_FIREHOSE"] = "KINESIS_FIREHOSE";
    ServiceEndpointTypeEnum["KINESIS_STREAMS"] = "KINESIS_STREAMS";
    ServiceEndpointTypeEnum["S3"] = "S3";
    ServiceEndpointTypeEnum["SAGEMAKER_RUNTIME"] = "SAGEMAKER_RUNTIME";
    ServiceEndpointTypeEnum["SECRETS_MANAGER"] = "SECRETS_MANAGER";
    ServiceEndpointTypeEnum["SNS"] = "SNS";
    ServiceEndpointTypeEnum["SQS"] = "SQS";
    ServiceEndpointTypeEnum["SSM"] = "SSM";
    ServiceEndpointTypeEnum["STEP_FUNCTIONS"] = "STEP_FUNCTIONS";
})(ServiceEndpointTypeEnum || (ServiceEndpointTypeEnum = {}));
/**
 * @summary The RagAppsyncStepfnKendra class.
 */
class RagAppsyncStepfnKendra extends base_class_1.BaseClass {
    /**
       * @summary Constructs a new instance of the RagAppsyncStepfnKendra class.
       * @param {cdk.App} scope - represents the scope for all the resources.
       * @param {string} id - this is a scope-unique id.
       * @param {RagAppsyncStepfnKendraProps} props - user provided props for the construct.
       * @since 0.0.0
       * @access public
     */
    constructor(scope, id, props) {
        super(scope, id);
        this.lambdaTracing = lambda.Tracing.ACTIVE;
        const baseProps = {
            stage: props.stage,
            enableOperationalMetric: props.enableOperationalMetric,
            constructName: base_class_1.ConstructName.AWSRAGAPPSYNCSTEPFNKENDRA,
            constructId: id,
            observability: props.observability,
        };
        this.updateEnvSuffix(baseProps);
        this.addObservabilityToConstruct(baseProps);
        this.cognito = props.cognitoUserPool;
        this.awsAccountId = cdk.Stack.of(this).account;
        this.awsRegion = cdk.Stack.of(this).region;
        this.stack = cdk.Stack.of(this);
        this.removalPolicy = cdk.RemovalPolicy.DESTROY;
        // Staging environment
        let stage = '-dev';
        if (props?.stage) {
            stage = props.stage;
        }
        if (props?.existingVpc) {
            this.vpc = props.existingVpc;
        }
        else {
            this.vpc = new ec2.Vpc(this, 'Vpc', props.vpcProps);
        }
        if (props?.existingSecurityGroup) {
            this.securityGroup = props.existingSecurityGroup;
        }
        else {
            this.securityGroup = new ec2.SecurityGroup(this, 'securityGroup', {
                vpc: this.vpc,
                allowAllOutbound: true,
                securityGroupName: 'securityGroup' + stage,
            });
        }
        let enableXRay = true;
        let apiLogConfig = {
            fieldLogLevel: appsync.FieldLogLevel.ALL,
            retention: logs.RetentionDays.TEN_YEARS,
        };
        if (props.observability === false) {
            enableXRay = false;
            apiLogConfig = {
                fieldLogLevel: appsync.FieldLogLevel.NONE,
                retention: logs.RetentionDays.TEN_YEARS,
            };
        }
        if (props.kendraIndexProps && props.existingKendraIndexObj) {
            throw new Error('You may not provide both kendraIndexProps and existingKendraIndexObj');
        }
        if (props.kendraIndexProps && props.kendraDataSourcesProps) {
            throw new Error('You may not provide both kendraDataSourcesProps and existingKendraIndexObj');
        }
        if (props.deployVpc || props.existingVpc) {
            this.vpc = (0, vpc_helper_1.buildVpc)(scope, {
                defaultVpcProps: (0, vpc_helper_1.createDefaultIsolatedVpcProps)(),
                existingVpc: props.existingVpc,
                userVpcProps: props.vpcProps,
                constructVpcProps: {
                    enableDnsHostnames: true,
                    enableDnsSupport: true,
                },
            });
            (0, vpc_helper_1.AddAwsServiceEndpoint)(scope, this.vpc, ServiceEndpointTypeEnum.KENDRA);
        }
        this.kendraInputBucket = new aws_s3_1.Bucket(this, 'kendraInputBucket', {
            accessControl: aws_s3_1.BucketAccessControl.PRIVATE,
            enforceSSL: true,
            eventBridgeEnabled: true,
        });
        this.cognito = props.cognitoUserPool;
        this.kendraIndex = new kendra_construct_1.KendraConstruct(this, 'llmDemoIndex', {
            IndexName: 'llmDemoKendraIndex',
            Edition: 'DEVELOPER_EDITION',
            kendraDataSyncInputBucketName: this.kendraInputBucket.bucketName,
            CognitoUserPoolId: this.cognito.userPoolId,
        });
        this.kendraIndexId = this.kendraIndex.KendraIndexId;
        this.kendraDataSourceIndexId = this.kendraIndex.KendraDataSourceIndexId;
        this.kendraInputBucketArn = this.kendraInputBucket.bucketArn;
        this.kendraInputBucket.addCorsRule({
            allowedOrigins: ['*'],
            allowedMethods: [aws_s3_1.HttpMethods.GET, aws_s3_1.HttpMethods.PUT, aws_s3_1.HttpMethods.POST, aws_s3_1.HttpMethods.DELETE, aws_s3_1.HttpMethods.HEAD],
            allowedHeaders: ['*'],
            exposedHeaders: ['ETag'], // For Storage Put with Object size > 5MB
            maxAge: 3000,
        });
        const kendraACL = [
            {
                keyPrefix: `s3://${this.kendraInputBucket.bucketName}/public/BusinessTeam1/`,
                aclEntries: [
                    {
                        Name: 'BusinessTeam1',
                        Type: 'GROUP',
                        Access: 'ALLOW',
                    },
                    {
                        Name: 'Admin',
                        Type: 'GROUP',
                        Access: 'ALLOW',
                    },
                ],
            },
            {
                keyPrefix: `s3://${this.kendraInputBucket.bucketName}/public/BusinessTeam2/`,
                aclEntries: [
                    {
                        Name: 'BusinessTeam2',
                        Type: 'GROUP',
                        Access: 'ALLOW',
                    },
                    {
                        Name: 'Admin',
                        Type: 'GROUP',
                        Access: 'ALLOW',
                    },
                ],
            },
            {
                keyPrefix: `s3://${this.kendraInputBucket.bucketName}/public/AdminsOnly/`,
                aclEntries: [
                    {
                        Name: 'Admin',
                        Type: 'GROUP',
                        Access: 'ALLOW',
                    },
                ],
            },
        ];
        const kendraAclUploader = new custom_resources_1.AwsCustomResource(this, 'kendraAclUploader', {
            onUpdate: {
                action: 'putObject',
                parameters: {
                    Body: JSON.stringify(kendraACL),
                    Bucket: this.kendraInputBucket.bucketName,
                    CacheControl: 'max-age=0, no-cache, no-store, must-revalidate',
                    ContentType: 'application/json',
                    Key: 'kendra_acl.json',
                },
                physicalResourceId: custom_resources_1.PhysicalResourceId.of('kendra_acl'),
                service: 'S3',
            },
            policy: custom_resources_1.AwsCustomResourcePolicy.fromStatements([
                new aws_iam_1.PolicyStatement({
                    actions: ['s3:PutObject'],
                    resources: [this.kendraInputBucket.arnForObjects('kendra_acl.json')],
                }),
            ]),
        });
        this.kendraIndex.node.addDependency(kendraAclUploader);
        new cdk.CfnOutput(this, 'KendraAccessControlListUrl', {
            value: `s3://${this.kendraInputBucket.bucketName}/kendra_acl.json`,
        });
        // TODO(miketran): Fix this schema.
        const ingestionGraphqlApi = new appsync.GraphqlApi(this, 'ingestionGraphqlApi', {
            name: 'ingestionGraphqlApi' + stage,
            definition: appsync.Definition.fromFile(path.join(__dirname, '../../../../resources/gen-ai/aws-rag-appsync-stepfn-kendra/schema.graphql')),
            authorizationConfig: {
                defaultAuthorization: {
                    authorizationType: appsync.AuthorizationType.USER_POOL,
                    userPoolConfig: { userPool: this.cognito },
                },
                additionalAuthorizationModes: [
                    {
                        authorizationType: appsync.AuthorizationType.IAM,
                    },
                ],
            },
            xrayEnabled: enableXRay,
            logConfig: apiLogConfig,
        });
        this.graphqlApi = ingestionGraphqlApi;
        this.syncRunTable = (0, dynamodb_helper_1.createKendraSyncRunTable)(this);
        const lambdaPropsEnv = {
            KENDRA_INDEX_ID: this.kendraIndexId,
            KENDRA_DATA_SOURCE_INDEX_ID: this.kendraDataSourceIndexId,
            DOCUMENTS_TABLE: this.syncRunTable.tableName,
            S3_BUCKET_NAME: this.kendraInputBucket.bucketName,
        };
        const generatePresignedUrlRole = (0, kendra_helper_1.getGeneratePresignedUrlLambdaRole)(this, this.kendraInputBucket);
        const constructGeneratePresignedUrlLambdaProps = {
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-rag-appsync-stepfn-kendra/generate_presigned_url/src')),
            functionName: 's3_pre_signed_links_generator_docker' + stage,
            description: 'Lambda function for pre-signed links generation',
            vpc: this.vpc,
            tracing: this.lambdaTracing,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.securityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769),
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            role: generatePresignedUrlRole,
            environment: lambdaPropsEnv,
        };
        const generatePresignedUrlLambda = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'generatePresignedUrlFN', constructGeneratePresignedUrlLambdaProps, props.generatePresignedUrlLambdaProps);
        const startDataSyncRole = (0, kendra_helper_1.getKendraStartDataSyncLambdaRole)(this, this.syncRunTable, this.awsRegion, this.awsAccountId, this.kendraIndexId, this.kendraDataSourceIndexId);
        const constructStartDataSyncJobLambdaProps = {
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-rag-appsync-stepfn-kendra/kendra_sync/src')),
            functionName: 'kendra_start_sync_job_docker' + stage,
            description: 'Lambda function for Kendra  sync job starting',
            vpc: this.vpc,
            tracing: this.lambdaTracing,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.securityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769),
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            role: startDataSyncRole,
            environment: lambdaPropsEnv,
        };
        const kendraSyncLambda = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'kendraStartDataSync', constructStartDataSyncJobLambdaProps, props.kendraStartDataSyncLambdaProps);
        const checkJobStatusLambdaRole = (0, kendra_helper_1.getCheckJobStatusLambdaRole)(this, this.awsRegion, this.awsAccountId, this.kendraIndexId, this.kendraDataSourceIndexId);
        const constructCheckJobStatusLambdaProps = {
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-rag-appsync-stepfn-kendra/kendra_sync_status/src')),
            functionName: 'kendra_check_sync_job_status_docker' + stage,
            description: 'Lambda function for getting kendra sync status',
            vpc: this.vpc,
            tracing: this.lambdaTracing,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.securityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769),
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            environment: lambdaPropsEnv,
            role: checkJobStatusLambdaRole,
        };
        const createCheckJobsStatusLambda = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'checkJobStatusFN', constructCheckJobStatusLambdaProps, props.checkJobsStatusLambdaProps);
        const updateKendraJobStatusLambdaRole = (0, kendra_helper_1.getUpdateKendraJobStatusLambdaRole)(this, this.syncRunTable);
        const constructKendraJobStatusLambdaProps = {
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-rag-appsync-stepfn-kendra/kendra_job_manager/src')),
            functionName: 'kendra_job_manager_docker' + stage,
            description: 'Lambda function for Kendra job status updates',
            vpc: this.vpc,
            tracing: this.lambdaTracing,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.securityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769),
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            role: updateKendraJobStatusLambdaRole,
            environment: lambdaPropsEnv,
        };
        const updateKendraJobStatusLambda = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'updateKendraJobStatusFn', constructKendraJobStatusLambdaProps, props.updateKendraJobStatusLambdaProps);
        this.docProcessingStateMachine = (0, kendra_helper_1.createKendraWorkflowStepFunction)(this.stack, updateKendraJobStatusLambda, kendraSyncLambda, createCheckJobsStatusLambda);
        this.stepFunctionsExecutionHandlerRole = (0, kendra_helper_1.createStepFunctionsExecutionHandlerRole)(this.stack, this.docProcessingStateMachine);
        const startKendraSyncStepFnRole = (0, kendra_helper_1.getStartKendraSyncStepFnRole)(this, this.docProcessingStateMachine);
        const constructStartKendraSyncStepFnLambdaProps = {
            code: lambda.DockerImageCode.fromImageAsset(path.join(__dirname, '../../../../lambda/aws-rag-appsync-stepfn-kendra/start_kendra_sync_stepfn/src')),
            functionName: 'start_kndra_sync_step_fn' + stage,
            description: 'Lambda for starting execution',
            vpc: this.vpc,
            tracing: this.lambdaTracing,
            vpcSubnets: { subnetType: ec2.SubnetType.PRIVATE_WITH_EGRESS },
            securityGroups: [this.securityGroup],
            memorySize: (0, utils_1.lambdaMemorySizeLimiter)(this, 1769),
            timeout: aws_cdk_lib_1.Duration.minutes(15),
            role: startKendraSyncStepFnRole,
            environment: {
                ...lambdaPropsEnv,
                STEP_FUNCTION_ARN: this.docProcessingStateMachine.stateMachineArn,
            },
        };
        const startKendraStepFnLambda = (0, lambda_builder_helper_1.buildDockerLambdaFunction)(this, 'startKendraStepFnLambda', constructStartKendraSyncStepFnLambdaProps, undefined);
        const presignedUrlDataSource = ingestionGraphqlApi.addLambdaDataSource('presignedUrlDataSource', generatePresignedUrlLambda);
        presignedUrlDataSource.createResolver('presignedUrlResolver', {
            typeName: 'Mutation',
            fieldName: 'generatePresignedUrl',
        });
        const kendraSyncLambdaDataSource = ingestionGraphqlApi.addLambdaDataSource('kendraSyncLambdaDataSource', startKendraStepFnLambda);
        kendraSyncLambdaDataSource.createResolver('kendraSyncLambdaResolver', {
            typeName: 'Mutation',
            fieldName: 'startKendraSyncJob',
            requestMappingTemplate: appsync.MappingTemplate.fromString(`
    {
      "version": "2017-02-28",
      "operation": "Invoke",
      "payload": {}
    }
  `),
            responseMappingTemplate: appsync.MappingTemplate.fromString(`
    $util.toJson($context.result)
  `),
        });
    }
}
exports.RagAppsyncStepfnKendra = RagAppsyncStepfnKendra;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGF0dGVybnMvZ2VuLWFpL2F3cy1yYWctYXBwc3luYy1zdGVwZm4ta2VuZHJhL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsNkJBQTZCO0FBQzdCLG1DQUFtQztBQUNuQyw2Q0FBc0Q7QUFDdEQsbURBQW1EO0FBR25ELDJDQUEyQztBQUMzQyxpREFBc0Q7QUFFdEQsaURBQWlEO0FBRWpELDZDQUE2QztBQUM3QywrQ0FBOEU7QUFHOUUsbUVBQThHO0FBRTlHLDJEQUFzRjtBQUN0Riw2RUFBbUY7QUFDbkYsK0VBQTJFO0FBQzNFLHlFQVErQztBQUMvQyx5RkFBMEY7QUFDMUYseURBQXdFO0FBQ3hFLG1FQUFvSDtBQThHcEgsSUFBSyx1QkFlSjtBQWZELFdBQUssdUJBQXVCO0lBQzFCLDJDQUFlLENBQUE7SUFDZiw4Q0FBa0IsQ0FBQTtJQUNsQiw4Q0FBa0IsQ0FBQTtJQUNsQix1REFBMkIsQ0FBQTtJQUMzQiw0Q0FBZ0IsQ0FBQTtJQUNoQixnRUFBb0MsQ0FBQTtJQUNwQyw4REFBa0MsQ0FBQTtJQUNsQyxvQ0FBUSxDQUFBO0lBQ1Isa0VBQXNDLENBQUE7SUFDdEMsOERBQWtDLENBQUE7SUFDbEMsc0NBQVUsQ0FBQTtJQUNWLHNDQUFVLENBQUE7SUFDVixzQ0FBVSxDQUFBO0lBQ1YsNERBQWdDLENBQUE7QUFDbEMsQ0FBQyxFQWZJLHVCQUF1QixLQUF2Qix1QkFBdUIsUUFlM0I7QUFFRDs7R0FFRztBQUNILE1BQWEsc0JBQXVCLFNBQVEsc0JBQVM7SUEwQm5EOzs7Ozs7O09BT0c7SUFDSCxZQUFZLEtBQWdCLEVBQUUsRUFBVSxFQUFFLEtBQWtDO1FBQzFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUExQm5CLGtCQUFhLEdBQWlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBNEJsRCxNQUFNLFNBQVMsR0FBaUI7WUFDOUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO1lBQ2xCLHVCQUF1QixFQUFFLEtBQUssQ0FBQyx1QkFBdUI7WUFDdEQsYUFBYSxFQUFFLDBCQUFhLENBQUMseUJBQXlCO1lBQ3RELFdBQVcsRUFBRSxFQUFFO1lBQ2YsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO1NBQ25DLENBQUM7UUFFRixJQUFJLENBQUMsZUFBZSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUU1QyxJQUFJLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxlQUFlLENBQUM7UUFFckMsSUFBSSxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUM7UUFDL0MsSUFBSSxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFDM0MsSUFBSSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1FBRS9DLHNCQUFzQjtRQUN0QixJQUFJLEtBQUssR0FBRyxNQUFNLENBQUM7UUFDbkIsSUFBSSxLQUFLLEVBQUUsS0FBSyxFQUFFLENBQUM7WUFDakIsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7UUFDdEIsQ0FBQztRQUVELElBQUksS0FBSyxFQUFFLFdBQVcsRUFBRSxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxHQUFHLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQztRQUMvQixDQUFDO2FBQU0sQ0FBQztZQUNOLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3RELENBQUM7UUFFRCxJQUFJLEtBQUssRUFBRSxxQkFBcUIsRUFBRSxDQUFDO1lBQ2pDLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLHFCQUFxQixDQUFDO1FBQ25ELENBQUM7YUFBTSxDQUFDO1lBQ04sSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLEdBQUcsQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGVBQWUsRUFBRTtnQkFDaEUsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO2dCQUNiLGdCQUFnQixFQUFFLElBQUk7Z0JBQ3RCLGlCQUFpQixFQUFFLGVBQWUsR0FBRyxLQUFLO2FBQzNDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFFRCxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxZQUFZLEdBQUc7WUFDakIsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhLENBQUMsR0FBRztZQUN4QyxTQUFTLEVBQUUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxTQUFTO1NBQ3hDLENBQUM7UUFFRixJQUFJLEtBQUssQ0FBQyxhQUFhLEtBQUssS0FBSyxFQUFFLENBQUM7WUFDbEMsVUFBVSxHQUFHLEtBQUssQ0FBQztZQUNuQixZQUFZLEdBQUc7Z0JBQ2IsYUFBYSxFQUFFLE9BQU8sQ0FBQyxhQUFhLENBQUMsSUFBSTtnQkFDekMsU0FBUyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUzthQUN4QyxDQUFDO1FBQ0osQ0FBQztRQUVELElBQUksS0FBSyxDQUFDLGdCQUFnQixJQUFJLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQzNELE1BQU0sSUFBSSxLQUFLLENBQUMsc0VBQXNFLENBQUMsQ0FBQztRQUMxRixDQUFDO1FBRUQsSUFBSSxLQUFLLENBQUMsZ0JBQWdCLElBQUksS0FBSyxDQUFDLHNCQUFzQixFQUFFLENBQUM7WUFDM0QsTUFBTSxJQUFJLEtBQUssQ0FBQyw0RUFBNEUsQ0FBQyxDQUFDO1FBQ2hHLENBQUM7UUFFRCxJQUFJLEtBQUssQ0FBQyxTQUFTLElBQUksS0FBSyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3pDLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBQSxxQkFBUSxFQUFDLEtBQUssRUFBRTtnQkFDekIsZUFBZSxFQUFFLElBQUEsMENBQTZCLEdBQUU7Z0JBQ2hELFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsWUFBWSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUM1QixpQkFBaUIsRUFBRTtvQkFDakIsa0JBQWtCLEVBQUUsSUFBSTtvQkFDeEIsZ0JBQWdCLEVBQUUsSUFBSTtpQkFDdkI7YUFDRixDQUFDLENBQUM7WUFFSCxJQUFBLGtDQUFxQixFQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pFLENBQUM7UUFDRCxJQUFJLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxlQUFNLENBQUMsSUFBSSxFQUFFLG1CQUFtQixFQUFFO1lBQzdELGFBQWEsRUFBRSw0QkFBbUIsQ0FBQyxPQUFPO1lBQzFDLFVBQVUsRUFBRSxJQUFJO1lBQ2hCLGtCQUFrQixFQUFFLElBQUk7U0FDekIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE9BQU8sR0FBRyxLQUFLLENBQUMsZUFBZSxDQUFDO1FBR3JDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxrQ0FBZSxDQUFDLElBQUksRUFBRSxjQUFjLEVBQUU7WUFDM0QsU0FBUyxFQUFFLG9CQUFvQjtZQUMvQixPQUFPLEVBQUUsbUJBQW1CO1lBQzVCLDZCQUE2QixFQUFFLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVO1lBQ2hFLGlCQUFpQixFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBVTtTQUMzQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDO1FBQ3BELElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLHVCQUF1QixDQUFDO1FBRXhFLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDO1FBRTdELElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUM7WUFDakMsY0FBYyxFQUFFLENBQUMsR0FBRyxDQUFDO1lBQ3JCLGNBQWMsRUFBRSxDQUFDLG9CQUFXLENBQUMsR0FBRyxFQUFFLG9CQUFXLENBQUMsR0FBRyxFQUFFLG9CQUFXLENBQUMsSUFBSSxFQUFFLG9CQUFXLENBQUMsTUFBTSxFQUFFLG9CQUFXLENBQUMsSUFBSSxDQUFDO1lBQzFHLGNBQWMsRUFBRSxDQUFDLEdBQUcsQ0FBQztZQUNyQixjQUFjLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSx5Q0FBeUM7WUFDbkUsTUFBTSxFQUFFLElBQUk7U0FDYixDQUFDLENBQUM7UUFFSCxNQUFNLFNBQVMsR0FBRztZQUNoQjtnQkFDRSxTQUFTLEVBQUUsUUFBUSxJQUFJLENBQUMsaUJBQWlCLENBQUMsVUFBVSx3QkFBd0I7Z0JBQzVFLFVBQVUsRUFBRTtvQkFDVjt3QkFDRSxJQUFJLEVBQUUsZUFBZTt3QkFDckIsSUFBSSxFQUFFLE9BQU87d0JBQ2IsTUFBTSxFQUFFLE9BQU87cUJBQ2hCO29CQUNEO3dCQUNFLElBQUksRUFBRSxPQUFPO3dCQUNiLElBQUksRUFBRSxPQUFPO3dCQUNiLE1BQU0sRUFBRSxPQUFPO3FCQUNoQjtpQkFDRjthQUNGO1lBQ0Q7Z0JBQ0UsU0FBUyxFQUFFLFFBQVEsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsd0JBQXdCO2dCQUM1RSxVQUFVLEVBQUU7b0JBQ1Y7d0JBQ0UsSUFBSSxFQUFFLGVBQWU7d0JBQ3JCLElBQUksRUFBRSxPQUFPO3dCQUNiLE1BQU0sRUFBRSxPQUFPO3FCQUNoQjtvQkFDRDt3QkFDRSxJQUFJLEVBQUUsT0FBTzt3QkFDYixJQUFJLEVBQUUsT0FBTzt3QkFDYixNQUFNLEVBQUUsT0FBTztxQkFDaEI7aUJBQ0Y7YUFDRjtZQUNEO2dCQUNFLFNBQVMsRUFBRSxRQUFRLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxVQUFVLHFCQUFxQjtnQkFDekUsVUFBVSxFQUFFO29CQUNWO3dCQUNFLElBQUksRUFBRSxPQUFPO3dCQUNiLElBQUksRUFBRSxPQUFPO3dCQUNiLE1BQU0sRUFBRSxPQUFPO3FCQUNoQjtpQkFDRjthQUNGO1NBQ0YsQ0FBQztRQUVGLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxvQ0FBaUIsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLEVBQUU7WUFDekUsUUFBUSxFQUFFO2dCQUNSLE1BQU0sRUFBRSxXQUFXO2dCQUNuQixVQUFVLEVBQUU7b0JBQ1YsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDO29CQUMvQixNQUFNLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVU7b0JBQ3pDLFlBQVksRUFBRSxnREFBZ0Q7b0JBQzlELFdBQVcsRUFBRSxrQkFBa0I7b0JBQy9CLEdBQUcsRUFBRSxpQkFBaUI7aUJBQ3ZCO2dCQUNELGtCQUFrQixFQUFFLHFDQUFrQixDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUM7Z0JBQ3ZELE9BQU8sRUFBRSxJQUFJO2FBQ2Q7WUFDRCxNQUFNLEVBQUUsMENBQXVCLENBQUMsY0FBYyxDQUFDO2dCQUM3QyxJQUFJLHlCQUFlLENBQUM7b0JBQ2xCLE9BQU8sRUFBRSxDQUFDLGNBQWMsQ0FBQztvQkFDekIsU0FBUyxFQUFFLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO2lCQUNyRSxDQUFDO2FBQ0gsQ0FBQztTQUNILENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBR3ZELElBQUksR0FBRyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsNEJBQTRCLEVBQUU7WUFDcEQsS0FBSyxFQUFFLFFBQVEsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVUsa0JBQWtCO1NBQ25FLENBQUMsQ0FBQztRQUVILG1DQUFtQztRQUNuQyxNQUFNLG1CQUFtQixHQUFHLElBQUksT0FBTyxDQUFDLFVBQVUsQ0FDaEQsSUFBSSxFQUNKLHFCQUFxQixFQUNyQjtZQUNFLElBQUksRUFBRSxxQkFBcUIsR0FBRyxLQUFLO1lBQ25DLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FDckMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsMkVBQTJFLENBQUMsQ0FDbEc7WUFDRCxtQkFBbUIsRUFBRTtnQkFDbkIsb0JBQW9CLEVBQUU7b0JBQ3BCLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxTQUFTO29CQUN0RCxjQUFjLEVBQUUsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDLE9BQU8sRUFBRTtpQkFDM0M7Z0JBQ0QsNEJBQTRCLEVBQUU7b0JBQzVCO3dCQUNFLGlCQUFpQixFQUFFLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxHQUFHO3FCQUNqRDtpQkFDRjthQUNGO1lBQ0QsV0FBVyxFQUFFLFVBQVU7WUFDdkIsU0FBUyxFQUFFLFlBQVk7U0FDeEIsQ0FDRixDQUFDO1FBQ0YsSUFBSSxDQUFDLFVBQVUsR0FBRyxtQkFBbUIsQ0FBQztRQUN0QyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUEsMENBQXdCLEVBQUMsSUFBSSxDQUFDLENBQUM7UUFFbkQsTUFBTSxjQUFjLEdBQUc7WUFDckIsZUFBZSxFQUFFLElBQUksQ0FBQyxhQUFhO1lBQ25DLDJCQUEyQixFQUFFLElBQUksQ0FBQyx1QkFBdUI7WUFDekQsZUFBZSxFQUFFLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUztZQUM1QyxjQUFjLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLFVBQVU7U0FDbEQsQ0FBQztRQUVGLE1BQU0sd0JBQXdCLEdBQUcsSUFBQSxpREFBaUMsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDakcsTUFBTSx3Q0FBd0MsR0FBRztZQUMvQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsNkVBQTZFLENBQUMsQ0FBQztZQUNoSixZQUFZLEVBQUUsc0NBQXNDLEdBQUcsS0FBSztZQUM1RCxXQUFXLEVBQUUsaURBQWlEO1lBQzlELEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztZQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsYUFBYTtZQUMzQixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRTtZQUM5RCxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQ3BDLFVBQVUsRUFBRSxJQUFBLCtCQUF1QixFQUFDLElBQUksRUFBRSxJQUFLLENBQUM7WUFDaEQsT0FBTyxFQUFFLHNCQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUM3QixJQUFJLEVBQUUsd0JBQXdCO1lBQzlCLFdBQVcsRUFBRSxjQUFjO1NBQzVCLENBQUM7UUFDRixNQUFNLDBCQUEwQixHQUFHLElBQUEsaURBQXlCLEVBQzFELElBQUksRUFDSix3QkFBd0IsRUFDeEIsd0NBQXdDLEVBQ3hDLEtBQUssQ0FBQywrQkFBK0IsQ0FDdEMsQ0FBQztRQUVGLE1BQU0saUJBQWlCLEdBQUcsSUFBQSxnREFBZ0MsRUFDeEQsSUFBSSxFQUFFLElBQUksQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUM3RyxDQUFDO1FBQ0YsTUFBTSxvQ0FBb0MsR0FBRztZQUMzQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsa0VBQWtFLENBQUMsQ0FBQztZQUNySSxZQUFZLEVBQUUsOEJBQThCLEdBQUMsS0FBSztZQUNsRCxXQUFXLEVBQUUsK0NBQStDO1lBQzVELEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztZQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsYUFBYTtZQUMzQixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRTtZQUM5RCxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQ3BDLFVBQVUsRUFBRSxJQUFBLCtCQUF1QixFQUFDLElBQUksRUFBRSxJQUFLLENBQUM7WUFDaEQsT0FBTyxFQUFFLHNCQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUM3QixJQUFJLEVBQUUsaUJBQWlCO1lBQ3ZCLFdBQVcsRUFBRSxjQUFjO1NBQzVCLENBQUM7UUFDRixNQUFNLGdCQUFnQixHQUFHLElBQUEsaURBQXlCLEVBQ2hELElBQUksRUFDSixxQkFBcUIsRUFDckIsb0NBQW9DLEVBQ3BDLEtBQUssQ0FBQyw4QkFBOEIsQ0FDckMsQ0FBQztRQUVGLE1BQU0sd0JBQXdCLEdBQUcsSUFBQSwyQ0FBMkIsRUFDMUQsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFlBQVksRUFBRSxJQUFJLENBQUMsYUFBYSxFQUFFLElBQUksQ0FBQyx1QkFBdUIsQ0FDMUYsQ0FBQztRQUNGLE1BQU0sa0NBQWtDLEdBQTZCO1lBQ25FLElBQUksRUFBRSxNQUFNLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSx5RUFBeUUsQ0FBQyxDQUFDO1lBQzVJLFlBQVksRUFBRSxxQ0FBcUMsR0FBQyxLQUFLO1lBQ3pELFdBQVcsRUFBRSxnREFBZ0Q7WUFDN0QsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHO1lBQ2IsT0FBTyxFQUFFLElBQUksQ0FBQyxhQUFhO1lBQzNCLFVBQVUsRUFBRSxFQUFFLFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLG1CQUFtQixFQUFFO1lBQzlELGNBQWMsRUFBRSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7WUFDcEMsVUFBVSxFQUFFLElBQUEsK0JBQXVCLEVBQUMsSUFBSSxFQUFFLElBQUssQ0FBQztZQUNoRCxPQUFPLEVBQUUsc0JBQVEsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQzdCLFdBQVcsRUFBRSxjQUFjO1lBQzNCLElBQUksRUFBRSx3QkFBd0I7U0FDL0IsQ0FBQztRQUVGLE1BQU0sMkJBQTJCLEdBQUcsSUFBQSxpREFBeUIsRUFDM0QsSUFBSSxFQUNKLGtCQUFrQixFQUNsQixrQ0FBa0MsRUFDbEMsS0FBSyxDQUFDLDBCQUEwQixDQUNqQyxDQUFDO1FBRUYsTUFBTSwrQkFBK0IsR0FBRyxJQUFBLGtEQUFrQyxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDcEcsTUFBTSxtQ0FBbUMsR0FBRztZQUMxQyxJQUFJLEVBQUUsTUFBTSxDQUFDLGVBQWUsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUseUVBQXlFLENBQUMsQ0FBQztZQUM1SSxZQUFZLEVBQUUsMkJBQTJCLEdBQUMsS0FBSztZQUMvQyxXQUFXLEVBQUUsK0NBQStDO1lBQzVELEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRztZQUNiLE9BQU8sRUFBRSxJQUFJLENBQUMsYUFBYTtZQUMzQixVQUFVLEVBQUUsRUFBRSxVQUFVLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxtQkFBbUIsRUFBRTtZQUM5RCxjQUFjLEVBQUUsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDO1lBQ3BDLFVBQVUsRUFBRSxJQUFBLCtCQUF1QixFQUFDLElBQUksRUFBRSxJQUFLLENBQUM7WUFDaEQsT0FBTyxFQUFFLHNCQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUM3QixJQUFJLEVBQUUsK0JBQStCO1lBQ3JDLFdBQVcsRUFBRSxjQUFjO1NBQzVCLENBQUM7UUFDRixNQUFNLDJCQUEyQixHQUFHLElBQUEsaURBQXlCLEVBQzNELElBQUksRUFDSix5QkFBeUIsRUFDekIsbUNBQW1DLEVBQ25DLEtBQUssQ0FBQyxnQ0FBZ0MsQ0FDdkMsQ0FBQztRQUVGLElBQUksQ0FBQyx5QkFBeUIsR0FBRyxJQUFBLGdEQUFnQyxFQUMvRCxJQUFJLENBQUMsS0FBSyxFQUNWLDJCQUEyQixFQUMzQixnQkFBZ0IsRUFDaEIsMkJBQTJCLENBQzVCLENBQUM7UUFFRixJQUFJLENBQUMsaUNBQWlDLEdBQUcsSUFBQSx1REFBdUMsRUFDOUUsSUFBSSxDQUFDLEtBQUssRUFDVixJQUFJLENBQUMseUJBQXlCLENBQy9CLENBQUM7UUFFRixNQUFNLHlCQUF5QixHQUFHLElBQUEsNENBQTRCLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1FBQ3JHLE1BQU0seUNBQXlDLEdBQUc7WUFDaEQsSUFBSSxFQUFFLE1BQU0sQ0FBQyxlQUFlLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLCtFQUErRSxDQUFDLENBQUM7WUFDbEosWUFBWSxFQUFFLDBCQUEwQixHQUFHLEtBQUs7WUFDaEQsV0FBVyxFQUFFLCtCQUErQjtZQUM1QyxHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUc7WUFDYixPQUFPLEVBQUUsSUFBSSxDQUFDLGFBQWE7WUFDM0IsVUFBVSxFQUFFLEVBQUUsVUFBVSxFQUFFLEdBQUcsQ0FBQyxVQUFVLENBQUMsbUJBQW1CLEVBQUU7WUFDOUQsY0FBYyxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQztZQUNwQyxVQUFVLEVBQUUsSUFBQSwrQkFBdUIsRUFBQyxJQUFJLEVBQUUsSUFBSyxDQUFDO1lBQ2hELE9BQU8sRUFBRSxzQkFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDN0IsSUFBSSxFQUFFLHlCQUF5QjtZQUMvQixXQUFXLEVBQUU7Z0JBQ1gsR0FBRyxjQUFjO2dCQUNqQixpQkFBaUIsRUFBRSxJQUFJLENBQUMseUJBQXlCLENBQUMsZUFBZTthQUNsRTtTQUNGLENBQUM7UUFFRixNQUFNLHVCQUF1QixHQUFHLElBQUEsaURBQXlCLEVBQ3ZELElBQUksRUFDSix5QkFBeUIsRUFDekIseUNBQXlDLEVBQ3pDLFNBQVMsQ0FDVixDQUFDO1FBRUYsTUFBTSxzQkFBc0IsR0FBRyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FDcEUsd0JBQXdCLEVBQ3hCLDBCQUEwQixDQUMzQixDQUFDO1FBRUYsc0JBQXNCLENBQUMsY0FBYyxDQUFDLHNCQUFzQixFQUFFO1lBQzVELFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFNBQVMsRUFBRSxzQkFBc0I7U0FDbEMsQ0FBQyxDQUFDO1FBRUgsTUFBTSwwQkFBMEIsR0FBRyxtQkFBbUIsQ0FBQyxtQkFBbUIsQ0FDeEUsNEJBQTRCLEVBQzVCLHVCQUF1QixDQUN4QixDQUFDO1FBQ0YsMEJBQTBCLENBQUMsY0FBYyxDQUFDLDBCQUEwQixFQUNsRTtZQUNFLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFNBQVMsRUFBRSxvQkFBb0I7WUFDL0Isc0JBQXNCLEVBQUUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUM7Ozs7OztHQU1oRSxDQUFDO1lBQ0ksdUJBQXVCLEVBQUUsT0FBTyxDQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUM7O0dBRWpFLENBQUM7U0FDRyxDQUFDLENBQUM7SUFFUCxDQUFDO0NBQ0Y7QUFuWkQsd0RBbVpDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAgQ29weXJpZ2h0IEFtYXpvbi5jb20sIEluYy4gb3IgaXRzIGFmZmlsaWF0ZXMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIikuIFlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqICB3aXRoIHRoZSBMaWNlbnNlLiBBIGNvcHkgb2YgdGhlIExpY2Vuc2UgaXMgbG9jYXRlZCBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogIG9yIGluIHRoZSAnbGljZW5zZScgZmlsZSBhY2NvbXBhbnlpbmcgdGhpcyBmaWxlLiBUaGlzIGZpbGUgaXMgZGlzdHJpYnV0ZWQgb24gYW4gJ0FTIElTJyBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTXG4gKiAgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZXhwcmVzcyBvciBpbXBsaWVkLiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcbiAqICBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHsgRHVyYXRpb24sIFJlbW92YWxQb2xpY3kgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgKiBhcyBhcHBzeW5jIGZyb20gJ2F3cy1jZGstbGliL2F3cy1hcHBzeW5jJztcbmltcG9ydCAqIGFzIGNvZ25pdG8gZnJvbSAnYXdzLWNkay1saWIvYXdzLWNvZ25pdG8nO1xuaW1wb3J0IHsgVGFibGUgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtZHluYW1vZGInO1xuaW1wb3J0ICogYXMgZWMyIGZyb20gJ2F3cy1jZGstbGliL2F3cy1lYzInO1xuaW1wb3J0IHsgUG9saWN5U3RhdGVtZW50IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWlhbSc7XG5pbXBvcnQgKiBhcyBrZW5kcmEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWtlbmRyYSc7XG5pbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBEb2NrZXJJbWFnZUZ1bmN0aW9uUHJvcHMgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtbGFtYmRhL2xpYi9pbWFnZS1mdW5jdGlvbic7XG5pbXBvcnQgKiBhcyBsb2dzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1sb2dzJztcbmltcG9ydCB7IEJ1Y2tldCwgQnVja2V0QWNjZXNzQ29udHJvbCwgSHR0cE1ldGhvZHMgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtczMnO1xuaW1wb3J0IHsgU3RhdGVNYWNoaW5lIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLXN0ZXBmdW5jdGlvbnMnO1xuaW1wb3J0IHsgU3RhY2sgfSBmcm9tICdhd3MtY2RrLWxpYi9jb3JlJztcbmltcG9ydCB7IEF3c0N1c3RvbVJlc291cmNlLCBBd3NDdXN0b21SZXNvdXJjZVBvbGljeSwgUGh5c2ljYWxSZXNvdXJjZUlkIH0gZnJvbSAnYXdzLWNkay1saWIvY3VzdG9tLXJlc291cmNlcyc7XG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7IEJhc2VDbGFzcywgQmFzZUNsYXNzUHJvcHMsIENvbnN0cnVjdE5hbWUgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vYmFzZS1jbGFzcyc7XG5pbXBvcnQgeyBjcmVhdGVLZW5kcmFTeW5jUnVuVGFibGUgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vaGVscGVycy9keW5hbW9kYi1oZWxwZXInO1xuaW1wb3J0IHsgS2VuZHJhQ29uc3RydWN0IH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMva2VuZHJhLWNvbnN0cnVjdCc7XG5pbXBvcnQge1xuICBjcmVhdGVLZW5kcmFXb3JrZmxvd1N0ZXBGdW5jdGlvbixcbiAgY3JlYXRlU3RlcEZ1bmN0aW9uc0V4ZWN1dGlvbkhhbmRsZXJSb2xlLFxuICBnZXRLZW5kcmFTdGFydERhdGFTeW5jTGFtYmRhUm9sZSxcbiAgZ2V0R2VuZXJhdGVQcmVzaWduZWRVcmxMYW1iZGFSb2xlLFxuICBnZXRDaGVja0pvYlN0YXR1c0xhbWJkYVJvbGUsXG4gIGdldFVwZGF0ZUtlbmRyYUpvYlN0YXR1c0xhbWJkYVJvbGUsXG4gIGdldFN0YXJ0S2VuZHJhU3luY1N0ZXBGblJvbGUsXG59IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2tlbmRyYS1oZWxwZXInO1xuaW1wb3J0IHsgYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL2xhbWJkYS1idWlsZGVyLWhlbHBlcic7XG5pbXBvcnQgeyBsYW1iZGFNZW1vcnlTaXplTGltaXRlciB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9oZWxwZXJzL3V0aWxzJztcbmltcG9ydCB7IEFkZEF3c1NlcnZpY2VFbmRwb2ludCwgYnVpbGRWcGMsIGNyZWF0ZURlZmF1bHRJc29sYXRlZFZwY1Byb3BzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2hlbHBlcnMvdnBjLWhlbHBlcic7XG5pbXBvcnQgeyBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9wcm9wcy9Eb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyc7XG5cbi8qKlxuICogVGhlIHByb3BlcnRpZXMgZm9yIHRoZSBSYWdBcHBzeW5jU3RlcGZuS2VuZHJhUHJvcHMgY2xhc3MuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUmFnQXBwc3luY1N0ZXBmbktlbmRyYVByb3BzIHtcbiAgZXhpc3RpbmdTZWN1cml0eUdyb3VwOiBhbnk7XG4gIC8qKlxuICAgICAqIENvZ25pdG8gdXNlciBwb29sIHVzZWQgZm9yIGF1dGhlbnRpY2F0aW9uLlxuICAgICAqXG4gICAgICogQGRlZmF1bHQgLSBOb25lXG4gICAgICovXG4gIHJlYWRvbmx5IGNvZ25pdG9Vc2VyUG9vbDogY29nbml0by5Vc2VyUG9vbDtcblxuICBvYnNlcnZhYmlsaXR5OiBib29sZWFuO1xuICBzdGFnZTogYW55O1xuICAvKipcbiAgICAgKlxuICAgICAqXG4gICAgICogQGRlZmF1bHQgLSBPcHRpb25hbCB1c2VyIHByb3ZpZGVkIHByb3BzIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IHByb3BzIGZvciB0aGUgS2VuZHJhIGluZGV4LiBJcyB0aGlzIHJlcXVpcmVkP1xuICAgICAqL1xuICByZWFkb25seSBrZW5kcmFJbmRleFByb3BzPzoga2VuZHJhLkNmbkluZGV4UHJvcHM7XG4gIC8qKlxuICAgICAqIEEgbGlzdCBvZiBkYXRhIHNvdXJjZXMgdGhhdCB3aWxsIHByb3ZpZGUgZGF0YSB0byB0aGUgS2VuZHJhIGluZGV4LiA/QXQgbGVhc3QgMSBtdXN0IGJlIHNwZWNpZmllZC4gV2Ugd2lsbCBkbyBtYWpvcml0eSBvZlxuICAgICAqIHByb2Nlc3NpbmcgZm9yIHNvbWUgZGF0YSBzb3VyY2VzIChTMyBjcmF3bGVyIGluaXRpYWxseSksIGJ1dCBmb3Igb3RoZXJzIHRoZSBwcm9wcyBtdXN0IGJlIGNvbXBsZXRlIChlLmcuIHByb3BlciByb2xlQXJuLCBldGMuKVxuICAgICAqXG4gICAgICogQGRlZmF1bHQgLSBlbXB0eSBsaXN0IChubyBkYXRhIHNvdXJjZXMpXG4gICAgICovXG4gIHJlYWRvbmx5IGtlbmRyYURhdGFTb3VyY2VzUHJvcHM6IEFycmF5PGtlbmRyYS5DZm5EYXRhU291cmNlUHJvcHMgfCBhbnk+O1xuICAvKipcbiAgICAgKiBPcHRpb25hbCAtIGluZGV4IHBlcm1pc3Npb25zIHRvIGdyYW50IHRvIHRoZSBMYW1iZGEgZnVuY3Rpb24uIE9uZSBvciBtb3JlIG9mIHRoZSBmb2xsb3dpbmdcbiAgICAgKiBtYXkgYmUgc3BlY2lmaWVkOsKgYFJlYWRgLCBgU3VibWl0RmVlZGJhY2tgIGFuZCBgV3JpdGVgLiBEZWZhdWx0IGlzIGBbXCJSZWFkXCIsIFwiU3VibWl0RmVlZGJhY2tcIl1gLiBSZWFkIGlzXG4gICAgICogYWxsIHRoZSBvcGVyYXRpb25zIElBTSBkZWZpbmVzIGFzIFJlYWQgYW5kIExpc3QuIFN1Ym1pdEZlZWRiYWNrIGlzIG9ubHkgdGhlIFN1Ym1pdEZlZWRiYWNrIGFjdGlvbi4gV3JpdGUgaXMgYWxsIHRoZVxuICAgICAqIG9wZXJhdGlvbnMgSUFNIGRlZmluZXMgYXMgV3JpdGUgYW5kIFRhZy4gVGhpcyBmdW5jdGlvbmFsaXR5IG1heSBiZSBvdmVycmlkZGVuIGJ5IHByb3ZpZGluZyBhIHNwZWNpZmljIHJvbGUgYXJuIGluIGxhbWJkYUZ1bmN0aW9uUHJvcHNcbiAgICAgKlxuICAgICAqIEBkZWZhdWx0IC0gW1wiUmVhZFwiLCBcIlN1Ym1pdEZlZWRiYWNrXCJdXG4gICAgICovXG4gIHJlYWRvbmx5IGluZGV4UGVybWlzc2lvbnM/OiBzdHJpbmdbXTtcbiAgLyoqXG4gICAgICogRXhpc3RpbmcgaW5zdGFuY2Ugb2YgYSBLZW5kcmEgSW5kZXguIFByb3ZpZGluZyBib3RoIHRoaXMgYW5kIGtlbmRyYUluZGV4UHJvcHMgd2lsbCBjYXVzZSBhbiBlcnJvci5cbiAgICAgKlxuICAgICAqIEBkZWZhdWx0IC0gTm9uZVxuICAgICAqL1xuICByZWFkb25seSBleGlzdGluZ0tlbmRyYUluZGV4T2JqPzoga2VuZHJhLkNmbkluZGV4O1xuICAvKipcbiAgICAgKiBFeGlzdGluZyBpbnN0YW5jZSBvZiBMYW1iZGEgRnVuY3Rpb24gb2JqZWN0LCBwcm92aWRpbmcgYm90aCB0aGlzIGFuZCBgbGFtYmRhRnVuY3Rpb25Qcm9wc2Agd2lsbCBjYXVzZSBhbiBlcnJvci5cbiAgICAgKlxuICAgICAqIEBkZWZhdWx0IC0gTm9uZVxuICAgICAqL1xuICByZWFkb25seSBleGlzdGluZ0xhbWJkYU9iaj86IGxhbWJkYS5GdW5jdGlvbjtcbiAgLyoqXG4gICAgICogVXNlciBwcm92aWRlZCBwcm9wcyB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBwcm9wcyBmb3IgdGhlIExhbWJkYSBmdW5jdGlvbi5cbiAgICAgKlxuICAgICAqIEBkZWZhdWx0IC0gRGVmYXVsdCBwcm9wZXJ0aWVzIGFyZSB1c2VkLlxuICAgICAqL1xuICByZWFkb25seSBsYW1iZGFGdW5jdGlvblByb3BzPzogbGFtYmRhLkZ1bmN0aW9uUHJvcHM7XG4gIC8qKlxuICAgICAqIEFuIGV4aXN0aW5nIFZQQyBmb3IgdGhlIGNvbnN0cnVjdCB0byB1c2UgKGNvbnN0cnVjdCB3aWxsIE5PVCBjcmVhdGUgYSBuZXcgVlBDIGluIHRoaXMgY2FzZSlcbiAgICAgKi9cbiAgcmVhZG9ubHkgZXhpc3RpbmdWcGM/OiBlYzIuSVZwYztcbiAgLyoqXG4gICAgICogUHJvcGVydGllcyB0byBvdmVycmlkZSBkZWZhdWx0IHByb3BlcnRpZXMgaWYgZGVwbG95VnBjIGlzIHRydWVcbiAgICAgKi9cbiAgcmVhZG9ubHkgdnBjUHJvcHM/OiBlYzIuVnBjUHJvcHM7XG4gIC8qKlxuICAgICAqIFdoZXRoZXIgdG8gZGVwbG95IGEgbmV3IFZQQ1xuICAgICAqXG4gICAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgICAqL1xuICByZWFkb25seSBkZXBsb3lWcGM/OiBib29sZWFuO1xuICAvKipcbiAgICAgKiBPcHRpb25hbCBOYW1lIGZvciB0aGUgTGFtYmRhIGZ1bmN0aW9uIGVudmlyb25tZW50IHZhcmlhYmxlIHNldCB0byB0aGUgaW5kZXggaWQgZm9yIHRoZSBLZW5kcmEgaW5kZXguXG4gICAgICpcbiAgICAgKiBAZGVmYXVsdCAtIEtFTkRSQV9JTkRFWF9JRFxuICAgICAqL1xuICByZWFkb25seSBpbmRleElkRW52aXJvbm1lbnRWYXJpYWJsZU5hbWU/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbC4gQWxsb3dzIHRvIHByb3ZpZGUgR2VuZXJhdGUgUHJlLXNpZ25lZCBVcmwgY3VzdG9tIGxhbWJkYSBjb2RlXG4gICAqIGFuZCBzZXR0aW5ncyBpbnN0ZWFkIG9mIHRoZSBleGlzdGluZ1xuICAgKi9cbiAgcmVhZG9ubHkgZ2VuZXJhdGVQcmVzaWduZWRVcmxMYW1iZGFQcm9wcz86IERvY2tlckxhbWJkYUN1c3RvbVByb3BzIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIEtlbmRyYSBTdGFydCBEYXRhIFN5bmMgSm9iIGN1c3RvbSBsYW1iZGEgY29kZVxuICAgKiBhbmQgc2V0dGluZ3MgaW5zdGVhZCBvZiB0aGUgZXhpc3RpbmdcbiAgICovXG4gIHJlYWRvbmx5IGtlbmRyYVN0YXJ0RGF0YVN5bmNMYW1iZGFQcm9wcz86IERvY2tlckxhbWJkYUN1c3RvbVByb3BzIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIENoZWNrIFN5bmMgSm9iIFN0YXR1cyBjdXN0b20gbGFtYmRhIGNvZGVcbiAgICogYW5kIHNldHRpbmdzIGluc3RlYWQgb2YgdGhlIGV4aXN0aW5nXG4gICAqL1xuICByZWFkb25seSBjaGVja0pvYnNTdGF0dXNMYW1iZGFQcm9wcz86IERvY2tlckxhbWJkYUN1c3RvbVByb3BzIHwgdW5kZWZpbmVkO1xuICAvKipcbiAgICogT3B0aW9uYWwuIEFsbG93cyB0byBwcm92aWRlIFVwZGF0ZSBLbmRyYSBTeW5jIEpvYiBTdGF0dXMgY3VzdG9tIGxhbWJkYSBjb2RlXG4gICAqIGFuZCBzZXR0aW5ncyBpbnN0ZWFkIG9mIHRoZSBleGlzdGluZ1xuICAgKi9cbiAgcmVhZG9ubHkgdXBkYXRlS2VuZHJhSm9iU3RhdHVzTGFtYmRhUHJvcHM/OiBEb2NrZXJMYW1iZGFDdXN0b21Qcm9wcyB8IHVuZGVmaW5lZDtcbiAgLyoqXG4gICAqIE9wdGlvbmFsLkNESyBjb25zdHJ1Y3RzIHByb3ZpZGVkIGNvbGxlY3RzIGFub255bW91cyBvcGVyYXRpb25hbFxuICAgKiBtZXRyaWNzIHRvIGhlbHAgQVdTIGltcHJvdmUgdGhlIHF1YWxpdHkgYW5kIGZlYXR1cmVzIG9mIHRoZVxuICAgKiBjb25zdHJ1Y3RzLiBEYXRhIGNvbGxlY3Rpb24gaXMgc3ViamVjdCB0byB0aGUgQVdTIFByaXZhY3kgUG9saWN5XG4gICAqIChodHRwczovL2F3cy5hbWF6b24uY29tL3ByaXZhY3kvKS4gVG8gb3B0IG91dCBvZiB0aGlzIGZlYXR1cmUsXG4gICAqIHNpbXBseSBkaXNhYmxlIGl0IGJ5IHNldHRpbmcgdGhlIGNvbnN0cnVjdCBwcm9wZXJ0eVxuICAgKiBcImVuYWJsZU9wZXJhdGlvbmFsTWV0cmljXCIgdG8gZmFsc2UgZm9yIGVhY2ggY29uc3RydWN0IHVzZWQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdHJ1ZVxuICAgKi9cbiAgcmVhZG9ubHkgZW5hYmxlT3BlcmF0aW9uYWxNZXRyaWM/OiBib29sZWFuO1xufVxuXG5lbnVtIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtIHtcbiAgRFlOQU1PREI9ICdEREInLFxuICBFQ1JfQVBJPSAnRUNSX0FQSScsXG4gIEVDUl9ES1I9ICdFQ1JfREtSJyxcbiAgRVZFTlRTPSAnQ0xPVURXQVRDSF9FVkVOVFMnLFxuICBLRU5EUkE9ICdLRU5EUkEnLFxuICBLSU5FU0lTX0ZJUkVIT1NFPSAnS0lORVNJU19GSVJFSE9TRScsXG4gIEtJTkVTSVNfU1RSRUFNUz0gJ0tJTkVTSVNfU1RSRUFNUycsXG4gIFMzPSAnUzMnLFxuICBTQUdFTUFLRVJfUlVOVElNRT0gJ1NBR0VNQUtFUl9SVU5USU1FJyxcbiAgU0VDUkVUU19NQU5BR0VSPSAnU0VDUkVUU19NQU5BR0VSJyxcbiAgU05TPSAnU05TJyxcbiAgU1FTPSAnU1FTJyxcbiAgU1NNPSAnU1NNJyxcbiAgU1RFUF9GVU5DVElPTlM9ICdTVEVQX0ZVTkNUSU9OUycsXG59XG5cbi8qKlxuICogQHN1bW1hcnkgVGhlIFJhZ0FwcHN5bmNTdGVwZm5LZW5kcmEgY2xhc3MuXG4gKi9cbmV4cG9ydCBjbGFzcyBSYWdBcHBzeW5jU3RlcGZuS2VuZHJhIGV4dGVuZHMgQmFzZUNsYXNzIHtcbiAgcHVibGljIHJlYWRvbmx5IHZwYz86IGVjMi5JVnBjO1xuICBwdWJsaWMgcmVhZG9ubHkga2VuZHJhSW5kZXg6IEtlbmRyYUNvbnN0cnVjdDtcbiAgcHVibGljIHJlYWRvbmx5IGtlbmRyYUlucHV0QnVja2V0OiBCdWNrZXQ7XG5cbiAgcHVibGljIHJlYWRvbmx5IGdyYXBocWxBcGk6IGFwcHN5bmMuSUdyYXBocWxBcGk7XG4gIHByaXZhdGUgcmVhZG9ubHkga2VuZHJhSW5kZXhJZDogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGF3c1JlZ2lvbjogc3RyaW5nO1xuICBwcml2YXRlIHJlYWRvbmx5IGF3c0FjY291bnRJZDogc3RyaW5nO1xuICBsYW1iZGFUcmFjaW5nOiBsYW1iZGEuVHJhY2luZz1sYW1iZGEuVHJhY2luZy5BQ1RJVkU7XG4gIGtlbmRyYUlucHV0QnVja2V0QXJuOiBzdHJpbmc7XG4gIHB1YmxpYyByZWFkb25seSBzZWN1cml0eUdyb3VwOiBlYzIuSVNlY3VyaXR5R3JvdXA7XG5cbiAgLyoqXG4gICAgICogUmV0dXJucyBhbiBpbnN0YW5jZSBvZiBhcHBzeW5jLklHcmFwaHFsQXBpIGNyZWF0ZWQgYnkgdGhlIGNvbnN0cnVjdFxuICAgICAqL1xuICBkb2NQcm9jZXNzaW5nU3RhdGVNYWNoaW5lOiBTdGF0ZU1hY2hpbmU7XG4gIHN0ZXBGdW5jdGlvbnNFeGVjdXRpb25IYW5kbGVyUm9sZTogY2RrLmF3c19pYW0uUm9sZTtcbiAgcmVtb3ZhbFBvbGljeTogUmVtb3ZhbFBvbGljeTtcbiAgc3luY1J1blRhYmxlOiBUYWJsZTtcbiAgLy8gICBUT0RPKG1pa2V0cmFuKTogUmlnaHQgbm93LCB3ZSBzdXBwb3J0IFMzLCB0aGVuIGV2ZW50dWFsbHkgd2lsbCBvcGVuIGl0IHVwIHRvIG90aGVyIGRhdGEgc291cmNlcy5cbiAgcHJpdmF0ZSBrZW5kcmFEYXRhU291cmNlSW5kZXhJZDogc3RyaW5nO1xuICBwcml2YXRlIHN0YWNrOiBTdGFjaztcbiAgY29nbml0bzogY29nbml0by5Vc2VyUG9vbDtcblxuXG4gIC8qKlxuICAgICAqIEBzdW1tYXJ5IENvbnN0cnVjdHMgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIFJhZ0FwcHN5bmNTdGVwZm5LZW5kcmEgY2xhc3MuXG4gICAgICogQHBhcmFtIHtjZGsuQXBwfSBzY29wZSAtIHJlcHJlc2VudHMgdGhlIHNjb3BlIGZvciBhbGwgdGhlIHJlc291cmNlcy5cbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSB0aGlzIGlzIGEgc2NvcGUtdW5pcXVlIGlkLlxuICAgICAqIEBwYXJhbSB7UmFnQXBwc3luY1N0ZXBmbktlbmRyYVByb3BzfSBwcm9wcyAtIHVzZXIgcHJvdmlkZWQgcHJvcHMgZm9yIHRoZSBjb25zdHJ1Y3QuXG4gICAgICogQHNpbmNlIDAuMC4wXG4gICAgICogQGFjY2VzcyBwdWJsaWNcbiAgICovXG4gIGNvbnN0cnVjdG9yKHNjb3BlOiBDb25zdHJ1Y3QsIGlkOiBzdHJpbmcsIHByb3BzOiBSYWdBcHBzeW5jU3RlcGZuS2VuZHJhUHJvcHMpIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgY29uc3QgYmFzZVByb3BzOiBCYXNlQ2xhc3NQcm9wcz17XG4gICAgICBzdGFnZTogcHJvcHMuc3RhZ2UsXG4gICAgICBlbmFibGVPcGVyYXRpb25hbE1ldHJpYzogcHJvcHMuZW5hYmxlT3BlcmF0aW9uYWxNZXRyaWMsXG4gICAgICBjb25zdHJ1Y3ROYW1lOiBDb25zdHJ1Y3ROYW1lLkFXU1JBR0FQUFNZTkNTVEVQRk5LRU5EUkEsXG4gICAgICBjb25zdHJ1Y3RJZDogaWQsXG4gICAgICBvYnNlcnZhYmlsaXR5OiBwcm9wcy5vYnNlcnZhYmlsaXR5LFxuICAgIH07XG5cbiAgICB0aGlzLnVwZGF0ZUVudlN1ZmZpeChiYXNlUHJvcHMpO1xuICAgIHRoaXMuYWRkT2JzZXJ2YWJpbGl0eVRvQ29uc3RydWN0KGJhc2VQcm9wcyk7XG5cbiAgICB0aGlzLmNvZ25pdG8gPSBwcm9wcy5jb2duaXRvVXNlclBvb2w7XG5cbiAgICB0aGlzLmF3c0FjY291bnRJZCA9IGNkay5TdGFjay5vZih0aGlzKS5hY2NvdW50O1xuICAgIHRoaXMuYXdzUmVnaW9uID0gY2RrLlN0YWNrLm9mKHRoaXMpLnJlZ2lvbjtcbiAgICB0aGlzLnN0YWNrID0gY2RrLlN0YWNrLm9mKHRoaXMpO1xuICAgIHRoaXMucmVtb3ZhbFBvbGljeSA9IGNkay5SZW1vdmFsUG9saWN5LkRFU1RST1k7XG5cbiAgICAvLyBTdGFnaW5nIGVudmlyb25tZW50XG4gICAgbGV0IHN0YWdlID0gJy1kZXYnO1xuICAgIGlmIChwcm9wcz8uc3RhZ2UpIHtcbiAgICAgIHN0YWdlID0gcHJvcHMuc3RhZ2U7XG4gICAgfVxuXG4gICAgaWYgKHByb3BzPy5leGlzdGluZ1ZwYykge1xuICAgICAgdGhpcy52cGMgPSBwcm9wcy5leGlzdGluZ1ZwYztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52cGMgPSBuZXcgZWMyLlZwYyh0aGlzLCAnVnBjJywgcHJvcHMudnBjUHJvcHMpO1xuICAgIH1cblxuICAgIGlmIChwcm9wcz8uZXhpc3RpbmdTZWN1cml0eUdyb3VwKSB7XG4gICAgICB0aGlzLnNlY3VyaXR5R3JvdXAgPSBwcm9wcy5leGlzdGluZ1NlY3VyaXR5R3JvdXA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VjdXJpdHlHcm91cCA9IG5ldyBlYzIuU2VjdXJpdHlHcm91cCh0aGlzLCAnc2VjdXJpdHlHcm91cCcsIHtcbiAgICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgICAgYWxsb3dBbGxPdXRib3VuZDogdHJ1ZSxcbiAgICAgICAgc2VjdXJpdHlHcm91cE5hbWU6ICdzZWN1cml0eUdyb3VwJyArIHN0YWdlLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IGVuYWJsZVhSYXkgPSB0cnVlO1xuICAgIGxldCBhcGlMb2dDb25maWcgPSB7XG4gICAgICBmaWVsZExvZ0xldmVsOiBhcHBzeW5jLkZpZWxkTG9nTGV2ZWwuQUxMLFxuICAgICAgcmV0ZW50aW9uOiBsb2dzLlJldGVudGlvbkRheXMuVEVOX1lFQVJTLFxuICAgIH07XG5cbiAgICBpZiAocHJvcHMub2JzZXJ2YWJpbGl0eSA9PT0gZmFsc2UpIHtcbiAgICAgIGVuYWJsZVhSYXkgPSBmYWxzZTtcbiAgICAgIGFwaUxvZ0NvbmZpZyA9IHtcbiAgICAgICAgZmllbGRMb2dMZXZlbDogYXBwc3luYy5GaWVsZExvZ0xldmVsLk5PTkUsXG4gICAgICAgIHJldGVudGlvbjogbG9ncy5SZXRlbnRpb25EYXlzLlRFTl9ZRUFSUyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHByb3BzLmtlbmRyYUluZGV4UHJvcHMgJiYgcHJvcHMuZXhpc3RpbmdLZW5kcmFJbmRleE9iaikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdZb3UgbWF5IG5vdCBwcm92aWRlIGJvdGgga2VuZHJhSW5kZXhQcm9wcyBhbmQgZXhpc3RpbmdLZW5kcmFJbmRleE9iaicpO1xuICAgIH1cblxuICAgIGlmIChwcm9wcy5rZW5kcmFJbmRleFByb3BzICYmIHByb3BzLmtlbmRyYURhdGFTb3VyY2VzUHJvcHMpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignWW91IG1heSBub3QgcHJvdmlkZSBib3RoIGtlbmRyYURhdGFTb3VyY2VzUHJvcHMgYW5kIGV4aXN0aW5nS2VuZHJhSW5kZXhPYmonKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcHMuZGVwbG95VnBjIHx8IHByb3BzLmV4aXN0aW5nVnBjKSB7XG4gICAgICB0aGlzLnZwYyA9IGJ1aWxkVnBjKHNjb3BlLCB7XG4gICAgICAgIGRlZmF1bHRWcGNQcm9wczogY3JlYXRlRGVmYXVsdElzb2xhdGVkVnBjUHJvcHMoKSxcbiAgICAgICAgZXhpc3RpbmdWcGM6IHByb3BzLmV4aXN0aW5nVnBjLFxuICAgICAgICB1c2VyVnBjUHJvcHM6IHByb3BzLnZwY1Byb3BzLFxuICAgICAgICBjb25zdHJ1Y3RWcGNQcm9wczoge1xuICAgICAgICAgIGVuYWJsZURuc0hvc3RuYW1lczogdHJ1ZSxcbiAgICAgICAgICBlbmFibGVEbnNTdXBwb3J0OiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIEFkZEF3c1NlcnZpY2VFbmRwb2ludChzY29wZSwgdGhpcy52cGMsIFNlcnZpY2VFbmRwb2ludFR5cGVFbnVtLktFTkRSQSk7XG4gICAgfVxuICAgIHRoaXMua2VuZHJhSW5wdXRCdWNrZXQgPSBuZXcgQnVja2V0KHRoaXMsICdrZW5kcmFJbnB1dEJ1Y2tldCcsIHtcbiAgICAgIGFjY2Vzc0NvbnRyb2w6IEJ1Y2tldEFjY2Vzc0NvbnRyb2wuUFJJVkFURSxcbiAgICAgIGVuZm9yY2VTU0w6IHRydWUsXG4gICAgICBldmVudEJyaWRnZUVuYWJsZWQ6IHRydWUsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNvZ25pdG8gPSBwcm9wcy5jb2duaXRvVXNlclBvb2w7XG5cblxuICAgIHRoaXMua2VuZHJhSW5kZXggPSBuZXcgS2VuZHJhQ29uc3RydWN0KHRoaXMsICdsbG1EZW1vSW5kZXgnLCB7XG4gICAgICBJbmRleE5hbWU6ICdsbG1EZW1vS2VuZHJhSW5kZXgnLFxuICAgICAgRWRpdGlvbjogJ0RFVkVMT1BFUl9FRElUSU9OJyxcbiAgICAgIGtlbmRyYURhdGFTeW5jSW5wdXRCdWNrZXROYW1lOiB0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICBDb2duaXRvVXNlclBvb2xJZDogdGhpcy5jb2duaXRvLnVzZXJQb29sSWQsXG4gICAgfSk7XG5cbiAgICB0aGlzLmtlbmRyYUluZGV4SWQgPSB0aGlzLmtlbmRyYUluZGV4LktlbmRyYUluZGV4SWQ7XG4gICAgdGhpcy5rZW5kcmFEYXRhU291cmNlSW5kZXhJZCA9IHRoaXMua2VuZHJhSW5kZXguS2VuZHJhRGF0YVNvdXJjZUluZGV4SWQ7XG5cbiAgICB0aGlzLmtlbmRyYUlucHV0QnVja2V0QXJuID0gdGhpcy5rZW5kcmFJbnB1dEJ1Y2tldC5idWNrZXRBcm47XG5cbiAgICB0aGlzLmtlbmRyYUlucHV0QnVja2V0LmFkZENvcnNSdWxlKHtcbiAgICAgIGFsbG93ZWRPcmlnaW5zOiBbJyonXSxcbiAgICAgIGFsbG93ZWRNZXRob2RzOiBbSHR0cE1ldGhvZHMuR0VULCBIdHRwTWV0aG9kcy5QVVQsIEh0dHBNZXRob2RzLlBPU1QsIEh0dHBNZXRob2RzLkRFTEVURSwgSHR0cE1ldGhvZHMuSEVBRF0sXG4gICAgICBhbGxvd2VkSGVhZGVyczogWycqJ10sXG4gICAgICBleHBvc2VkSGVhZGVyczogWydFVGFnJ10sIC8vIEZvciBTdG9yYWdlIFB1dCB3aXRoIE9iamVjdCBzaXplID4gNU1CXG4gICAgICBtYXhBZ2U6IDMwMDAsXG4gICAgfSk7XG5cbiAgICBjb25zdCBrZW5kcmFBQ0wgPSBbXG4gICAgICB7XG4gICAgICAgIGtleVByZWZpeDogYHMzOi8vJHt0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWV9L3B1YmxpYy9CdXNpbmVzc1RlYW0xL2AsXG4gICAgICAgIGFjbEVudHJpZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBOYW1lOiAnQnVzaW5lc3NUZWFtMScsXG4gICAgICAgICAgICBUeXBlOiAnR1JPVVAnLFxuICAgICAgICAgICAgQWNjZXNzOiAnQUxMT1cnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgTmFtZTogJ0FkbWluJyxcbiAgICAgICAgICAgIFR5cGU6ICdHUk9VUCcsXG4gICAgICAgICAgICBBY2Nlc3M6ICdBTExPVycsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGtleVByZWZpeDogYHMzOi8vJHt0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWV9L3B1YmxpYy9CdXNpbmVzc1RlYW0yL2AsXG4gICAgICAgIGFjbEVudHJpZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBOYW1lOiAnQnVzaW5lc3NUZWFtMicsXG4gICAgICAgICAgICBUeXBlOiAnR1JPVVAnLFxuICAgICAgICAgICAgQWNjZXNzOiAnQUxMT1cnLFxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgTmFtZTogJ0FkbWluJyxcbiAgICAgICAgICAgIFR5cGU6ICdHUk9VUCcsXG4gICAgICAgICAgICBBY2Nlc3M6ICdBTExPVycsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGtleVByZWZpeDogYHMzOi8vJHt0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWV9L3B1YmxpYy9BZG1pbnNPbmx5L2AsXG4gICAgICAgIGFjbEVudHJpZXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBOYW1lOiAnQWRtaW4nLFxuICAgICAgICAgICAgVHlwZTogJ0dST1VQJyxcbiAgICAgICAgICAgIEFjY2VzczogJ0FMTE9XJyxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgY29uc3Qga2VuZHJhQWNsVXBsb2FkZXIgPSBuZXcgQXdzQ3VzdG9tUmVzb3VyY2UodGhpcywgJ2tlbmRyYUFjbFVwbG9hZGVyJywge1xuICAgICAgb25VcGRhdGU6IHtcbiAgICAgICAgYWN0aW9uOiAncHV0T2JqZWN0JyxcbiAgICAgICAgcGFyYW1ldGVyczoge1xuICAgICAgICAgIEJvZHk6IEpTT04uc3RyaW5naWZ5KGtlbmRyYUFDTCksXG4gICAgICAgICAgQnVja2V0OiB0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgICAgICAgQ2FjaGVDb250cm9sOiAnbWF4LWFnZT0wLCBuby1jYWNoZSwgbm8tc3RvcmUsIG11c3QtcmV2YWxpZGF0ZScsXG4gICAgICAgICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICBLZXk6ICdrZW5kcmFfYWNsLmpzb24nLFxuICAgICAgICB9LFxuICAgICAgICBwaHlzaWNhbFJlc291cmNlSWQ6IFBoeXNpY2FsUmVzb3VyY2VJZC5vZigna2VuZHJhX2FjbCcpLFxuICAgICAgICBzZXJ2aWNlOiAnUzMnLFxuICAgICAgfSxcbiAgICAgIHBvbGljeTogQXdzQ3VzdG9tUmVzb3VyY2VQb2xpY3kuZnJvbVN0YXRlbWVudHMoW1xuICAgICAgICBuZXcgUG9saWN5U3RhdGVtZW50KHtcbiAgICAgICAgICBhY3Rpb25zOiBbJ3MzOlB1dE9iamVjdCddLFxuICAgICAgICAgIHJlc291cmNlczogW3RoaXMua2VuZHJhSW5wdXRCdWNrZXQuYXJuRm9yT2JqZWN0cygna2VuZHJhX2FjbC5qc29uJyldLFxuICAgICAgICB9KSxcbiAgICAgIF0pLFxuICAgIH0pO1xuXG4gICAgdGhpcy5rZW5kcmFJbmRleC5ub2RlLmFkZERlcGVuZGVuY3koa2VuZHJhQWNsVXBsb2FkZXIpO1xuXG5cbiAgICBuZXcgY2RrLkNmbk91dHB1dCh0aGlzLCAnS2VuZHJhQWNjZXNzQ29udHJvbExpc3RVcmwnLCB7XG4gICAgICB2YWx1ZTogYHMzOi8vJHt0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWV9L2tlbmRyYV9hY2wuanNvbmAsXG4gICAgfSk7XG5cbiAgICAvLyBUT0RPKG1pa2V0cmFuKTogRml4IHRoaXMgc2NoZW1hLlxuICAgIGNvbnN0IGluZ2VzdGlvbkdyYXBocWxBcGkgPSBuZXcgYXBwc3luYy5HcmFwaHFsQXBpKFxuICAgICAgdGhpcyxcbiAgICAgICdpbmdlc3Rpb25HcmFwaHFsQXBpJyxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2luZ2VzdGlvbkdyYXBocWxBcGknICsgc3RhZ2UsXG4gICAgICAgIGRlZmluaXRpb246IGFwcHN5bmMuRGVmaW5pdGlvbi5mcm9tRmlsZShcbiAgICAgICAgICBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vLi4vcmVzb3VyY2VzL2dlbi1haS9hd3MtcmFnLWFwcHN5bmMtc3RlcGZuLWtlbmRyYS9zY2hlbWEuZ3JhcGhxbCcpLFxuICAgICAgICApLFxuICAgICAgICBhdXRob3JpemF0aW9uQ29uZmlnOiB7XG4gICAgICAgICAgZGVmYXVsdEF1dGhvcml6YXRpb246IHtcbiAgICAgICAgICAgIGF1dGhvcml6YXRpb25UeXBlOiBhcHBzeW5jLkF1dGhvcml6YXRpb25UeXBlLlVTRVJfUE9PTCxcbiAgICAgICAgICAgIHVzZXJQb29sQ29uZmlnOiB7IHVzZXJQb29sOiB0aGlzLmNvZ25pdG8gfSxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFkZGl0aW9uYWxBdXRob3JpemF0aW9uTW9kZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgYXV0aG9yaXphdGlvblR5cGU6IGFwcHN5bmMuQXV0aG9yaXphdGlvblR5cGUuSUFNLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgICB4cmF5RW5hYmxlZDogZW5hYmxlWFJheSxcbiAgICAgICAgbG9nQ29uZmlnOiBhcGlMb2dDb25maWcsXG4gICAgICB9LFxuICAgICk7XG4gICAgdGhpcy5ncmFwaHFsQXBpID0gaW5nZXN0aW9uR3JhcGhxbEFwaTtcbiAgICB0aGlzLnN5bmNSdW5UYWJsZSA9IGNyZWF0ZUtlbmRyYVN5bmNSdW5UYWJsZSh0aGlzKTtcblxuICAgIGNvbnN0IGxhbWJkYVByb3BzRW52ID0ge1xuICAgICAgS0VORFJBX0lOREVYX0lEOiB0aGlzLmtlbmRyYUluZGV4SWQsXG4gICAgICBLRU5EUkFfREFUQV9TT1VSQ0VfSU5ERVhfSUQ6IHRoaXMua2VuZHJhRGF0YVNvdXJjZUluZGV4SWQsXG4gICAgICBET0NVTUVOVFNfVEFCTEU6IHRoaXMuc3luY1J1blRhYmxlLnRhYmxlTmFtZSxcbiAgICAgIFMzX0JVQ0tFVF9OQU1FOiB0aGlzLmtlbmRyYUlucHV0QnVja2V0LmJ1Y2tldE5hbWUsXG4gICAgfTtcblxuICAgIGNvbnN0IGdlbmVyYXRlUHJlc2lnbmVkVXJsUm9sZSA9IGdldEdlbmVyYXRlUHJlc2lnbmVkVXJsTGFtYmRhUm9sZSh0aGlzLCB0aGlzLmtlbmRyYUlucHV0QnVja2V0KTtcbiAgICBjb25zdCBjb25zdHJ1Y3RHZW5lcmF0ZVByZXNpZ25lZFVybExhbWJkYVByb3BzID0ge1xuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy1yYWctYXBwc3luYy1zdGVwZm4ta2VuZHJhL2dlbmVyYXRlX3ByZXNpZ25lZF91cmwvc3JjJykpLFxuICAgICAgZnVuY3Rpb25OYW1lOiAnczNfcHJlX3NpZ25lZF9saW5rc19nZW5lcmF0b3JfZG9ja2VyJyArIHN0YWdlLFxuICAgICAgZGVzY3JpcHRpb246ICdMYW1iZGEgZnVuY3Rpb24gZm9yIHByZS1zaWduZWQgbGlua3MgZ2VuZXJhdGlvbicsXG4gICAgICB2cGM6IHRoaXMudnBjLFxuICAgICAgdHJhY2luZzogdGhpcy5sYW1iZGFUcmFjaW5nLFxuICAgICAgdnBjU3VibmV0czogeyBzdWJuZXRUeXBlOiBlYzIuU3VibmV0VHlwZS5QUklWQVRFX1dJVEhfRUdSRVNTIH0sXG4gICAgICBzZWN1cml0eUdyb3VwczogW3RoaXMuc2VjdXJpdHlHcm91cF0sXG4gICAgICBtZW1vcnlTaXplOiBsYW1iZGFNZW1vcnlTaXplTGltaXRlcih0aGlzLCAxXzc2OSksXG4gICAgICB0aW1lb3V0OiBEdXJhdGlvbi5taW51dGVzKDE1KSxcbiAgICAgIHJvbGU6IGdlbmVyYXRlUHJlc2lnbmVkVXJsUm9sZSxcbiAgICAgIGVudmlyb25tZW50OiBsYW1iZGFQcm9wc0VudixcbiAgICB9O1xuICAgIGNvbnN0IGdlbmVyYXRlUHJlc2lnbmVkVXJsTGFtYmRhID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAnZ2VuZXJhdGVQcmVzaWduZWRVcmxGTicsXG4gICAgICBjb25zdHJ1Y3RHZW5lcmF0ZVByZXNpZ25lZFVybExhbWJkYVByb3BzLFxuICAgICAgcHJvcHMuZ2VuZXJhdGVQcmVzaWduZWRVcmxMYW1iZGFQcm9wcyxcbiAgICApO1xuXG4gICAgY29uc3Qgc3RhcnREYXRhU3luY1JvbGUgPSBnZXRLZW5kcmFTdGFydERhdGFTeW5jTGFtYmRhUm9sZShcbiAgICAgIHRoaXMsIHRoaXMuc3luY1J1blRhYmxlLCB0aGlzLmF3c1JlZ2lvbiwgdGhpcy5hd3NBY2NvdW50SWQsIHRoaXMua2VuZHJhSW5kZXhJZCwgdGhpcy5rZW5kcmFEYXRhU291cmNlSW5kZXhJZCxcbiAgICApO1xuICAgIGNvbnN0IGNvbnN0cnVjdFN0YXJ0RGF0YVN5bmNKb2JMYW1iZGFQcm9wcyA9IHtcbiAgICAgIGNvZGU6IGxhbWJkYS5Eb2NrZXJJbWFnZUNvZGUuZnJvbUltYWdlQXNzZXQocGF0aC5qb2luKF9fZGlybmFtZSwgJy4uLy4uLy4uLy4uL2xhbWJkYS9hd3MtcmFnLWFwcHN5bmMtc3RlcGZuLWtlbmRyYS9rZW5kcmFfc3luYy9zcmMnKSksXG4gICAgICBmdW5jdGlvbk5hbWU6ICdrZW5kcmFfc3RhcnRfc3luY19qb2JfZG9ja2VyJytzdGFnZSxcbiAgICAgIGRlc2NyaXB0aW9uOiAnTGFtYmRhIGZ1bmN0aW9uIGZvciBLZW5kcmEgIHN5bmMgam9iIHN0YXJ0aW5nJyxcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB0cmFjaW5nOiB0aGlzLmxhbWJkYVRyYWNpbmcsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfV0lUSF9FR1JFU1MgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbdGhpcy5zZWN1cml0eUdyb3VwXSxcbiAgICAgIG1lbW9yeVNpemU6IGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyKHRoaXMsIDFfNzY5KSxcbiAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLm1pbnV0ZXMoMTUpLFxuICAgICAgcm9sZTogc3RhcnREYXRhU3luY1JvbGUsXG4gICAgICBlbnZpcm9ubWVudDogbGFtYmRhUHJvcHNFbnYsXG4gICAgfTtcbiAgICBjb25zdCBrZW5kcmFTeW5jTGFtYmRhID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAna2VuZHJhU3RhcnREYXRhU3luYycsXG4gICAgICBjb25zdHJ1Y3RTdGFydERhdGFTeW5jSm9iTGFtYmRhUHJvcHMsXG4gICAgICBwcm9wcy5rZW5kcmFTdGFydERhdGFTeW5jTGFtYmRhUHJvcHMsXG4gICAgKTtcblxuICAgIGNvbnN0IGNoZWNrSm9iU3RhdHVzTGFtYmRhUm9sZSA9IGdldENoZWNrSm9iU3RhdHVzTGFtYmRhUm9sZShcbiAgICAgIHRoaXMsIHRoaXMuYXdzUmVnaW9uLCB0aGlzLmF3c0FjY291bnRJZCwgdGhpcy5rZW5kcmFJbmRleElkLCB0aGlzLmtlbmRyYURhdGFTb3VyY2VJbmRleElkLFxuICAgICk7XG4gICAgY29uc3QgY29uc3RydWN0Q2hlY2tKb2JTdGF0dXNMYW1iZGFQcm9wczogRG9ja2VySW1hZ2VGdW5jdGlvblByb3BzID0ge1xuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy1yYWctYXBwc3luYy1zdGVwZm4ta2VuZHJhL2tlbmRyYV9zeW5jX3N0YXR1cy9zcmMnKSksXG4gICAgICBmdW5jdGlvbk5hbWU6ICdrZW5kcmFfY2hlY2tfc3luY19qb2Jfc3RhdHVzX2RvY2tlcicrc3RhZ2UsXG4gICAgICBkZXNjcmlwdGlvbjogJ0xhbWJkYSBmdW5jdGlvbiBmb3IgZ2V0dGluZyBrZW5kcmEgc3luYyBzdGF0dXMnLFxuICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgIHRyYWNpbmc6IHRoaXMubGFtYmRhVHJhY2luZyxcbiAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9XSVRIX0VHUkVTUyB9LFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFt0aGlzLnNlY3VyaXR5R3JvdXBdLFxuICAgICAgbWVtb3J5U2l6ZTogbGFtYmRhTWVtb3J5U2l6ZUxpbWl0ZXIodGhpcywgMV83NjkpLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxNSksXG4gICAgICBlbnZpcm9ubWVudDogbGFtYmRhUHJvcHNFbnYsXG4gICAgICByb2xlOiBjaGVja0pvYlN0YXR1c0xhbWJkYVJvbGUsXG4gICAgfTtcblxuICAgIGNvbnN0IGNyZWF0ZUNoZWNrSm9ic1N0YXR1c0xhbWJkYSA9IGJ1aWxkRG9ja2VyTGFtYmRhRnVuY3Rpb24oXG4gICAgICB0aGlzLFxuICAgICAgJ2NoZWNrSm9iU3RhdHVzRk4nLFxuICAgICAgY29uc3RydWN0Q2hlY2tKb2JTdGF0dXNMYW1iZGFQcm9wcyxcbiAgICAgIHByb3BzLmNoZWNrSm9ic1N0YXR1c0xhbWJkYVByb3BzLFxuICAgICk7XG5cbiAgICBjb25zdCB1cGRhdGVLZW5kcmFKb2JTdGF0dXNMYW1iZGFSb2xlID0gZ2V0VXBkYXRlS2VuZHJhSm9iU3RhdHVzTGFtYmRhUm9sZSh0aGlzLCB0aGlzLnN5bmNSdW5UYWJsZSk7XG4gICAgY29uc3QgY29uc3RydWN0S2VuZHJhSm9iU3RhdHVzTGFtYmRhUHJvcHMgPSB7XG4gICAgICBjb2RlOiBsYW1iZGEuRG9ja2VySW1hZ2VDb2RlLmZyb21JbWFnZUFzc2V0KHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi8uLi8uLi8uLi9sYW1iZGEvYXdzLXJhZy1hcHBzeW5jLXN0ZXBmbi1rZW5kcmEva2VuZHJhX2pvYl9tYW5hZ2VyL3NyYycpKSxcbiAgICAgIGZ1bmN0aW9uTmFtZTogJ2tlbmRyYV9qb2JfbWFuYWdlcl9kb2NrZXInK3N0YWdlLFxuICAgICAgZGVzY3JpcHRpb246ICdMYW1iZGEgZnVuY3Rpb24gZm9yIEtlbmRyYSBqb2Igc3RhdHVzIHVwZGF0ZXMnLFxuICAgICAgdnBjOiB0aGlzLnZwYyxcbiAgICAgIHRyYWNpbmc6IHRoaXMubGFtYmRhVHJhY2luZyxcbiAgICAgIHZwY1N1Ym5ldHM6IHsgc3VibmV0VHlwZTogZWMyLlN1Ym5ldFR5cGUuUFJJVkFURV9XSVRIX0VHUkVTUyB9LFxuICAgICAgc2VjdXJpdHlHcm91cHM6IFt0aGlzLnNlY3VyaXR5R3JvdXBdLFxuICAgICAgbWVtb3J5U2l6ZTogbGFtYmRhTWVtb3J5U2l6ZUxpbWl0ZXIodGhpcywgMV83NjkpLFxuICAgICAgdGltZW91dDogRHVyYXRpb24ubWludXRlcygxNSksXG4gICAgICByb2xlOiB1cGRhdGVLZW5kcmFKb2JTdGF0dXNMYW1iZGFSb2xlLFxuICAgICAgZW52aXJvbm1lbnQ6IGxhbWJkYVByb3BzRW52LFxuICAgIH07XG4gICAgY29uc3QgdXBkYXRlS2VuZHJhSm9iU3RhdHVzTGFtYmRhID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAndXBkYXRlS2VuZHJhSm9iU3RhdHVzRm4nLFxuICAgICAgY29uc3RydWN0S2VuZHJhSm9iU3RhdHVzTGFtYmRhUHJvcHMsXG4gICAgICBwcm9wcy51cGRhdGVLZW5kcmFKb2JTdGF0dXNMYW1iZGFQcm9wcyxcbiAgICApO1xuXG4gICAgdGhpcy5kb2NQcm9jZXNzaW5nU3RhdGVNYWNoaW5lID0gY3JlYXRlS2VuZHJhV29ya2Zsb3dTdGVwRnVuY3Rpb24oXG4gICAgICB0aGlzLnN0YWNrLFxuICAgICAgdXBkYXRlS2VuZHJhSm9iU3RhdHVzTGFtYmRhLFxuICAgICAga2VuZHJhU3luY0xhbWJkYSxcbiAgICAgIGNyZWF0ZUNoZWNrSm9ic1N0YXR1c0xhbWJkYSxcbiAgICApO1xuXG4gICAgdGhpcy5zdGVwRnVuY3Rpb25zRXhlY3V0aW9uSGFuZGxlclJvbGUgPSBjcmVhdGVTdGVwRnVuY3Rpb25zRXhlY3V0aW9uSGFuZGxlclJvbGUoXG4gICAgICB0aGlzLnN0YWNrLFxuICAgICAgdGhpcy5kb2NQcm9jZXNzaW5nU3RhdGVNYWNoaW5lLFxuICAgICk7XG5cbiAgICBjb25zdCBzdGFydEtlbmRyYVN5bmNTdGVwRm5Sb2xlID0gZ2V0U3RhcnRLZW5kcmFTeW5jU3RlcEZuUm9sZSh0aGlzLCB0aGlzLmRvY1Byb2Nlc3NpbmdTdGF0ZU1hY2hpbmUpO1xuICAgIGNvbnN0IGNvbnN0cnVjdFN0YXJ0S2VuZHJhU3luY1N0ZXBGbkxhbWJkYVByb3BzID0ge1xuICAgICAgY29kZTogbGFtYmRhLkRvY2tlckltYWdlQ29kZS5mcm9tSW1hZ2VBc3NldChwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vLi4vLi4vLi4vbGFtYmRhL2F3cy1yYWctYXBwc3luYy1zdGVwZm4ta2VuZHJhL3N0YXJ0X2tlbmRyYV9zeW5jX3N0ZXBmbi9zcmMnKSksXG4gICAgICBmdW5jdGlvbk5hbWU6ICdzdGFydF9rbmRyYV9zeW5jX3N0ZXBfZm4nICsgc3RhZ2UsXG4gICAgICBkZXNjcmlwdGlvbjogJ0xhbWJkYSBmb3Igc3RhcnRpbmcgZXhlY3V0aW9uJyxcbiAgICAgIHZwYzogdGhpcy52cGMsXG4gICAgICB0cmFjaW5nOiB0aGlzLmxhbWJkYVRyYWNpbmcsXG4gICAgICB2cGNTdWJuZXRzOiB7IHN1Ym5ldFR5cGU6IGVjMi5TdWJuZXRUeXBlLlBSSVZBVEVfV0lUSF9FR1JFU1MgfSxcbiAgICAgIHNlY3VyaXR5R3JvdXBzOiBbdGhpcy5zZWN1cml0eUdyb3VwXSxcbiAgICAgIG1lbW9yeVNpemU6IGxhbWJkYU1lbW9yeVNpemVMaW1pdGVyKHRoaXMsIDFfNzY5KSxcbiAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLm1pbnV0ZXMoMTUpLFxuICAgICAgcm9sZTogc3RhcnRLZW5kcmFTeW5jU3RlcEZuUm9sZSxcbiAgICAgIGVudmlyb25tZW50OiB7XG4gICAgICAgIC4uLmxhbWJkYVByb3BzRW52LFxuICAgICAgICBTVEVQX0ZVTkNUSU9OX0FSTjogdGhpcy5kb2NQcm9jZXNzaW5nU3RhdGVNYWNoaW5lLnN0YXRlTWFjaGluZUFybixcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGNvbnN0IHN0YXJ0S2VuZHJhU3RlcEZuTGFtYmRhID0gYnVpbGREb2NrZXJMYW1iZGFGdW5jdGlvbihcbiAgICAgIHRoaXMsXG4gICAgICAnc3RhcnRLZW5kcmFTdGVwRm5MYW1iZGEnLFxuICAgICAgY29uc3RydWN0U3RhcnRLZW5kcmFTeW5jU3RlcEZuTGFtYmRhUHJvcHMsXG4gICAgICB1bmRlZmluZWQsXG4gICAgKTtcblxuICAgIGNvbnN0IHByZXNpZ25lZFVybERhdGFTb3VyY2UgPSBpbmdlc3Rpb25HcmFwaHFsQXBpLmFkZExhbWJkYURhdGFTb3VyY2UoXG4gICAgICAncHJlc2lnbmVkVXJsRGF0YVNvdXJjZScsXG4gICAgICBnZW5lcmF0ZVByZXNpZ25lZFVybExhbWJkYSxcbiAgICApO1xuXG4gICAgcHJlc2lnbmVkVXJsRGF0YVNvdXJjZS5jcmVhdGVSZXNvbHZlcigncHJlc2lnbmVkVXJsUmVzb2x2ZXInLCB7XG4gICAgICB0eXBlTmFtZTogJ011dGF0aW9uJyxcbiAgICAgIGZpZWxkTmFtZTogJ2dlbmVyYXRlUHJlc2lnbmVkVXJsJyxcbiAgICB9KTtcblxuICAgIGNvbnN0IGtlbmRyYVN5bmNMYW1iZGFEYXRhU291cmNlID0gaW5nZXN0aW9uR3JhcGhxbEFwaS5hZGRMYW1iZGFEYXRhU291cmNlKFxuICAgICAgJ2tlbmRyYVN5bmNMYW1iZGFEYXRhU291cmNlJyxcbiAgICAgIHN0YXJ0S2VuZHJhU3RlcEZuTGFtYmRhLFxuICAgICk7XG4gICAga2VuZHJhU3luY0xhbWJkYURhdGFTb3VyY2UuY3JlYXRlUmVzb2x2ZXIoJ2tlbmRyYVN5bmNMYW1iZGFSZXNvbHZlcicsXG4gICAgICB7XG4gICAgICAgIHR5cGVOYW1lOiAnTXV0YXRpb24nLFxuICAgICAgICBmaWVsZE5hbWU6ICdzdGFydEtlbmRyYVN5bmNKb2InLFxuICAgICAgICByZXF1ZXN0TWFwcGluZ1RlbXBsYXRlOiBhcHBzeW5jLk1hcHBpbmdUZW1wbGF0ZS5mcm9tU3RyaW5nKGBcbiAgICB7XG4gICAgICBcInZlcnNpb25cIjogXCIyMDE3LTAyLTI4XCIsXG4gICAgICBcIm9wZXJhdGlvblwiOiBcIkludm9rZVwiLFxuICAgICAgXCJwYXlsb2FkXCI6IHt9XG4gICAgfVxuICBgKSxcbiAgICAgICAgcmVzcG9uc2VNYXBwaW5nVGVtcGxhdGU6IGFwcHN5bmMuTWFwcGluZ1RlbXBsYXRlLmZyb21TdHJpbmcoYFxuICAgICR1dGlsLnRvSnNvbigkY29udGV4dC5yZXN1bHQpXG4gIGApLFxuICAgICAgfSk7XG5cbiAgfVxufVxuXG5cbiJdfQ==