"use strict";
var _a;
Object.defineProperty(exports, "__esModule", { value: true });
exports.AlarmFactory = exports.CompositeAlarmOperator = void 0;
const JSII_RTTI_SYMBOL_1 = Symbol.for("jsii.rtti");
const aws_cloudwatch_1 = require("aws-cdk-lib/aws-cloudwatch");
const action_1 = require("./action");
const AlarmNamingStrategy_1 = require("./AlarmNamingStrategy");
const IAlarmAnnotationStrategy_1 = require("./IAlarmAnnotationStrategy");
const metric_adjuster_1 = require("./metric-adjuster");
const metric_1 = require("../metric");
const DefaultDatapointsToAlarm = 3;
var CompositeAlarmOperator;
(function (CompositeAlarmOperator) {
    /**
     * trigger only if all the alarms are triggered
     */
    CompositeAlarmOperator[CompositeAlarmOperator["AND"] = 0] = "AND";
    /**
     * trigger if any of the alarms is triggered
     */
    CompositeAlarmOperator[CompositeAlarmOperator["OR"] = 1] = "OR";
})(CompositeAlarmOperator = exports.CompositeAlarmOperator || (exports.CompositeAlarmOperator = {}));
class AlarmFactory {
    constructor(alarmScope, props) {
        this.alarmScope = alarmScope;
        this.globalAlarmDefaults = props.globalAlarmDefaults;
        this.globalMetricDefaults = props.globalMetricDefaults;
        this.alarmNamingStrategy =
            props.globalAlarmDefaults.alarmNamingStrategy ??
                new AlarmNamingStrategy_1.AlarmNamingStrategy(props.globalAlarmDefaults.alarmNamePrefix, props.localAlarmNamePrefix, props.globalAlarmDefaults.dedupeStringProcessor);
    }
    addAlarm(metric, props) {
        // adjust the metric
        const metricAdjuster = props.metricAdjuster
            ? metric_adjuster_1.CompositeMetricAdjuster.of(props.metricAdjuster, metric_adjuster_1.DefaultMetricAdjuster.INSTANCE)
            : metric_adjuster_1.DefaultMetricAdjuster.INSTANCE;
        const adjustedMetric = metricAdjuster.adjustMetric(metric, this.alarmScope, props);
        // metric that will be ultimately used to create the alarm
        let alarmMetric = adjustedMetric;
        // prepare primary alarm properties
        const actionsEnabled = this.determineActionsEnabled(props.actionsEnabled, props.disambiguator);
        const action = this.determineAction(props.disambiguator, props.actionOverride);
        const alarmName = this.alarmNamingStrategy.getName(props);
        const alarmNameSuffix = props.alarmNameSuffix;
        const alarmLabel = this.alarmNamingStrategy.getWidgetLabel(props);
        const alarmDescription = this.generateDescription(props.alarmDescription, props.alarmDescriptionOverride, props.runbookLink, props.documentationLink);
        const dedupeString = this.alarmNamingStrategy.getDedupeString(props);
        const evaluateLowSampleCountPercentile = props.evaluateLowSampleCountPercentile ?? true;
        const datapointsToAlarm = props.datapointsToAlarm ??
            this.globalAlarmDefaults.datapointsToAlarm ??
            DefaultDatapointsToAlarm;
        const evaluationPeriods = props.evaluationPeriods ??
            this.globalAlarmDefaults.evaluationPeriods ??
            datapointsToAlarm;
        if (evaluationPeriods < datapointsToAlarm) {
            throw new Error(`evaluationPeriods must be greater than or equal to datapointsToAlarm for ${alarmName}`);
        }
        // apply metric math for minimum metric samples
        if (props.minSampleCountToEvaluateDatapoint) {
            let label = `${adjustedMetric}`;
            let metricExpression;
            let metricSampleCountId = "sampleCount";
            let usingMetrics;
            if (adjustedMetric instanceof aws_cloudwatch_1.MathExpression) {
                label = adjustedMetric.label ?? label;
                metricExpression = `(${adjustedMetric.expression})`;
                if (Object.keys(adjustedMetric.usingMetrics).length === 1) {
                    const sampleCountMetric = adjustedMetric.usingMetrics[Object.keys(adjustedMetric.usingMetrics)[0]].with({
                        statistic: metric_1.MetricStatistic.N,
                        label: "Sample count",
                    });
                    usingMetrics = {
                        ...adjustedMetric.usingMetrics,
                        [metricSampleCountId]: sampleCountMetric,
                    };
                }
                else if (props.sampleCountMetricId) {
                    usingMetrics = adjustedMetric.usingMetrics;
                    metricSampleCountId = props.sampleCountMetricId;
                }
                else {
                    throw new Error("sampleCountMetricId must be specified when using minSampleCountToEvaluateDatapoint with a multiple-metric MathExpression");
                }
            }
            else {
                const metricId = "metric";
                metricExpression = metricId;
                usingMetrics = {
                    [metricId]: adjustedMetric,
                    [metricSampleCountId]: adjustedMetric.with({
                        statistic: metric_1.MetricStatistic.N,
                        label: "Sample count",
                    }),
                };
            }
            alarmMetric = new aws_cloudwatch_1.MathExpression({
                label,
                expression: `IF(${metricSampleCountId} > ${props.minSampleCountToEvaluateDatapoint}, ${metricExpression})`,
                period: adjustedMetric.period,
                usingMetrics,
            });
        }
        // create primary alarm
        const primaryAlarm = alarmMetric.createAlarm(this.alarmScope, alarmName, {
            alarmName,
            alarmDescription,
            threshold: props.threshold,
            comparisonOperator: props.comparisonOperator,
            treatMissingData: props.treatMissingData,
            // default value (undefined) means "evaluate"
            evaluateLowSampleCountPercentile: evaluateLowSampleCountPercentile
                ? undefined
                : "ignore",
            datapointsToAlarm,
            evaluationPeriods,
            actionsEnabled,
        });
        let alarm = primaryAlarm;
        // create composite alarm for min metric samples (if defined)
        // deprecated in favour of minSampleCountToEvaluateDatapoint
        if (!props.minSampleCountToEvaluateDatapoint &&
            props.minMetricSamplesToAlarm) {
            const metricSampleCount = adjustedMetric.with({
                statistic: metric_1.MetricStatistic.N,
            });
            const noSamplesAlarm = metricSampleCount.createAlarm(this.alarmScope, `${alarmName}-NoSamples`, {
                alarmName: `${alarmName}-NoSamples`,
                alarmDescription: `The metric (${adjustedMetric}) does not have enough samples to alarm. Must have at least ${props.minMetricSamplesToAlarm}.`,
                threshold: props.minMetricSamplesToAlarm,
                comparisonOperator: aws_cloudwatch_1.ComparisonOperator.LESS_THAN_THRESHOLD,
                treatMissingData: aws_cloudwatch_1.TreatMissingData.BREACHING,
                datapointsToAlarm: 1,
                evaluationPeriods: 1,
                actionsEnabled,
            });
            alarm = new aws_cloudwatch_1.CompositeAlarm(this.alarmScope, `${alarmName}-WithSamples`, {
                actionsEnabled,
                compositeAlarmName: `${alarmName}-WithSamples`,
                alarmDescription: this.joinDescriptionParts(alarmDescription, `Min number of samples to alarm: ${props.minMetricSamplesToAlarm}`),
                alarmRule: aws_cloudwatch_1.AlarmRule.allOf(aws_cloudwatch_1.AlarmRule.fromAlarm(primaryAlarm, aws_cloudwatch_1.AlarmState.ALARM), aws_cloudwatch_1.AlarmRule.not(aws_cloudwatch_1.AlarmRule.fromAlarm(noSamplesAlarm, aws_cloudwatch_1.AlarmState.ALARM))),
            });
        }
        // attach alarm actions
        action.addAlarmActions({
            alarm,
            action,
            dedupeString,
            disambiguator: props.disambiguator,
            customTags: props.customTags ?? [],
            customParams: props.customParams ?? {},
        });
        // create annotation for the primary alarm
        const annotation = this.createAnnotation({
            alarm: primaryAlarm,
            action,
            metric: adjustedMetric,
            evaluationPeriods,
            datapointsToAlarm,
            dedupeString,
            minMetricSamplesToAlarm: props.minMetricSamplesToAlarm,
            minSampleCountToEvaluateDatapoint: props.minSampleCountToEvaluateDatapoint,
            fillAlarmRange: props.fillAlarmRange ?? false,
            overrideAnnotationColor: props.overrideAnnotationColor,
            overrideAnnotationLabel: props.overrideAnnotationLabel,
            overrideAnnotationVisibility: props.overrideAnnotationVisibility,
            comparisonOperator: props.comparisonOperator,
            threshold: props.threshold,
            disambiguator: props.disambiguator,
            customTags: props.customTags ?? [],
            customParams: props.customParams ?? {},
        });
        // return the final result
        return {
            alarm,
            action,
            alarmName,
            alarmNameSuffix,
            alarmLabel,
            alarmDescription,
            customTags: props.customTags,
            customParams: props.customParams,
            alarmRuleWhenOk: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.OK),
            alarmRuleWhenAlarming: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.ALARM),
            alarmRuleWhenInsufficientData: aws_cloudwatch_1.AlarmRule.fromAlarm(alarm, aws_cloudwatch_1.AlarmState.INSUFFICIENT_DATA),
            dedupeString,
            annotation,
            disambiguator: props.disambiguator,
        };
    }
    addCompositeAlarm(alarms, props) {
        const actionsEnabled = this.determineActionsEnabled(props?.actionsEnabled, props?.disambiguator);
        const action = props.actionOverride ?? this.globalAlarmDefaults.action ?? action_1.noopAction();
        const namingInput = { alarmNameSuffix: "Composite", ...props };
        const alarmName = this.alarmNamingStrategy.getName(namingInput);
        const alarmDescription = this.generateDescription(props?.alarmDescription ?? "Composite alarm", props?.alarmDescriptionOverride, props?.runbookLink, props?.documentationLink);
        const dedupeString = this.alarmNamingStrategy.getDedupeString(namingInput);
        const alarmRule = this.determineCompositeAlarmRule(alarms, props);
        const alarm = new aws_cloudwatch_1.CompositeAlarm(this.alarmScope, alarmName, {
            compositeAlarmName: alarmName,
            alarmDescription,
            alarmRule,
            actionsEnabled,
            actionsSuppressor: props?.actionsSuppressor,
            actionsSuppressorExtensionPeriod: props?.actionsSuppressorExtensionPeriod,
            actionsSuppressorWaitPeriod: props?.actionsSuppressorWaitPeriod,
        });
        action.addAlarmActions({
            alarm,
            action,
            dedupeString,
            disambiguator: props?.disambiguator,
            customTags: props?.customTags,
            customParams: props?.customParams,
        });
        return alarm;
    }
    determineCompositeAlarmRule(alarms, props) {
        const alarmRules = alarms.map((alarm) => alarm.alarmRuleWhenAlarming);
        const operator = props.compositeOperator ?? CompositeAlarmOperator.OR;
        switch (operator) {
            case CompositeAlarmOperator.AND:
                return aws_cloudwatch_1.AlarmRule.allOf(...alarmRules);
            case CompositeAlarmOperator.OR:
                return aws_cloudwatch_1.AlarmRule.anyOf(...alarmRules);
            default:
                throw new Error(`Unsupported composite alarm operator: ${operator}`);
        }
    }
    determineActionsEnabled(actionsEnabled, disambiguator) {
        if (actionsEnabled !== undefined) {
            // alarm-specific override to true or false
            return actionsEnabled;
        }
        if (typeof this.globalAlarmDefaults.actionsEnabled === "boolean") {
            // global defaults: boolean value
            return this.globalAlarmDefaults.actionsEnabled;
        }
        if (disambiguator) {
            // global defaults: disambiguator based value
            return this.globalAlarmDefaults.actionsEnabled[disambiguator] ?? false;
        }
        return false;
    }
    determineAction(disambiguator, actionOverride) {
        // Explicit override
        if (actionOverride) {
            return actionOverride;
        }
        // Default by disambiugator
        if (disambiguator &&
            this.globalAlarmDefaults.disambiguatorAction?.[disambiguator]) {
            return this.globalAlarmDefaults.disambiguatorAction[disambiguator];
        }
        // Default global action
        return this.globalAlarmDefaults.action ?? action_1.noopAction();
    }
    get shouldUseDefaultDedupeForError() {
        return this.globalAlarmDefaults.useDefaultDedupeForError ?? true;
    }
    get shouldUseDefaultDedupeForLatency() {
        return this.globalAlarmDefaults.useDefaultDedupeForLatency ?? true;
    }
    generateDescription(alarmDescription, alarmDescriptionOverride, runbookLinkOverride, documentationLinkOverride) {
        const parts = [alarmDescriptionOverride ?? alarmDescription];
        const runbookLink = runbookLinkOverride ?? this.globalAlarmDefaults.runbookLink;
        const documentationLink = documentationLinkOverride ?? this.globalAlarmDefaults.documentationLink;
        if (runbookLink) {
            parts.push(`Runbook: ${runbookLink}`);
        }
        if (documentationLink) {
            parts.push(`Documentation: ${documentationLink}`);
        }
        return this.joinDescriptionParts(...parts);
    }
    joinDescriptionParts(...parts) {
        return parts.join(" \r\n");
    }
    createAnnotation(props) {
        const strategy = this.globalAlarmDefaults.annotationStrategy ??
            new IAlarmAnnotationStrategy_1.DefaultAlarmAnnotationStrategy();
        return strategy.createAnnotation(props);
    }
}
exports.AlarmFactory = AlarmFactory;
_a = JSII_RTTI_SYMBOL_1;
AlarmFactory[_a] = { fqn: "cdk-monitoring-constructs.AlarmFactory", version: "8.1.0" };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQWxhcm1GYWN0b3J5LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQWxhcm1GYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQ0EsK0RBYW9DO0FBR3BDLHFDQUE0RDtBQUM1RCwrREFBNEQ7QUFDNUQseUVBSW9DO0FBR3BDLHVEQUkyQjtBQUMzQixzQ0FJbUI7QUFFbkIsTUFBTSx3QkFBd0IsR0FBRyxDQUFDLENBQUM7QUFrWW5DLElBQVksc0JBVVg7QUFWRCxXQUFZLHNCQUFzQjtJQUNoQzs7T0FFRztJQUNILGlFQUFHLENBQUE7SUFFSDs7T0FFRztJQUNILCtEQUFFLENBQUE7QUFDSixDQUFDLEVBVlcsc0JBQXNCLEdBQXRCLDhCQUFzQixLQUF0Qiw4QkFBc0IsUUFVakM7QUFtR0QsTUFBYSxZQUFZO0lBTXZCLFlBQVksVUFBcUIsRUFBRSxLQUF3QjtRQUN6RCxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsS0FBSyxDQUFDLG1CQUFtQixDQUFDO1FBQ3JELElBQUksQ0FBQyxvQkFBb0IsR0FBRyxLQUFLLENBQUMsb0JBQW9CLENBQUM7UUFDdkQsSUFBSSxDQUFDLG1CQUFtQjtZQUN0QixLQUFLLENBQUMsbUJBQW1CLENBQUMsbUJBQW1CO2dCQUM3QyxJQUFJLHlDQUFtQixDQUNyQixLQUFLLENBQUMsbUJBQW1CLENBQUMsZUFBZSxFQUN6QyxLQUFLLENBQUMsb0JBQW9CLEVBQzFCLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxxQkFBcUIsQ0FDaEQsQ0FBQztJQUNOLENBQUM7SUFFRCxRQUFRLENBQ04sTUFBOEIsRUFDOUIsS0FBb0I7UUFFcEIsb0JBQW9CO1FBRXBCLE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxjQUFjO1lBQ3pDLENBQUMsQ0FBQyx5Q0FBdUIsQ0FBQyxFQUFFLENBQ3hCLEtBQUssQ0FBQyxjQUFjLEVBQ3BCLHVDQUFxQixDQUFDLFFBQVEsQ0FDL0I7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Q0FBQztJQUNyRSxDQUFDO0lBRVMsbUJBQW1CLENBQzNCLGdCQUF3QixFQUN4Qix3QkFBaUMsRUFDakMsbUJBQTRCLEVBQzVCLHlCQUFrQztRQUVsQyxNQUFNLEtBQUssR0FBRyxDQUFDLHdCQUF3QixJQUFJLGdCQUFnQixDQUFDLENBQUM7UUFFN0QsTUFBTSxXQUFXLEdBQ2YsbUJBQW1CLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQztRQUM5RCxNQUFNLGlCQUFpQixHQUNyQix5QkFBeUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsaUJBQWlCLENBQUM7UUFFMUUsSUFBSSxXQUFXLEVBQUU7WUFDZixLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksV0FBVyxFQUFFLENBQUMsQ0FBQztTQUN2QztRQUVELElBQUksaUJBQWlCLEVBQUU7WUFDckIsS0FBSyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1NBQ25EO1FBRUQsT0FBTyxJQUFJLENBQUMsb0JBQW9CLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRVMsb0JBQW9CLENBQUMsR0FBRyxLQUFlO1FBQy9DLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM3QixDQUFDO0lBRVMsZ0JBQWdCLENBQUMsS0FBbUM7UUFDNUQsTUFBTSxRQUFRLEdBQ1osSUFBSSxDQUFDLG1CQUFtQixDQUFDLGtCQUFrQjtZQUMzQyxJQUFJLHlEQUE4QixFQUFFLENBQUM7UUFDdkMsT0FBTyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDMUMsQ0FBQzs7QUFuWUgsb0NBb1lDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRHVyYXRpb24gfSBmcm9tIFwiYXdzLWNkay1saWJcIjtcbmltcG9ydCB7XG4gIEFsYXJtQmFzZSxcbiAgQWxhcm1SdWxlLFxuICBBbGFybVN0YXRlLFxuICBDb21wYXJpc29uT3BlcmF0b3IsXG4gIENvbXBvc2l0ZUFsYXJtLFxuICBIb3Jpem9udGFsQW5ub3RhdGlvbixcbiAgSUFsYXJtLFxuICBJQWxhcm1SdWxlLFxuICBJTWV0cmljLFxuICBNYXRoRXhwcmVzc2lvbixcbiAgTWV0cmljLFxuICBUcmVhdE1pc3NpbmdEYXRhLFxufSBmcm9tIFwiYXdzLWNkay1saWIvYXdzLWNsb3Vkd2F0Y2hcIjtcbmltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gXCJjb25zdHJ1Y3RzXCI7XG5cbmltcG9ydCB7IElBbGFybUFjdGlvblN0cmF0ZWd5LCBub29wQWN0aW9uIH0gZnJvbSBcIi4vYWN0aW9uXCI7XG5pbXBvcnQgeyBBbGFybU5hbWluZ1N0cmF0ZWd5IH0gZnJvbSBcIi4vQWxhcm1OYW1pbmdTdHJhdGVneVwiO1xuaW1wb3J0IHtcbiAgQWxhcm1Bbm5vdGF0aW9uU3RyYXRlZ3lQcm9wcyxcbiAgRGVmYXVsdEFsYXJtQW5ub3RhdGlvblN0cmF0ZWd5LFxuICBJQWxhcm1Bbm5vdGF0aW9uU3RyYXRlZ3ksXG59IGZyb20gXCIuL0lBbGFybUFubm90YXRpb25TdHJhdGVneVwiO1xuaW1wb3J0IHsgSUFsYXJtRGVkdXBlU3RyaW5nUHJvY2Vzc29yIH0gZnJvbSBcIi4vSUFsYXJtRGVkdXBlU3RyaW5nUHJvY2Vzc29yXCI7XG5pbXBvcnQgeyBJQWxhcm1OYW1pbmdTdHJhdGVneSB9IGZyb20gXCIuL0lBbGFybU5hbWluZ1N0cmF0ZWd5XCI7XG5pbXBvcnQge1xuICBDb21wb3NpdGVNZXRyaWNBZGp1c3RlcixcbiAgRGVmYXVsdE1ldHJpY0FkanVzdGVyLFxuICBJTWV0cmljQWRqdXN0ZXIsXG59IGZyb20gXCIuL21ldHJpYy1hZGp1c3RlclwiO1xuaW1wb3J0IHtcbiAgTWV0cmljRmFjdG9yeURlZmF1bHRzLFxuICBNZXRyaWNTdGF0aXN0aWMsXG4gIE1ldHJpY1dpdGhBbGFybVN1cHBvcnQsXG59IGZyb20gXCIuLi9tZXRyaWNcIjtcblxuY29uc3QgRGVmYXVsdERhdGFwb2ludHNUb0FsYXJtID0gMztcblxuLyoqXG4gKiBDb21tb25seSB1c2VkIGRpc2FtYmlndWF0b3JzLlxuICovXG5leHBvcnQgdHlwZSBQcmVkZWZpbmVkQWxhcm1EaXNhbWJpZ3VhdG9ycyA9IFwiV2FybmluZ1wiIHwgXCJDcml0aWNhbFwiO1xuXG4vKipcbiAqIE1ldGFkYXRhIG9mIGFuIGFsYXJtLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFsYXJtTWV0YWRhdGEge1xuICByZWFkb25seSBhY3Rpb246IElBbGFybUFjdGlvblN0cmF0ZWd5O1xuICByZWFkb25seSBkZWR1cGVTdHJpbmc/OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGRpc2FtYmlndWF0b3I/OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGN1c3RvbVRhZ3M/OiBzdHJpbmdbXTtcbiAgcmVhZG9ubHkgY3VzdG9tUGFyYW1zPzogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhbiBhbGFybSB3aXRoIGFkZGl0aW9uYWwgaW5mb3JtYXRpb24uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQWxhcm1XaXRoQW5ub3RhdGlvbiBleHRlbmRzIEFsYXJtTWV0YWRhdGEge1xuICByZWFkb25seSBhbGFybTogQWxhcm1CYXNlO1xuICByZWFkb25seSBhbGFybU5hbWU6IHN0cmluZztcbiAgcmVhZG9ubHkgYWxhcm1OYW1lU3VmZml4OiBzdHJpbmc7XG4gIHJlYWRvbmx5IGFsYXJtTGFiZWw6IHN0cmluZztcbiAgcmVhZG9ubHkgYWxhcm1EZXNjcmlwdGlvbjogc3RyaW5nO1xuICByZWFkb25seSBhbGFybVJ1bGVXaGVuT2s6IElBbGFybVJ1bGU7XG4gIHJlYWRvbmx5IGFsYXJtUnVsZVdoZW5BbGFybWluZzogSUFsYXJtUnVsZTtcbiAgcmVhZG9ubHkgYWxhcm1SdWxlV2hlbkluc3VmZmljaWVudERhdGE6IElBbGFybVJ1bGU7XG4gIHJlYWRvbmx5IGFubm90YXRpb246IEhvcml6b250YWxBbm5vdGF0aW9uO1xufVxuXG4vKipcbiAqIFByb3BlcnRpZXMgbmVjZXNzYXJ5IHRvIGNyZWF0ZSBhIHNpbmdsZSBhbGFybSBhbmQgY29uZmlndXJlIGl0LlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFkZEFsYXJtUHJvcHMge1xuICAvKipcbiAgICogQWxsb3dzIHRvIG92ZXJyaWRlIHRoZSBkZWZhdWx0IGFjdGlvbiBzdHJhdGVneS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBkZWZhdWx0IGFjdGlvbiB3aWxsIGJlIHVzZWRcbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbk92ZXJyaWRlPzogSUFsYXJtQWN0aW9uU3RyYXRlZ3k7XG5cbiAgLyoqXG4gICAqIElmIHRoaXMgaXMgZGVmaW5lZCwgdGhlIGFsYXJtIGRlZHVwZSBzdHJpbmcgaXMgc2V0IHRvIHRoaXMgZXhhY3QgdmFsdWUuXG4gICAqIFBsZWFzZSBiZSBhd2FyZSB0aGF0IHlvdSBuZWVkIHRvIGhhbmRsZSBkZWR1cGluZyBmb3IgZGlmZmVyZW50IHN0YWdlcyAoQmV0YSwgUHJvZC4uLikgYW5kIHJlZ2lvbnMgKEVVLCBOQS4uLikgbWFudWFsbHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkIChubyBvdmVycmlkZSlcbiAgICovXG4gIHJlYWRvbmx5IGRlZHVwZVN0cmluZ092ZXJyaWRlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIGRlZmluZWQsIHRoZSBhbGFybSBuYW1lIGlzIHNldCB0byB0aGlzIGV4YWN0IHZhbHVlLlxuICAgKiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB5b3UgbmVlZCB0byBzcGVjaWZ5IHByZWZpeCBmb3IgZGlmZmVyZW50IHN0YWdlcyAoQmV0YSwgUHJvZC4uLikgYW5kIHJlZ2lvbnMgKEVVLCBOQS4uLikgbWFudWFsbHkuXG4gICAqL1xuICByZWFkb25seSBhbGFybU5hbWVPdmVycmlkZT86IHN0cmluZztcblxuICAvKipcbiAgICogQSB0ZXh0IGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHksIHdoaWNoIGZ1bGx5IHJlcGxhY2VzIHRoZSBnZW5lcmF0ZWQgdGV4dC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBkZWZhdWx0IGF1dG8tZ2VuZXJhdGVkIGNvbnRlbnQgb25seVxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZXNjcmlwdGlvbk92ZXJyaWRlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBEaXNhbWJpZ3VhdG9yIGlzIGEgc3RyaW5nIHRoYXQgZGlmZmVyZW50aWF0ZXMgdGhpcyBhbGFybSBmcm9tIG90aGVyIHNpbWlsYXIgb25lcy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB1bmRlZmluZWQgKG5vIGRpc2FtYmlndWF0b3IpXG4gICAqL1xuICByZWFkb25seSBkaXNhbWJpZ3VhdG9yPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbGFybSBkZXNjcmlwdGlvbiBpcyBpbmNsdWRlZCBpbiB0aGUgdGlja2V0IGFuZCB0aGVyZWZvcmUgc2hvdWxkIGRlc2NyaWJlIHdoYXQgaGFwcGVuZWQsIHdpdGggYXMgbXVjaCBjb250ZXh0IGFzIHBvc3NpYmxlLlxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBsaW5rIHdpbGwgYmUgYWRkZWRcbiAgICovXG4gIHJlYWRvbmx5IGRvY3VtZW50YXRpb25MaW5rPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBsaW5rIHdpbGwgYmUgYWRkZWRcbiAgICovXG4gIHJlYWRvbmx5IHJ1bmJvb2tMaW5rPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTdWZmaXggYWRkZWQgdG8gYmFzZSBhbGFybSBuYW1lLiBBbGFybSBuYW1lcyBuZWVkIHRvIGJlIHVuaXF1ZS5cbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtZVN1ZmZpeDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIGRlZmluZWQsIHRoZSBkZWZhdWx0IHJlc291cmNlLXNwZWNpZmljIGFsYXJtIGRlZHVwZSBzdHJpbmcgd2lsbCBiZSBzZXQgYW5kIHRoaXMgd2lsbCBiZSBhZGRlZCBhcyBhIHN1ZmZpeC5cbiAgICogVGhpcyBhbGxvd3MgeW91IHRvIHNwZWNpZnkgdGhlIHNhbWUgZGVkdXBlIHN0cmluZyBmb3IgYSBmYW1pbHkgb2YgYWxhcm1zLlxuICAgKiBDYW5ub3QgYmUgZGVmaW5lZCBhdCB0aGUgc2FtZSB0aW1lIGFzIGFsYXJtRGVkdXBlU3RyaW5nT3ZlcnJpZGUuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkIChubyBzdWZmaXgpXG4gICAqL1xuICByZWFkb25seSBhbGFybURlZHVwZVN0cmluZ1N1ZmZpeD86IHN0cmluZztcblxuICAvKipcbiAgICogRW5hYmxlcyB0aGUgY29uZmlndXJlZCBDbG91ZFdhdGNoIGFsYXJtIHRpY2tldGluZyBhY3Rpb25zLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHRoZSBzYW1lIGFzIG1vbml0b3JpbmcgZmFjYWRlIGRlZmF1bHRcbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbnNFbmFibGVkPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogVGhyZXNob2xkIHRvIGFsYXJtIG9uLlxuICAgKi9cbiAgcmVhZG9ubHkgdGhyZXNob2xkOiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIENvbXBhcmlzb24gb3BlcmF0b3IgdXNlZCB0byBjb21wYXJlIGFjdHVhbCB2YWx1ZSBhZ2FpbnN0IHRoZSB0aHJlc2hvbGQuXG4gICAqL1xuICByZWFkb25seSBjb21wYXJpc29uT3BlcmF0b3I6IENvbXBhcmlzb25PcGVyYXRvcjtcblxuICAvKipcbiAgICogQmVoYXZpb3VyIGluIGNhc2UgdGhlIG1ldHJpYyBkYXRhIGlzIG1pc3NpbmcuXG4gICAqL1xuICByZWFkb25seSB0cmVhdE1pc3NpbmdEYXRhOiBUcmVhdE1pc3NpbmdEYXRhO1xuXG4gIC8qKlxuICAgKiBOdW1iZXIgb2YgYnJlYWNoZXMgcmVxdWlyZWQgdG8gdHJhbnNpdGlvbiBpbnRvIGFuIEFMQVJNIHN0YXRlLlxuICAgKi9cbiAgcmVhZG9ubHkgZGF0YXBvaW50c1RvQWxhcm0/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIE51bWJlciBvZiBwZXJpb2RzIHRvIGNvbnNpZGVyIHdoZW4gY2hlY2tpbmcgdGhlIG51bWJlciBvZiBicmVhY2hpbmcgZGF0YXBvaW50cy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBTYW1lIGFzIGRhdGFwb2ludHNUb0FsYXJtLlxuICAgKi9cbiAgcmVhZG9ubHkgZXZhbHVhdGlvblBlcmlvZHM/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIFBlcmlvZCBvdmVycmlkZSBmb3IgdGhlIG1ldHJpYyB0byBhbGFybSBvbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0aGUgZGVmYXVsdCBzcGVjaWZpZWQgaW4gTWV0cmljRmFjdG9yeVxuICAgKi9cbiAgcmVhZG9ubHkgcGVyaW9kPzogRHVyYXRpb247XG5cbiAgLyoqXG4gICAqIFVzZWQgb25seSBmb3IgYWxhcm1zIGJhc2VkIG9uIHBlcmNlbnRpbGVzLlxuICAgKiBJZiB5b3Ugc3BlY2lmeSA8Y29kZT5mYWxzZTwvY29kZT4sIHRoZSBhbGFybSBzdGF0ZSBkb2VzIG5vdCBjaGFuZ2UgZHVyaW5nIHBlcmlvZHMgd2l0aCB0b28gZmV3IGRhdGEgcG9pbnRzIHRvIGJlIHN0YXRpc3RpY2FsbHkgc2lnbmlmaWNhbnQuXG4gICAqIElmIHlvdSBzcGVjaWZ5IDxjb2RlPnRydWU8L2NvZGU+LCB0aGUgYWxhcm0gaXMgYWx3YXlzIGV2YWx1YXRlZCBhbmQgcG9zc2libHkgY2hhbmdlcyBzdGF0ZSBubyBtYXR0ZXIgaG93IG1hbnkgZGF0YSBwb2ludHMgYXJlIGF2YWlsYWJsZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0cnVlXG4gICAqL1xuICByZWFkb25seSBldmFsdWF0ZUxvd1NhbXBsZUNvdW50UGVyY2VudGlsZT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFNwZWNpZmllcyBob3cgbWFueSBzYW1wbGVzIChOKSBvZiB0aGUgbWV0cmljIGlzIG5lZWRlZCBpbiBhIGRhdGFwb2ludCB0byBiZSBldmFsdWF0ZWQgZm9yIGFsYXJtaW5nLlxuICAgKiBJZiB0aGlzIHByb3BlcnR5IGlzIHNwZWNpZmllZCwgeW91ciBtZXRyaWMgd2lsbCBiZSBzdWJqZWN0IHRvIE1hdGhFeHByZXNzaW9uIHRoYXQgd2lsbCBhZGQgYW4gSUYgY29uZGl0aW9uXG4gICAqIHRvIHlvdXIgbWV0cmljIHRvIG1ha2Ugc3VyZSB0aGF0IGVhY2ggZGF0YXBvaW50IGlzIGV2YWx1YXRlZCBvbmx5IGlmIGl0IGhhcyBzdWZmaWNpZW50IG51bWJlciBvZiBzYW1wbGVzLlxuICAgKiBJZiB0aGUgbnVtYmVyIG9mIHNhbXBsZXMgaXMgbm90IHN1ZmZpY2llbnQsIHRoZSBkYXRhcG9pbnQgd2lsbCBiZSB0cmVhdGVkIGFzIG1pc3NpbmcgZGF0YSBhbmQgd2lsbCBiZSBldmFsdWF0ZWRcbiAgICogYWNjb3JkaW5nIHRvIHRoZSB0cmVhdE1pc3NpbmdEYXRhIHBhcmFtZXRlci5cbiAgICogSWYgc3BlY2lmaWVkLCBkZXByZWNhdGVkIG1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtIGhhcyBubyBlZmZlY3QuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgLSBubyBjb25kaXRpb24gb24gc2FtcGxlIGNvdW50IHdpbGwgYmUgdXNlZFxuICAgKi9cbiAgcmVhZG9ubHkgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50PzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGlzIHByb3BlcnR5IGlzIHJlcXVpcmVkIGluIHRoZSBmb2xsb3dpbmcgc2l0dWF0aW9uOlxuICAgKiA8b2w+XG4gICAqICAgICA8bGk+PGNvZGU+bWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50PC9jb2RlPiBpcyBzcGVjaWZpZWQ8L2xpPlxuICAgKiAgICAgPGxpPnRoZSBtZXRyaWMgdXNlZCBmb3IgdGhlIGFsYXJtIGlzIGEgPGNvZGU+TWF0aEV4cHJlc3Npb248L2NvZGU+PC9saT5cbiAgICogICAgIDxsaT50aGUgPGNvZGU+TWF0aEV4cHJlc3Npb248L2NvZGU+IGlzIGNvbXBvc2VkIG9mIG1vcmUgdGhhbiBvbmUgbWV0cmljPC9saT5cbiAgICogPC9vbD5cbiAgICpcbiAgICogSW4gdGhpcyBzaXR1YXRpb24sIHRoaXMgcHJvcGVydHkgaW5kaWNhdGVzIHRoZSBtZXRyaWMgSWQgaW4gdGhlIE1hdGhFeHByZXNzaW9u4oCZcyA8Y29kZT51c2luZ01ldHJpY3M8L2NvZGU+XG4gICAqIHByb3BlcnR5IHRoYXQgc2hvdWxkIGJlIHVzZWQgYXMgdGhlIHNhbXBsZUNvdW50IG1ldHJpYyBmb3IgdGhlIG5ldyBNYXRoRXhwcmVzc2lvbiBhcyBkZXNjcmliZWQgaW4gdGhlIGRvY3VtZW50YXRpb25cbiAgICogZm9yIDxjb2RlPm1pblNhbXBsZUNvdW50VG9FdmFsdWF0ZURhdGFwb2ludDwvY29kZT4uXG4gICAqL1xuICByZWFkb25seSBzYW1wbGVDb3VudE1ldHJpY0lkPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTcGVjaWZpZXMgaG93IG1hbnkgc2FtcGxlcyAoTikgb2YgdGhlIG1ldHJpYyBpcyBuZWVkZWQgdG8gdHJpZ2dlciB0aGUgYWxhcm0uXG4gICAqIElmIHRoaXMgcHJvcGVydHkgaXMgc3BlY2lmaWVkLCBhbiBhcnRpZmljaWFsIGNvbXBvc2l0ZSBhbGFybSBpcyBjcmVhdGVkIG9mIHRoZSBmb2xsb3dpbmc6XG4gICAqIDx1bD5cbiAgICogPGxpPlRoZSBvcmlnaW5hbCBhbGFybSwgY3JlYXRlZCB3aXRob3V0IHRoaXMgcHJvcGVydHkgYmVpbmcgdXNlZDsgdGhpcyBhbGFybSB3aWxsIGhhdmUgbm8gYWN0aW9ucyBzZXQuPC9saT5cbiAgICogPGxpPkEgc2Vjb25kYXJ5IGFsYXJtLCB3aGljaCB3aWxsIG1vbml0b3IgdGhlIHNhbWUgbWV0cmljIHdpdGggdGhlIE4gKFNhbXBsZUNvdW50KSBzdGF0aXN0aWMsIGNoZWNraW5nIHRoZSBzYW1wbGUgY291bnQuPC9saT5cbiAgICogPC91bD5cbiAgICogVGhlIG5ld2x5IGNyZWF0ZWQgY29tcG9zaXRlIGFsYXJtIHdpbGwgYmUgcmV0dXJuZWQgYXMgYSByZXN1bHQsIGFuZCBpdCB3aWxsIHRha2UgdGhlIG9yaWdpbmFsIGFsYXJtIGFjdGlvbnMuXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgLSBubyBjb25kaXRpb24gb24gc2FtcGxlIGNvdW50IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGFsYXJtXG4gICAqIEBkZXByZWNhdGVkIFVzZSBtaW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQgaW5zdGVhZC4gbWluTWV0cmljU2FtcGxlc0FsYXJtIHVzZXMgZGlmZmVyZW50IGV2YWx1YXRpb25cbiAgICogICBwZXJpb2QgZm9yIGl0cyBjaGlsZCBhbGFybXMsIHNvIGl0IGRvZXNuJ3QgZ3VhcmFudGVlIHRoYXQgZWFjaCBkYXRhcG9pbnQgaW4gdGhlIGV2YWx1YXRpb24gcGVyaW9kIGhhc1xuICAgKiAgIHN1ZmZpY2llbnQgbnVtYmVyIG9mIHNhbXBsZXNcbiAgICovXG4gIHJlYWRvbmx5IG1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGlzIGFsbG93cyB1c2VyIHRvIGF0dGFjaCBjdXN0b20gdmFsdWVzIHRvIHRoaXMgYWxhcm0sIHdoaWNoIGNhbiBsYXRlciBiZSBhY2Nlc3NlZCBmcm9tIHRoZSBcInVzZUNyZWF0ZWRBbGFybXNcIiBtZXRob2QuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gdGFnc1xuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tVGFncz86IHN0cmluZ1tdO1xuXG4gIC8qKlxuICAgKiBUaGlzIGFsbG93cyB1c2VyIHRvIGF0dGFjaCBjdXN0b20gcGFyYW1ldGVycyB0byB0aGlzIGFsYXJtLCB3aGljaCBjYW4gbGF0ZXIgYmUgYWNjZXNzZWQgZnJvbSB0aGUgXCJ1c2VDcmVhdGVkQWxhcm1zXCIgbWV0aG9kLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHBhcmFtZXRlcnNcbiAgICovXG4gIHJlYWRvbmx5IGN1c3RvbVBhcmFtcz86IFJlY29yZDxzdHJpbmcsIGFueT47XG5cbiAgLyoqXG4gICAqIEluZGljYXRlcyB3aGV0aGVyIHRoZSBhbGFybWluZyByYW5nZSBvZiB2YWx1ZXMgc2hvdWxkIGJlIGhpZ2hsaWdodGVkIGluIHRoZSB3aWRnZXQuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZmFsc2VcbiAgICovXG4gIHJlYWRvbmx5IGZpbGxBbGFybVJhbmdlPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogSWYgc3BlY2lmaWVkLCBpdCBtb2RpZmllcyB0aGUgZmluYWwgYWxhcm0gYW5ub3RhdGlvbiBjb2xvci5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBvdmVycmlkZSAoZGVmYXVsdCBjb2xvcilcbiAgICovXG4gIHJlYWRvbmx5IG92ZXJyaWRlQW5ub3RhdGlvbkNvbG9yPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJZiBzcGVjaWZpZWQsIGl0IG1vZGlmaWVzIHRoZSBmaW5hbCBhbGFybSBhbm5vdGF0aW9uIGxhYmVsLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIG92ZXJyaWRlIChkZWZhdWx0IGxhYmVsKVxuICAgKi9cbiAgcmVhZG9ubHkgb3ZlcnJpZGVBbm5vdGF0aW9uTGFiZWw/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIElmIHNwZWNpZmllZCwgaXQgbW9kaWZpZXMgdGhlIGZpbmFsIGFsYXJtIGFubm90YXRpb24gdmlzaWJpbGl0eS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBvdmVycmlkZSAoZGVmYXVsdCB2aXNpYmlsaXR5KVxuICAgKi9cbiAgcmVhZG9ubHkgb3ZlcnJpZGVBbm5vdGF0aW9uVmlzaWJpbGl0eT86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIElmIHNwZWNpZmllZCwgYWRqdXN0cyB0aGUgbWV0cmljIGJlZm9yZSBjcmVhdGluZyBhbiBhbGFybSBmcm9tIGl0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGFkanVzdGVyXG4gICAqL1xuICByZWFkb25seSBtZXRyaWNBZGp1c3Rlcj86IElNZXRyaWNBZGp1c3Rlcjtcbn1cblxuLyoqXG4gKiBQcm9wZXJ0aWVzIG5lY2Vzc2FyeSB0byBjcmVhdGUgYSBjb21wb3NpdGUgYWxhcm0gYW5kIGNvbmZpZ3VyZSBpdC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBZGRDb21wb3NpdGVBbGFybVByb3BzIHtcbiAgLyoqXG4gICAqIEFsbG93cyB0byBvdmVycmlkZSB0aGUgZGVmYXVsdCBhY3Rpb24gc3RyYXRlZ3kuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBhY3Rpb24gd2lsbCBiZSB1c2VkXG4gICAqL1xuICByZWFkb25seSBhY3Rpb25PdmVycmlkZT86IElBbGFybUFjdGlvblN0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIGRlZmluZWQsIHRoZSBhbGFybSBkZWR1cGUgc3RyaW5nIGlzIHNldCB0byB0aGlzIGV4YWN0IHZhbHVlLlxuICAgKiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB5b3UgbmVlZCB0byBoYW5kbGUgZGVkdXBpbmcgZm9yIGRpZmZlcmVudCBzdGFnZXMgKEJldGEsIFByb2QuLi4pIGFuZCByZWFsbXMgKEVVLCBOQS4uLikgbWFudWFsbHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkIChubyBvdmVycmlkZSlcbiAgICovXG4gIHJlYWRvbmx5IGRlZHVwZVN0cmluZ092ZXJyaWRlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJZiB0aGlzIGlzIGRlZmluZWQsIHRoZSBhbGFybSBuYW1lIGlzIHNldCB0byB0aGlzIGV4YWN0IHZhbHVlLlxuICAgKiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB5b3UgbmVlZCB0byBzcGVjaWZ5IHByZWZpeCBmb3IgZGlmZmVyZW50IHN0YWdlcyAoQmV0YSwgUHJvZC4uLikgYW5kIHJlYWxtcyAoRVUsIE5BLi4uKSBtYW51YWxseS5cbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtZU92ZXJyaWRlPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBIHRleHQgaW5jbHVkZWQgaW4gdGhlIGdlbmVyYXRlZCB0aWNrZXQgZGVzY3JpcHRpb24gYm9keSwgd2hpY2ggZnVsbHkgcmVwbGFjZXMgdGhlIGdlbmVyYXRlZCB0ZXh0LlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIGRlZmF1bHQgYXV0by1nZW5lcmF0ZWQgY29udGVudCBvbmx5XG4gICAqL1xuICByZWFkb25seSBhbGFybURlc2NyaXB0aW9uT3ZlcnJpZGU/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIERpc2FtYmlndWF0b3IgaXMgYSBzdHJpbmcgdGhhdCBkaWZmZXJlbnRpYXRlcyB0aGlzIGFsYXJtIGZyb20gb3RoZXIgc2ltaWxhciBvbmVzLlxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYW1iaWd1YXRvcjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbGFybSBkZXNjcmlwdGlvbiBpcyBpbmNsdWRlZCBpbiB0aGUgdGlja2V0IGFuZCB0aGVyZWZvcmUgc2hvdWxkIGRlc2NyaWJlIHdoYXQgaGFwcGVuZWQsIHdpdGggYXMgbXVjaCBjb250ZXh0IGFzIHBvc3NpYmxlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIGRlc2NyaXB0aW9uXG4gICAqL1xuICByZWFkb25seSBhbGFybURlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBsaW5rIHdpbGwgYmUgYWRkZWRcbiAgICovXG4gIHJlYWRvbmx5IGRvY3VtZW50YXRpb25MaW5rPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gYWRkaXRpb25hbCBsaW5rIHdpbGwgYmUgYWRkZWRcbiAgICovXG4gIHJlYWRvbmx5IHJ1bmJvb2tMaW5rPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBTdWZmaXggYWRkZWQgdG8gYmFzZSBhbGFybSBuYW1lLiBBbGFybSBuYW1lcyBuZWVkIHRvIGJlIHVuaXF1ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBzdWZmaXhcbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtZVN1ZmZpeD86IHN0cmluZztcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkLCB0aGUgZGVmYXVsdCByZXNvdXJjZS1zcGVjaWZpYyBhbGFybSBkZWR1cGUgc3RyaW5nIHdpbGwgYmUgc2V0IGFuZCB0aGlzIHdpbGwgYmUgYWRkZWQgYXMgYSBzdWZmaXguXG4gICAqIFRoaXMgYWxsb3dzIHlvdSB0byBzcGVjaWZ5IHRoZSBzYW1lIGRlZHVwZSBzdHJpbmcgZm9yIGEgZmFtaWx5IG9mIGFsYXJtcy5cbiAgICogQ2Fubm90IGJlIGRlZmluZWQgYXQgdGhlIHNhbWUgdGltZSBhcyBhbGFybURlZHVwZVN0cmluZ092ZXJyaWRlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAobm8gc3VmZml4KVxuICAgKi9cbiAgcmVhZG9ubHkgYWxhcm1EZWR1cGVTdHJpbmdTdWZmaXg/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEVuYWJsZXMgdGhlIGNvbmZpZ3VyZWQgQ2xvdWRXYXRjaCBhbGFybSB0aWNrZXRpbmcgYWN0aW9ucy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSB0aGUgc2FtZSBhcyBtb25pdG9yaW5nIGZhY2FkZSBkZWZhdWx0XG4gICAqL1xuICByZWFkb25seSBhY3Rpb25zRW5hYmxlZD86IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIFRoaXMgYWxsb3dzIHVzZXIgdG8gYXR0YWNoIGN1c3RvbSB2YWx1ZXMgdG8gdGhpcyBhbGFybSwgd2hpY2ggY2FuIGxhdGVyIGJlIGFjY2Vzc2VkIGZyb20gdGhlIFwidXNlQ3JlYXRlZEFsYXJtc1wiIG1ldGhvZC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyB0YWdzXG4gICAqL1xuICByZWFkb25seSBjdXN0b21UYWdzPzogc3RyaW5nW107XG5cbiAgLyoqXG4gICAqIFRoaXMgYWxsb3dzIHVzZXIgdG8gYXR0YWNoIGN1c3RvbSBwYXJhbWV0ZXJzIHRvIHRoaXMgYWxhcm0sIHdoaWNoIGNhbiBsYXRlciBiZSBhY2Nlc3NlZCBmcm9tIHRoZSBcInVzZUNyZWF0ZWRBbGFybXNcIiBtZXRob2QuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gbm8gcGFyYW1ldGVyc1xuICAgKi9cbiAgcmVhZG9ubHkgY3VzdG9tUGFyYW1zPzogUmVjb3JkPHN0cmluZywgYW55PjtcblxuICAvKipcbiAgICogSW5kaWNhdGVzIHdoZXRoZXIgdGhlIGFsYXJtaW5nIHJhbmdlIG9mIHZhbHVlcyBzaG91bGQgYmUgaGlnaGxpZ2h0ZWQgaW4gdGhlIHdpZGdldC5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBmYWxzZVxuICAgKi9cbiAgcmVhZG9ubHkgZmlsbEFsYXJtUmFuZ2U/OiBib29sZWFuO1xuXG4gIC8qKlxuICAgKiBMb2dpY2FsIG9wZXJhdG9yIHVzZWQgdG8gYWdncmVnYXRlIHRoZSBzdGF0dXMgaW5kaXZpZHVhbCBhbGFybXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gT1JcbiAgICovXG4gIHJlYWRvbmx5IGNvbXBvc2l0ZU9wZXJhdG9yPzogQ29tcG9zaXRlQWxhcm1PcGVyYXRvcjtcblxuICAvKipcbiAgICogQWN0aW9ucyB3aWxsIGJlIHN1cHByZXNzZWQgaWYgdGhlIHN1cHByZXNzb3IgYWxhcm0gaXMgaW4gdGhlIEFMQVJNIHN0YXRlLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIG5vIHN1cHByZXNzb3IgYWxhcm1cbiAgICovXG4gIHJlYWRvbmx5IGFjdGlvbnNTdXBwcmVzc29yPzogSUFsYXJtO1xuXG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBkdXJhdGlvbiB0aGF0IHRoZSBjb21wb3NpdGUgYWxhcm0gd2FpdHMgYWZ0ZXIgc3VwcHJlc3NvciBhbGFybSBnb2VzIG91dCBvZiB0aGUgQUxBUk0gc3RhdGUuXG4gICAqIEFmdGVyIHRoaXMgdGltZSwgdGhlIGNvbXBvc2l0ZSBhbGFybSBwZXJmb3JtcyBpdHMgYWN0aW9ucy5cbiAgICpcbiAgICogQGRlZmF1bHQgLSA2MCBzZWNvbmRzXG4gICAqL1xuICByZWFkb25seSBhY3Rpb25zU3VwcHJlc3NvckV4dGVuc2lvblBlcmlvZD86IER1cmF0aW9uO1xuXG4gIC8qKlxuICAgKiBUaGUgbWF4aW11bSBkdXJhdGlvbiB0aGF0IHRoZSBjb21wb3NpdGUgYWxhcm0gd2FpdHMgZm9yIHRoZSBzdXBwcmVzc29yIGFsYXJtIHRvIGdvIGludG8gdGhlIEFMQVJNIHN0YXRlLlxuICAgKiBBZnRlciB0aGlzIHRpbWUsIHRoZSBjb21wb3NpdGUgYWxhcm0gcGVyZm9ybXMgaXRzIGFjdGlvbnMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gNjAgc2Vjb25kc1xuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uc1N1cHByZXNzb3JXYWl0UGVyaW9kPzogRHVyYXRpb247XG59XG5cbi8qKlxuICogRW5hYmxlIGFsYXJtIGFjdGlvbnMgZm9yIGFsbCBzZXZlcml0aWVzIChib29sZWFuKSBvciBwcm92aWRlIGEgbWFwcGluZyBvZiB0aGUgZGlzYW1iaWd1YXRvcnMgdG8gYm9vbGVhbnNcbiAqL1xuZXhwb3J0IHR5cGUgQWN0aW9uc0VuYWJsZWQgPVxuICB8IGJvb2xlYW5cbiAgfCBSZWNvcmQ8UHJlZGVmaW5lZEFsYXJtRGlzYW1iaWd1YXRvcnMgfCBzdHJpbmcsIGJvb2xlYW4+O1xuXG5leHBvcnQgZW51bSBDb21wb3NpdGVBbGFybU9wZXJhdG9yIHtcbiAgLyoqXG4gICAqIHRyaWdnZXIgb25seSBpZiBhbGwgdGhlIGFsYXJtcyBhcmUgdHJpZ2dlcmVkXG4gICAqL1xuICBBTkQsXG5cbiAgLyoqXG4gICAqIHRyaWdnZXIgaWYgYW55IG9mIHRoZSBhbGFybXMgaXMgdHJpZ2dlcmVkXG4gICAqL1xuICBPUixcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGFybUZhY3RvcnlEZWZhdWx0cyB7XG4gIC8qKlxuICAgKiBFbmFibGVzIHRoZSBjb25maWd1cmVkIENsb3VkV2F0Y2ggYWxhcm0gdGlja2V0aW5nIGFjdGlvbnMgZm9yIGVpdGhlciBhbGwgc2V2ZXJpdGllcywgb3IgcGVyIHNldmVyaXR5LlxuICAgKi9cbiAgcmVhZG9ubHkgYWN0aW9uc0VuYWJsZWQ6IEFjdGlvbnNFbmFibGVkO1xuXG4gIC8qKlxuICAgKiBEZWZhdWx0IGFsYXJtIGFjdGlvbiB1c2VkIGZvciBlYWNoIGFsYXJtLCB1bmxlc3MgaXQgaXMgb3ZlcnJpZGRlbi5cbiAgICpcbiAgICogQGRlZmF1bHQgLSBubyBhY3Rpb24uXG4gICAqL1xuICByZWFkb25seSBhY3Rpb24/OiBJQWxhcm1BY3Rpb25TdHJhdGVneTtcblxuICAvKipcbiAgICogT3B0aW9uYWwgYWxhcm0gYWN0aW9uIGZvciBlYWNoIGRpc2FtYmlndWF0b3IuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gR2xvYmFsIGFsYXJtIGFjdGlvbiBpZiBkZWZpbmVkLlxuICAgKi9cbiAgcmVhZG9ubHkgZGlzYW1iaWd1YXRvckFjdGlvbj86IFJlY29yZDxcbiAgICBQcmVkZWZpbmVkQWxhcm1EaXNhbWJpZ3VhdG9ycyB8IHN0cmluZyxcbiAgICBJQWxhcm1BY3Rpb25TdHJhdGVneVxuICA+O1xuXG4gIC8qKlxuICAgKiBDdXN0b20gc3RyYXRlZ3kgdG8gY3JlYXRlIGFubm90YXRpb25zIGZvciBhbGFybXMuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBhbm5vdGF0aW9uc1xuICAgKi9cbiAgcmVhZG9ubHkgYW5ub3RhdGlvblN0cmF0ZWd5PzogSUFsYXJtQW5ub3RhdGlvblN0cmF0ZWd5O1xuXG4gIC8qKlxuICAgKiBDdXN0b20gc3RyYXRlZ3kgdG8gcHJvY2VzcyBkZWR1cGUgc3RyaW5ncyBvZiB0aGUgYWxhcm1zXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgKG5vIGNoYW5nZSlcbiAgICovXG4gIHJlYWRvbmx5IGRlZHVwZVN0cmluZ1Byb2Nlc3Nvcj86IElBbGFybURlZHVwZVN0cmluZ1Byb2Nlc3NvcjtcblxuICAvKipcbiAgICogQ3VzdG9tIHN0cmF0ZWd5IHRvIG5hbWUgYWxhcm1zXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gZGVmYXVsdCBiZWhhdmlvdXIgKG5vIGNoYW5nZSlcbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtaW5nU3RyYXRlZ3k/OiBJQWxhcm1OYW1pbmdTdHJhdGVneTtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIGJyZWFjaGVzIHJlcXVpcmVkIHRvIHRyYW5zaXRpb24gaW50byBhbiBBTEFSTSBzdGF0ZS5cbiAgICpcbiAgICogQGRlZmF1bHQgLSAzXG4gICAqL1xuICByZWFkb25seSBkYXRhcG9pbnRzVG9BbGFybT86IG51bWJlcjtcblxuICAvKipcbiAgICogTnVtYmVyIG9mIHBlcmlvZHMgdG8gY29uc2lkZXIgd2hlbiBjaGVja2luZyB0aGUgbnVtYmVyIG9mIGJyZWFjaGluZyBkYXRhcG9pbnRzLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIFNhbWUgYXMgZGF0YXBvaW50c1RvQWxhcm0uXG4gICAqL1xuICByZWFkb25seSBldmFsdWF0aW9uUGVyaW9kcz86IG51bWJlcjtcblxuICAvKipcbiAgICogR2xvYmFsIHByZWZpeCBmb3IgYWxsIGFsYXJtIG5hbWVzLiBUaGlzIHNob3VsZCBiZSBzb21ldGhpbmcgdW5pcXVlIHRvIGF2b2lkIHBvdGVudGlhbCBjb2xsaXNpb25zLlxuICAgKiBUaGlzIGlzIGlnbm9yZWQgaWYgYW4gYWxhcm0ncyBkZWR1cGVTdHJpbmdPdmVycmlkZSBpcyBkZWNsYXJlZC5cbiAgICovXG4gIHJlYWRvbmx5IGFsYXJtTmFtZVByZWZpeDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBvcHRpb25hbCBsaW5rIGluY2x1ZGVkIGluIHRoZSBnZW5lcmF0ZWQgdGlja2V0IGRlc2NyaXB0aW9uIGJvZHkuXG4gICAqL1xuICByZWFkb25seSBkb2N1bWVudGF0aW9uTGluaz86IHN0cmluZztcblxuICAvKipcbiAgICogQW4gb3B0aW9uYWwgbGluayBpbmNsdWRlZCBpbiB0aGUgZ2VuZXJhdGVkIHRpY2tldCBkZXNjcmlwdGlvbiBib2R5LlxuICAgKi9cbiAgcmVhZG9ubHkgcnVuYm9va0xpbms/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIElmIHRoaXMgaXMgZGVmaW5lZCBhcyBmYWxzZSBhbmQgZGVkdXBlU3RyaW5nT3ZlcnJpZGUgaXMgdW5kZWZpbmVkLCB0aGUgYWxhcm0gcHJlZml4IHdpbGwgYmUgcGFydCBvZiB0aGUgZGVkdXBlIHN0cmluZy5cbiAgICogVGhpcyBlc3NlbnRpYWxseSBzdG9wcyB0aGUgZGVkdXBlIG9mIGRpZmZlcmVudCBlcnJvcnMgdG9nZXRoZXIuXG4gICAqXG4gICAqIEBkZWZhdWx0IC0gdW5kZWZpbmVkICh0cnVlKVxuICAgKi9cbiAgcmVhZG9ubHkgdXNlRGVmYXVsdERlZHVwZUZvckVycm9yPzogYm9vbGVhbjtcblxuICAvKipcbiAgICogSWYgdGhpcyBpcyBkZWZpbmVkIGFzIGZhbHNlIGFuZCBkZWR1cGVTdHJpbmdPdmVycmlkZSBpcyB1bmRlZmluZWQsIHRoZSBhbGFybSBwcmVmaXggd2lsbCBiZSBwYXJ0IG9mIHRoZSBkZWR1cGUgc3RyaW5nLlxuICAgKiBUaGlzIGVzc2VudGlhbGx5IHN0b3BzIHRoZSBkZWR1cGUgb2YgZGlmZmVyZW50IGxhdGVuY3kgaXNzdWVzIHRvZ2V0aGVyLlxuICAgKlxuICAgKiBAZGVmYXVsdCAtIHVuZGVmaW5lZCAodHJ1ZSlcbiAgICovXG4gIHJlYWRvbmx5IHVzZURlZmF1bHREZWR1cGVGb3JMYXRlbmN5PzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGFybUZhY3RvcnlQcm9wcyB7XG4gIHJlYWRvbmx5IGdsb2JhbEFsYXJtRGVmYXVsdHM6IEFsYXJtRmFjdG9yeURlZmF1bHRzO1xuICByZWFkb25seSBnbG9iYWxNZXRyaWNEZWZhdWx0czogTWV0cmljRmFjdG9yeURlZmF1bHRzO1xuICByZWFkb25seSBsb2NhbEFsYXJtTmFtZVByZWZpeDogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgQWxhcm1GYWN0b3J5IHtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGFsYXJtU2NvcGU6IENvbnN0cnVjdDtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGdsb2JhbEFsYXJtRGVmYXVsdHM6IEFsYXJtRmFjdG9yeURlZmF1bHRzO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZ2xvYmFsTWV0cmljRGVmYXVsdHM6IE1ldHJpY0ZhY3RvcnlEZWZhdWx0cztcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGFsYXJtTmFtaW5nU3RyYXRlZ3k6IElBbGFybU5hbWluZ1N0cmF0ZWd5O1xuXG4gIGNvbnN0cnVjdG9yKGFsYXJtU2NvcGU6IENvbnN0cnVjdCwgcHJvcHM6IEFsYXJtRmFjdG9yeVByb3BzKSB7XG4gICAgdGhpcy5hbGFybVNjb3BlID0gYWxhcm1TY29wZTtcbiAgICB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMgPSBwcm9wcy5nbG9iYWxBbGFybURlZmF1bHRzO1xuICAgIHRoaXMuZ2xvYmFsTWV0cmljRGVmYXVsdHMgPSBwcm9wcy5nbG9iYWxNZXRyaWNEZWZhdWx0cztcbiAgICB0aGlzLmFsYXJtTmFtaW5nU3RyYXRlZ3kgPVxuICAgICAgcHJvcHMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hbGFybU5hbWluZ1N0cmF0ZWd5ID8/XG4gICAgICBuZXcgQWxhcm1OYW1pbmdTdHJhdGVneShcbiAgICAgICAgcHJvcHMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hbGFybU5hbWVQcmVmaXgsXG4gICAgICAgIHByb3BzLmxvY2FsQWxhcm1OYW1lUHJlZml4LFxuICAgICAgICBwcm9wcy5nbG9iYWxBbGFybURlZmF1bHRzLmRlZHVwZVN0cmluZ1Byb2Nlc3NvcixcbiAgICAgICk7XG4gIH1cblxuICBhZGRBbGFybShcbiAgICBtZXRyaWM6IE1ldHJpY1dpdGhBbGFybVN1cHBvcnQsXG4gICAgcHJvcHM6IEFkZEFsYXJtUHJvcHMsXG4gICk6IEFsYXJtV2l0aEFubm90YXRpb24ge1xuICAgIC8vIGFkanVzdCB0aGUgbWV0cmljXG5cbiAgICBjb25zdCBtZXRyaWNBZGp1c3RlciA9IHByb3BzLm1ldHJpY0FkanVzdGVyXG4gICAgICA/IENvbXBvc2l0ZU1ldHJpY0FkanVzdGVyLm9mKFxuICAgICAgICAgIHByb3BzLm1ldHJpY0FkanVzdGVyLFxuICAgICAgICAgIERlZmF1bHRNZXRyaWNBZGp1c3Rlci5JTlNUQU5DRSxcbiAgICAgICAgKVxuICAgICAgOiBEZWZhdWx0TWV0cmljQWRqdXN0ZXIuSU5TVEFOQ0U7XG4gICAgY29uc3QgYWRqdXN0ZWRNZXRyaWMgPSBtZXRyaWNBZGp1c3Rlci5hZGp1c3RNZXRyaWMoXG4gICAgICBtZXRyaWMsXG4gICAgICB0aGlzLmFsYXJtU2NvcGUsXG4gICAgICBwcm9wcyxcbiAgICApO1xuXG4gICAgLy8gbWV0cmljIHRoYXQgd2lsbCBiZSB1bHRpbWF0ZWx5IHVzZWQgdG8gY3JlYXRlIHRoZSBhbGFybVxuICAgIGxldCBhbGFybU1ldHJpYzogTWV0cmljV2l0aEFsYXJtU3VwcG9ydCA9IGFkanVzdGVkTWV0cmljO1xuXG4gICAgLy8gcHJlcGFyZSBwcmltYXJ5IGFsYXJtIHByb3BlcnRpZXNcblxuICAgIGNvbnN0IGFjdGlvbnNFbmFibGVkID0gdGhpcy5kZXRlcm1pbmVBY3Rpb25zRW5hYmxlZChcbiAgICAgIHByb3BzLmFjdGlvbnNFbmFibGVkLFxuICAgICAgcHJvcHMuZGlzYW1iaWd1YXRvcixcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMuZGV0ZXJtaW5lQWN0aW9uKFxuICAgICAgcHJvcHMuZGlzYW1iaWd1YXRvcixcbiAgICAgIHByb3BzLmFjdGlvbk92ZXJyaWRlLFxuICAgICk7XG4gICAgY29uc3QgYWxhcm1OYW1lID0gdGhpcy5hbGFybU5hbWluZ1N0cmF0ZWd5LmdldE5hbWUocHJvcHMpO1xuICAgIGNvbnN0IGFsYXJtTmFtZVN1ZmZpeCA9IHByb3BzLmFsYXJtTmFtZVN1ZmZpeDtcbiAgICBjb25zdCBhbGFybUxhYmVsID0gdGhpcy5hbGFybU5hbWluZ1N0cmF0ZWd5LmdldFdpZGdldExhYmVsKHByb3BzKTtcbiAgICBjb25zdCBhbGFybURlc2NyaXB0aW9uID0gdGhpcy5nZW5lcmF0ZURlc2NyaXB0aW9uKFxuICAgICAgcHJvcHMuYWxhcm1EZXNjcmlwdGlvbixcbiAgICAgIHByb3BzLmFsYXJtRGVzY3JpcHRpb25PdmVycmlkZSxcbiAgICAgIHByb3BzLnJ1bmJvb2tMaW5rLFxuICAgICAgcHJvcHMuZG9jdW1lbnRhdGlvbkxpbmssXG4gICAgKTtcbiAgICBjb25zdCBkZWR1cGVTdHJpbmcgPSB0aGlzLmFsYXJtTmFtaW5nU3RyYXRlZ3kuZ2V0RGVkdXBlU3RyaW5nKHByb3BzKTtcbiAgICBjb25zdCBldmFsdWF0ZUxvd1NhbXBsZUNvdW50UGVyY2VudGlsZSA9XG4gICAgICBwcm9wcy5ldmFsdWF0ZUxvd1NhbXBsZUNvdW50UGVyY2VudGlsZSA/PyB0cnVlO1xuXG4gICAgY29uc3QgZGF0YXBvaW50c1RvQWxhcm0gPVxuICAgICAgcHJvcHMuZGF0YXBvaW50c1RvQWxhcm0gPz9cbiAgICAgIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5kYXRhcG9pbnRzVG9BbGFybSA/P1xuICAgICAgRGVmYXVsdERhdGFwb2ludHNUb0FsYXJtO1xuICAgIGNvbnN0IGV2YWx1YXRpb25QZXJpb2RzID1cbiAgICAgIHByb3BzLmV2YWx1YXRpb25QZXJpb2RzID8/XG4gICAgICB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuZXZhbHVhdGlvblBlcmlvZHMgPz9cbiAgICAgIGRhdGFwb2ludHNUb0FsYXJtO1xuXG4gICAgaWYgKGV2YWx1YXRpb25QZXJpb2RzIDwgZGF0YXBvaW50c1RvQWxhcm0pIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYGV2YWx1YXRpb25QZXJpb2RzIG11c3QgYmUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIGRhdGFwb2ludHNUb0FsYXJtIGZvciAke2FsYXJtTmFtZX1gLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBhcHBseSBtZXRyaWMgbWF0aCBmb3IgbWluaW11bSBtZXRyaWMgc2FtcGxlc1xuXG4gICAgaWYgKHByb3BzLm1pblNhbXBsZUNvdW50VG9FdmFsdWF0ZURhdGFwb2ludCkge1xuICAgICAgbGV0IGxhYmVsOiBzdHJpbmcgPSBgJHthZGp1c3RlZE1ldHJpY31gO1xuICAgICAgbGV0IG1ldHJpY0V4cHJlc3Npb246IHN0cmluZztcbiAgICAgIGxldCBtZXRyaWNTYW1wbGVDb3VudElkOiBzdHJpbmcgPSBcInNhbXBsZUNvdW50XCI7XG4gICAgICBsZXQgdXNpbmdNZXRyaWNzOiBSZWNvcmQ8c3RyaW5nLCBJTWV0cmljPjtcblxuICAgICAgaWYgKGFkanVzdGVkTWV0cmljIGluc3RhbmNlb2YgTWF0aEV4cHJlc3Npb24pIHtcbiAgICAgICAgbGFiZWwgPSBhZGp1c3RlZE1ldHJpYy5sYWJlbCA/PyBsYWJlbDtcbiAgICAgICAgbWV0cmljRXhwcmVzc2lvbiA9IGAoJHthZGp1c3RlZE1ldHJpYy5leHByZXNzaW9ufSlgO1xuXG4gICAgICAgIGlmIChPYmplY3Qua2V5cyhhZGp1c3RlZE1ldHJpYy51c2luZ01ldHJpY3MpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIGNvbnN0IHNhbXBsZUNvdW50TWV0cmljID0gKFxuICAgICAgICAgICAgYWRqdXN0ZWRNZXRyaWMudXNpbmdNZXRyaWNzW1xuICAgICAgICAgICAgICBPYmplY3Qua2V5cyhhZGp1c3RlZE1ldHJpYy51c2luZ01ldHJpY3MpWzBdXG4gICAgICAgICAgICBdIGFzIE1ldHJpY1xuICAgICAgICAgICkud2l0aCh7XG4gICAgICAgICAgICBzdGF0aXN0aWM6IE1ldHJpY1N0YXRpc3RpYy5OLFxuICAgICAgICAgICAgbGFiZWw6IFwiU2FtcGxlIGNvdW50XCIsXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB1c2luZ01ldHJpY3MgPSB7XG4gICAgICAgICAgICAuLi5hZGp1c3RlZE1ldHJpYy51c2luZ01ldHJpY3MsXG4gICAgICAgICAgICBbbWV0cmljU2FtcGxlQ291bnRJZF06IHNhbXBsZUNvdW50TWV0cmljLFxuICAgICAgICAgIH07XG4gICAgICAgIH0gZWxzZSBpZiAocHJvcHMuc2FtcGxlQ291bnRNZXRyaWNJZCkge1xuICAgICAgICAgIHVzaW5nTWV0cmljcyA9IGFkanVzdGVkTWV0cmljLnVzaW5nTWV0cmljcztcbiAgICAgICAgICBtZXRyaWNTYW1wbGVDb3VudElkID0gcHJvcHMuc2FtcGxlQ291bnRNZXRyaWNJZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBcInNhbXBsZUNvdW50TWV0cmljSWQgbXVzdCBiZSBzcGVjaWZpZWQgd2hlbiB1c2luZyBtaW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQgd2l0aCBhIG11bHRpcGxlLW1ldHJpYyBNYXRoRXhwcmVzc2lvblwiLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IG1ldHJpY0lkOiBzdHJpbmcgPSBcIm1ldHJpY1wiO1xuXG4gICAgICAgIG1ldHJpY0V4cHJlc3Npb24gPSBtZXRyaWNJZDtcbiAgICAgICAgdXNpbmdNZXRyaWNzID0ge1xuICAgICAgICAgIFttZXRyaWNJZF06IGFkanVzdGVkTWV0cmljLFxuICAgICAgICAgIFttZXRyaWNTYW1wbGVDb3VudElkXTogYWRqdXN0ZWRNZXRyaWMud2l0aCh7XG4gICAgICAgICAgICBzdGF0aXN0aWM6IE1ldHJpY1N0YXRpc3RpYy5OLFxuICAgICAgICAgICAgbGFiZWw6IFwiU2FtcGxlIGNvdW50XCIsXG4gICAgICAgICAgfSksXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGFsYXJtTWV0cmljID0gbmV3IE1hdGhFeHByZXNzaW9uKHtcbiAgICAgICAgbGFiZWwsXG4gICAgICAgIGV4cHJlc3Npb246IGBJRigke21ldHJpY1NhbXBsZUNvdW50SWR9ID4gJHtwcm9wcy5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnR9LCAke21ldHJpY0V4cHJlc3Npb259KWAsXG4gICAgICAgIHBlcmlvZDogYWRqdXN0ZWRNZXRyaWMucGVyaW9kLFxuICAgICAgICB1c2luZ01ldHJpY3MsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgcHJpbWFyeSBhbGFybVxuXG4gICAgY29uc3QgcHJpbWFyeUFsYXJtID0gYWxhcm1NZXRyaWMuY3JlYXRlQWxhcm0odGhpcy5hbGFybVNjb3BlLCBhbGFybU5hbWUsIHtcbiAgICAgIGFsYXJtTmFtZSxcbiAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICB0aHJlc2hvbGQ6IHByb3BzLnRocmVzaG9sZCxcbiAgICAgIGNvbXBhcmlzb25PcGVyYXRvcjogcHJvcHMuY29tcGFyaXNvbk9wZXJhdG9yLFxuICAgICAgdHJlYXRNaXNzaW5nRGF0YTogcHJvcHMudHJlYXRNaXNzaW5nRGF0YSxcbiAgICAgIC8vIGRlZmF1bHQgdmFsdWUgKHVuZGVmaW5lZCkgbWVhbnMgXCJldmFsdWF0ZVwiXG4gICAgICBldmFsdWF0ZUxvd1NhbXBsZUNvdW50UGVyY2VudGlsZTogZXZhbHVhdGVMb3dTYW1wbGVDb3VudFBlcmNlbnRpbGVcbiAgICAgICAgPyB1bmRlZmluZWRcbiAgICAgICAgOiBcImlnbm9yZVwiLFxuICAgICAgZGF0YXBvaW50c1RvQWxhcm0sXG4gICAgICBldmFsdWF0aW9uUGVyaW9kcyxcbiAgICAgIGFjdGlvbnNFbmFibGVkLFxuICAgIH0pO1xuXG4gICAgbGV0IGFsYXJtOiBBbGFybUJhc2UgPSBwcmltYXJ5QWxhcm07XG5cbiAgICAvLyBjcmVhdGUgY29tcG9zaXRlIGFsYXJtIGZvciBtaW4gbWV0cmljIHNhbXBsZXMgKGlmIGRlZmluZWQpXG4gICAgLy8gZGVwcmVjYXRlZCBpbiBmYXZvdXIgb2YgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50XG5cbiAgICBpZiAoXG4gICAgICAhcHJvcHMubWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50ICYmXG4gICAgICBwcm9wcy5taW5NZXRyaWNTYW1wbGVzVG9BbGFybVxuICAgICkge1xuICAgICAgY29uc3QgbWV0cmljU2FtcGxlQ291bnQgPSBhZGp1c3RlZE1ldHJpYy53aXRoKHtcbiAgICAgICAgc3RhdGlzdGljOiBNZXRyaWNTdGF0aXN0aWMuTixcbiAgICAgIH0pO1xuICAgICAgY29uc3Qgbm9TYW1wbGVzQWxhcm0gPSBtZXRyaWNTYW1wbGVDb3VudC5jcmVhdGVBbGFybShcbiAgICAgICAgdGhpcy5hbGFybVNjb3BlLFxuICAgICAgICBgJHthbGFybU5hbWV9LU5vU2FtcGxlc2AsXG4gICAgICAgIHtcbiAgICAgICAgICBhbGFybU5hbWU6IGAke2FsYXJtTmFtZX0tTm9TYW1wbGVzYCxcbiAgICAgICAgICBhbGFybURlc2NyaXB0aW9uOiBgVGhlIG1ldHJpYyAoJHthZGp1c3RlZE1ldHJpY30pIGRvZXMgbm90IGhhdmUgZW5vdWdoIHNhbXBsZXMgdG8gYWxhcm0uIE11c3QgaGF2ZSBhdCBsZWFzdCAke3Byb3BzLm1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtfS5gLFxuICAgICAgICAgIHRocmVzaG9sZDogcHJvcHMubWluTWV0cmljU2FtcGxlc1RvQWxhcm0sXG4gICAgICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBDb21wYXJpc29uT3BlcmF0b3IuTEVTU19USEFOX1RIUkVTSE9MRCxcbiAgICAgICAgICB0cmVhdE1pc3NpbmdEYXRhOiBUcmVhdE1pc3NpbmdEYXRhLkJSRUFDSElORyxcbiAgICAgICAgICBkYXRhcG9pbnRzVG9BbGFybTogMSxcbiAgICAgICAgICBldmFsdWF0aW9uUGVyaW9kczogMSxcbiAgICAgICAgICBhY3Rpb25zRW5hYmxlZCxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICBhbGFybSA9IG5ldyBDb21wb3NpdGVBbGFybSh0aGlzLmFsYXJtU2NvcGUsIGAke2FsYXJtTmFtZX0tV2l0aFNhbXBsZXNgLCB7XG4gICAgICAgIGFjdGlvbnNFbmFibGVkLFxuICAgICAgICBjb21wb3NpdGVBbGFybU5hbWU6IGAke2FsYXJtTmFtZX0tV2l0aFNhbXBsZXNgLFxuICAgICAgICBhbGFybURlc2NyaXB0aW9uOiB0aGlzLmpvaW5EZXNjcmlwdGlvblBhcnRzKFxuICAgICAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICAgICAgYE1pbiBudW1iZXIgb2Ygc2FtcGxlcyB0byBhbGFybTogJHtwcm9wcy5taW5NZXRyaWNTYW1wbGVzVG9BbGFybX1gLFxuICAgICAgICApLFxuICAgICAgICBhbGFybVJ1bGU6IEFsYXJtUnVsZS5hbGxPZihcbiAgICAgICAgICBBbGFybVJ1bGUuZnJvbUFsYXJtKHByaW1hcnlBbGFybSwgQWxhcm1TdGF0ZS5BTEFSTSksXG4gICAgICAgICAgQWxhcm1SdWxlLm5vdChBbGFybVJ1bGUuZnJvbUFsYXJtKG5vU2FtcGxlc0FsYXJtLCBBbGFybVN0YXRlLkFMQVJNKSksXG4gICAgICAgICksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBhdHRhY2ggYWxhcm0gYWN0aW9uc1xuXG4gICAgYWN0aW9uLmFkZEFsYXJtQWN0aW9ucyh7XG4gICAgICBhbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGRlZHVwZVN0cmluZyxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzLmRpc2FtYmlndWF0b3IsXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzID8/IFtdLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMgPz8ge30sXG4gICAgfSk7XG5cbiAgICAvLyBjcmVhdGUgYW5ub3RhdGlvbiBmb3IgdGhlIHByaW1hcnkgYWxhcm1cblxuICAgIGNvbnN0IGFubm90YXRpb24gPSB0aGlzLmNyZWF0ZUFubm90YXRpb24oe1xuICAgICAgYWxhcm06IHByaW1hcnlBbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIG1ldHJpYzogYWRqdXN0ZWRNZXRyaWMsXG4gICAgICBldmFsdWF0aW9uUGVyaW9kcyxcbiAgICAgIGRhdGFwb2ludHNUb0FsYXJtLFxuICAgICAgZGVkdXBlU3RyaW5nLFxuICAgICAgbWluTWV0cmljU2FtcGxlc1RvQWxhcm06IHByb3BzLm1pbk1ldHJpY1NhbXBsZXNUb0FsYXJtLFxuICAgICAgbWluU2FtcGxlQ291bnRUb0V2YWx1YXRlRGF0YXBvaW50OlxuICAgICAgICBwcm9wcy5taW5TYW1wbGVDb3VudFRvRXZhbHVhdGVEYXRhcG9pbnQsXG4gICAgICBmaWxsQWxhcm1SYW5nZTogcHJvcHMuZmlsbEFsYXJtUmFuZ2UgPz8gZmFsc2UsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25Db2xvcjogcHJvcHMub3ZlcnJpZGVBbm5vdGF0aW9uQ29sb3IsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25MYWJlbDogcHJvcHMub3ZlcnJpZGVBbm5vdGF0aW9uTGFiZWwsXG4gICAgICBvdmVycmlkZUFubm90YXRpb25WaXNpYmlsaXR5OiBwcm9wcy5vdmVycmlkZUFubm90YXRpb25WaXNpYmlsaXR5LFxuICAgICAgY29tcGFyaXNvbk9wZXJhdG9yOiBwcm9wcy5jb21wYXJpc29uT3BlcmF0b3IsXG4gICAgICB0aHJlc2hvbGQ6IHByb3BzLnRocmVzaG9sZCxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzLmRpc2FtYmlndWF0b3IsXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzID8/IFtdLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMgPz8ge30sXG4gICAgfSk7XG5cbiAgICAvLyByZXR1cm4gdGhlIGZpbmFsIHJlc3VsdFxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsYXJtLFxuICAgICAgYWN0aW9uLFxuICAgICAgYWxhcm1OYW1lLFxuICAgICAgYWxhcm1OYW1lU3VmZml4LFxuICAgICAgYWxhcm1MYWJlbCxcbiAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICBjdXN0b21UYWdzOiBwcm9wcy5jdXN0b21UYWdzLFxuICAgICAgY3VzdG9tUGFyYW1zOiBwcm9wcy5jdXN0b21QYXJhbXMsXG4gICAgICBhbGFybVJ1bGVXaGVuT2s6IEFsYXJtUnVsZS5mcm9tQWxhcm0oYWxhcm0sIEFsYXJtU3RhdGUuT0spLFxuICAgICAgYWxhcm1SdWxlV2hlbkFsYXJtaW5nOiBBbGFybVJ1bGUuZnJvbUFsYXJtKGFsYXJtLCBBbGFybVN0YXRlLkFMQVJNKSxcbiAgICAgIGFsYXJtUnVsZVdoZW5JbnN1ZmZpY2llbnREYXRhOiBBbGFybVJ1bGUuZnJvbUFsYXJtKFxuICAgICAgICBhbGFybSxcbiAgICAgICAgQWxhcm1TdGF0ZS5JTlNVRkZJQ0lFTlRfREFUQSxcbiAgICAgICksXG4gICAgICBkZWR1cGVTdHJpbmcsXG4gICAgICBhbm5vdGF0aW9uLFxuICAgICAgZGlzYW1iaWd1YXRvcjogcHJvcHMuZGlzYW1iaWd1YXRvcixcbiAgICB9O1xuICB9XG5cbiAgYWRkQ29tcG9zaXRlQWxhcm0oXG4gICAgYWxhcm1zOiBBbGFybVdpdGhBbm5vdGF0aW9uW10sXG4gICAgcHJvcHM6IEFkZENvbXBvc2l0ZUFsYXJtUHJvcHMsXG4gICk6IENvbXBvc2l0ZUFsYXJtIHtcbiAgICBjb25zdCBhY3Rpb25zRW5hYmxlZCA9IHRoaXMuZGV0ZXJtaW5lQWN0aW9uc0VuYWJsZWQoXG4gICAgICBwcm9wcz8uYWN0aW9uc0VuYWJsZWQsXG4gICAgICBwcm9wcz8uZGlzYW1iaWd1YXRvcixcbiAgICApO1xuICAgIGNvbnN0IGFjdGlvbiA9XG4gICAgICBwcm9wcy5hY3Rpb25PdmVycmlkZSA/PyB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuYWN0aW9uID8/IG5vb3BBY3Rpb24oKTtcbiAgICBjb25zdCBuYW1pbmdJbnB1dCA9IHsgYWxhcm1OYW1lU3VmZml4OiBcIkNvbXBvc2l0ZVwiLCAuLi5wcm9wcyB9O1xuICAgIGNvbnN0IGFsYXJtTmFtZSA9IHRoaXMuYWxhcm1OYW1pbmdTdHJhdGVneS5nZXROYW1lKG5hbWluZ0lucHV0KTtcbiAgICBjb25zdCBhbGFybURlc2NyaXB0aW9uID0gdGhpcy5nZW5lcmF0ZURlc2NyaXB0aW9uKFxuICAgICAgcHJvcHM/LmFsYXJtRGVzY3JpcHRpb24gPz8gXCJDb21wb3NpdGUgYWxhcm1cIixcbiAgICAgIHByb3BzPy5hbGFybURlc2NyaXB0aW9uT3ZlcnJpZGUsXG4gICAgICBwcm9wcz8ucnVuYm9va0xpbmssXG4gICAgICBwcm9wcz8uZG9jdW1lbnRhdGlvbkxpbmssXG4gICAgKTtcbiAgICBjb25zdCBkZWR1cGVTdHJpbmcgPSB0aGlzLmFsYXJtTmFtaW5nU3RyYXRlZ3kuZ2V0RGVkdXBlU3RyaW5nKG5hbWluZ0lucHV0KTtcbiAgICBjb25zdCBhbGFybVJ1bGUgPSB0aGlzLmRldGVybWluZUNvbXBvc2l0ZUFsYXJtUnVsZShhbGFybXMsIHByb3BzKTtcblxuICAgIGNvbnN0IGFsYXJtID0gbmV3IENvbXBvc2l0ZUFsYXJtKHRoaXMuYWxhcm1TY29wZSwgYWxhcm1OYW1lLCB7XG4gICAgICBjb21wb3NpdGVBbGFybU5hbWU6IGFsYXJtTmFtZSxcbiAgICAgIGFsYXJtRGVzY3JpcHRpb24sXG4gICAgICBhbGFybVJ1bGUsXG4gICAgICBhY3Rpb25zRW5hYmxlZCxcbiAgICAgIGFjdGlvbnNTdXBwcmVzc29yOiBwcm9wcz8uYWN0aW9uc1N1cHByZXNzb3IsXG4gICAgICBhY3Rpb25zU3VwcHJlc3NvckV4dGVuc2lvblBlcmlvZDogcHJvcHM/LmFjdGlvbnNTdXBwcmVzc29yRXh0ZW5zaW9uUGVyaW9kLFxuICAgICAgYWN0aW9uc1N1cHByZXNzb3JXYWl0UGVyaW9kOiBwcm9wcz8uYWN0aW9uc1N1cHByZXNzb3JXYWl0UGVyaW9kLFxuICAgIH0pO1xuXG4gICAgYWN0aW9uLmFkZEFsYXJtQWN0aW9ucyh7XG4gICAgICBhbGFybSxcbiAgICAgIGFjdGlvbixcbiAgICAgIGRlZHVwZVN0cmluZyxcbiAgICAgIGRpc2FtYmlndWF0b3I6IHByb3BzPy5kaXNhbWJpZ3VhdG9yLFxuICAgICAgY3VzdG9tVGFnczogcHJvcHM/LmN1c3RvbVRhZ3MsXG4gICAgICBjdXN0b21QYXJhbXM6IHByb3BzPy5jdXN0b21QYXJhbXMsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gYWxhcm07XG4gIH1cblxuICBwcm90ZWN0ZWQgZGV0ZXJtaW5lQ29tcG9zaXRlQWxhcm1SdWxlKFxuICAgIGFsYXJtczogQWxhcm1XaXRoQW5ub3RhdGlvbltdLFxuICAgIHByb3BzOiBBZGRDb21wb3NpdGVBbGFybVByb3BzLFxuICApOiBJQWxhcm1SdWxlIHtcbiAgICBjb25zdCBhbGFybVJ1bGVzID0gYWxhcm1zLm1hcCgoYWxhcm0pID0+IGFsYXJtLmFsYXJtUnVsZVdoZW5BbGFybWluZyk7XG4gICAgY29uc3Qgb3BlcmF0b3IgPSBwcm9wcy5jb21wb3NpdGVPcGVyYXRvciA/PyBDb21wb3NpdGVBbGFybU9wZXJhdG9yLk9SO1xuICAgIHN3aXRjaCAob3BlcmF0b3IpIHtcbiAgICAgIGNhc2UgQ29tcG9zaXRlQWxhcm1PcGVyYXRvci5BTkQ6XG4gICAgICAgIHJldHVybiBBbGFybVJ1bGUuYWxsT2YoLi4uYWxhcm1SdWxlcyk7XG4gICAgICBjYXNlIENvbXBvc2l0ZUFsYXJtT3BlcmF0b3IuT1I6XG4gICAgICAgIHJldHVybiBBbGFybVJ1bGUuYW55T2YoLi4uYWxhcm1SdWxlcyk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVuc3VwcG9ydGVkIGNvbXBvc2l0ZSBhbGFybSBvcGVyYXRvcjogJHtvcGVyYXRvcn1gKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgZGV0ZXJtaW5lQWN0aW9uc0VuYWJsZWQoXG4gICAgYWN0aW9uc0VuYWJsZWQ/OiBib29sZWFuLFxuICAgIGRpc2FtYmlndWF0b3I/OiBzdHJpbmcsXG4gICk6IGJvb2xlYW4ge1xuICAgIGlmIChhY3Rpb25zRW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBhbGFybS1zcGVjaWZpYyBvdmVycmlkZSB0byB0cnVlIG9yIGZhbHNlXG4gICAgICByZXR1cm4gYWN0aW9uc0VuYWJsZWQ7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmFjdGlvbnNFbmFibGVkID09PSBcImJvb2xlYW5cIikge1xuICAgICAgLy8gZ2xvYmFsIGRlZmF1bHRzOiBib29sZWFuIHZhbHVlXG4gICAgICByZXR1cm4gdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmFjdGlvbnNFbmFibGVkO1xuICAgIH1cbiAgICBpZiAoZGlzYW1iaWd1YXRvcikge1xuICAgICAgLy8gZ2xvYmFsIGRlZmF1bHRzOiBkaXNhbWJpZ3VhdG9yIGJhc2VkIHZhbHVlXG4gICAgICByZXR1cm4gdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmFjdGlvbnNFbmFibGVkW2Rpc2FtYmlndWF0b3JdID8/IGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBwcm90ZWN0ZWQgZGV0ZXJtaW5lQWN0aW9uKFxuICAgIGRpc2FtYmlndWF0b3I/OiBzdHJpbmcsXG4gICAgYWN0aW9uT3ZlcnJpZGU/OiBJQWxhcm1BY3Rpb25TdHJhdGVneSxcbiAgKTogSUFsYXJtQWN0aW9uU3RyYXRlZ3kge1xuICAgIC8vIEV4cGxpY2l0IG92ZXJyaWRlXG4gICAgaWYgKGFjdGlvbk92ZXJyaWRlKSB7XG4gICAgICByZXR1cm4gYWN0aW9uT3ZlcnJpZGU7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBieSBkaXNhbWJpdWdhdG9yXG4gICAgaWYgKFxuICAgICAgZGlzYW1iaWd1YXRvciAmJlxuICAgICAgdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLmRpc2FtYmlndWF0b3JBY3Rpb24/LltkaXNhbWJpZ3VhdG9yXVxuICAgICkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5kaXNhbWJpZ3VhdG9yQWN0aW9uW2Rpc2FtYmlndWF0b3JdO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgZ2xvYmFsIGFjdGlvblxuICAgIHJldHVybiB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuYWN0aW9uID8/IG5vb3BBY3Rpb24oKTtcbiAgfVxuXG4gIGdldCBzaG91bGRVc2VEZWZhdWx0RGVkdXBlRm9yRXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy51c2VEZWZhdWx0RGVkdXBlRm9yRXJyb3IgPz8gdHJ1ZTtcbiAgfVxuXG4gIGdldCBzaG91bGRVc2VEZWZhdWx0RGVkdXBlRm9yTGF0ZW5jeSgpIHtcbiAgICByZXR1cm4gdGhpcy5nbG9iYWxBbGFybURlZmF1bHRzLnVzZURlZmF1bHREZWR1cGVGb3JMYXRlbmN5ID8/IHRydWU7XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2VuZXJhdGVEZXNjcmlwdGlvbihcbiAgICBhbGFybURlc2NyaXB0aW9uOiBzdHJpbmcsXG4gICAgYWxhcm1EZXNjcmlwdGlvbk92ZXJyaWRlPzogc3RyaW5nLFxuICAgIHJ1bmJvb2tMaW5rT3ZlcnJpZGU/OiBzdHJpbmcsXG4gICAgZG9jdW1lbnRhdGlvbkxpbmtPdmVycmlkZT86IHN0cmluZyxcbiAgKSB7XG4gICAgY29uc3QgcGFydHMgPSBbYWxhcm1EZXNjcmlwdGlvbk92ZXJyaWRlID8/IGFsYXJtRGVzY3JpcHRpb25dO1xuXG4gICAgY29uc3QgcnVuYm9va0xpbmsgPVxuICAgICAgcnVuYm9va0xpbmtPdmVycmlkZSA/PyB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMucnVuYm9va0xpbms7XG4gICAgY29uc3QgZG9jdW1lbnRhdGlvbkxpbmsgPVxuICAgICAgZG9jdW1lbnRhdGlvbkxpbmtPdmVycmlkZSA/PyB0aGlzLmdsb2JhbEFsYXJtRGVmYXVsdHMuZG9jdW1lbnRhdGlvbkxpbms7XG5cbiAgICBpZiAocnVuYm9va0xpbmspIHtcbiAgICAgIHBhcnRzLnB1c2goYFJ1bmJvb2s6ICR7cnVuYm9va0xpbmt9YCk7XG4gICAgfVxuXG4gICAgaWYgKGRvY3VtZW50YXRpb25MaW5rKSB7XG4gICAgICBwYXJ0cy5wdXNoKGBEb2N1bWVudGF0aW9uOiAke2RvY3VtZW50YXRpb25MaW5rfWApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmpvaW5EZXNjcmlwdGlvblBhcnRzKC4uLnBhcnRzKTtcbiAgfVxuXG4gIHByb3RlY3RlZCBqb2luRGVzY3JpcHRpb25QYXJ0cyguLi5wYXJ0czogc3RyaW5nW10pIHtcbiAgICByZXR1cm4gcGFydHMuam9pbihcIiBcXHJcXG5cIik7XG4gIH1cblxuICBwcm90ZWN0ZWQgY3JlYXRlQW5ub3RhdGlvbihwcm9wczogQWxhcm1Bbm5vdGF0aW9uU3RyYXRlZ3lQcm9wcykge1xuICAgIGNvbnN0IHN0cmF0ZWd5ID1cbiAgICAgIHRoaXMuZ2xvYmFsQWxhcm1EZWZhdWx0cy5hbm5vdGF0aW9uU3RyYXRlZ3kgPz9cbiAgICAgIG5ldyBEZWZhdWx0QWxhcm1Bbm5vdGF0aW9uU3RyYXRlZ3koKTtcbiAgICByZXR1cm4gc3RyYXRlZ3kuY3JlYXRlQW5ub3RhdGlvbihwcm9wcyk7XG4gIH1cbn1cbiJdfQ==